Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=1.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 2.56M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_1.0_pretrain_True_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 0.252 Vali Loss: 0.248
Epoch: 1, | Train Acc: 0.4565 Vali Acc: 0.6857
Validation loss decreased (inf --> 0.247799).  Saving model ...
Epoch: 2, | Train Loss: 0.244 Vali Loss: 0.260
Epoch: 2, | Train Acc: 0.5507 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 0.243 Vali Loss: 0.217
Epoch: 3, | Train Acc: 0.5507 Vali Acc: 0.6286
Validation loss decreased (0.247799 --> 0.216750).  Saving model ...
Epoch: 4, | Train Loss: 0.237 Vali Loss: 0.241
Epoch: 4, | Train Acc: 0.5507 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 0.234 Vali Loss: 0.238
Epoch: 5, | Train Acc: 0.5725 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 0.230 Vali Loss: 0.233
Epoch: 6, | Train Acc: 0.5942 Vali Acc: 0.6571
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 0.226 Vali Loss: 0.237
Epoch: 7, | Train Acc: 0.6232 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           13
True 1            0           22

Accuracy:0.628571
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 0.237 Vali Loss: 0.248
Epoch: 1, | Train Acc: 0.5942 Vali Acc: 0.5143
Validation loss decreased (inf --> 0.248324).  Saving model ...
Epoch: 2, | Train Loss: 0.231 Vali Loss: 0.255
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 0.225 Vali Loss: 0.237
Epoch: 3, | Train Acc: 0.5797 Vali Acc: 0.5143
Validation loss decreased (0.248324 --> 0.237321).  Saving model ...
Epoch: 4, | Train Loss: 0.226 Vali Loss: 0.240
Epoch: 4, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 0.222 Vali Loss: 0.234
Epoch: 5, | Train Acc: 0.6667 Vali Acc: 0.6286
Validation loss decreased (0.237321 --> 0.233942).  Saving model ...
Epoch: 6, | Train Loss: 0.211 Vali Loss: 0.231
Epoch: 6, | Train Acc: 0.7754 Vali Acc: 0.5143
Validation loss decreased (0.233942 --> 0.231433).  Saving model ...
Epoch: 7, | Train Loss: 0.205 Vali Loss: 0.244
Epoch: 7, | Train Acc: 0.6522 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 0.198 Vali Loss: 0.227
Epoch: 8, | Train Acc: 0.7101 Vali Acc: 0.5714
Validation loss decreased (0.231433 --> 0.226744).  Saving model ...
Epoch: 9, | Train Loss: 0.190 Vali Loss: 0.228
Epoch: 9, | Train Acc: 0.8043 Vali Acc: 0.7143
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 0.188 Vali Loss: 0.245
Epoch: 10, | Train Acc: 0.7536 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 0.182 Vali Loss: 0.233
Epoch: 11, | Train Acc: 0.8768 Vali Acc: 0.7429
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 0.170 Vali Loss: 0.231
Epoch: 12, | Train Acc: 0.8116 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           15
True 1            0           18

Accuracy:0.571429
acc_clas_0:0.117647
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 0.204 Vali Loss: 0.197
Epoch: 1, | Train Acc: 0.7536 Vali Acc: 0.8286
Validation loss decreased (inf --> 0.197403).  Saving model ...
Epoch: 2, | Train Loss: 0.202 Vali Loss: 0.241
Epoch: 2, | Train Acc: 0.6739 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 0.194 Vali Loss: 0.193
Epoch: 3, | Train Acc: 0.7391 Vali Acc: 0.8571
Validation loss decreased (0.197403 --> 0.192880).  Saving model ...
Epoch: 4, | Train Loss: 0.186 Vali Loss: 0.185
Epoch: 4, | Train Acc: 0.8406 Vali Acc: 0.8000
Validation loss decreased (0.192880 --> 0.185413).  Saving model ...
Epoch: 5, | Train Loss: 0.181 Vali Loss: 0.189
Epoch: 5, | Train Acc: 0.8116 Vali Acc: 0.6857
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 0.175 Vali Loss: 0.178
Epoch: 6, | Train Acc: 0.7971 Vali Acc: 0.8000
Validation loss decreased (0.185413 --> 0.178239).  Saving model ...
Epoch: 7, | Train Loss: 0.168 Vali Loss: 0.194
Epoch: 7, | Train Acc: 0.8768 Vali Acc: 0.8286
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 0.165 Vali Loss: 0.172
Epoch: 8, | Train Acc: 0.8623 Vali Acc: 0.6857
Validation loss decreased (0.178239 --> 0.172265).  Saving model ...
Epoch: 9, | Train Loss: 0.157 Vali Loss: 0.201
Epoch: 9, | Train Acc: 0.8696 Vali Acc: 0.8286
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 0.150 Vali Loss: 0.190
Epoch: 10, | Train Acc: 0.8623 Vali Acc: 0.6857
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 0.145 Vali Loss: 0.166
Epoch: 11, | Train Acc: 0.8768 Vali Acc: 0.8286
Validation loss decreased (0.172265 --> 0.166042).  Saving model ...
Epoch: 12, | Train Loss: 0.139 Vali Loss: 0.176
Epoch: 12, | Train Acc: 0.9058 Vali Acc: 0.7429
EarlyStopping counter: 1 out of 4
Epoch: 13, | Train Loss: 0.135 Vali Loss: 0.181
Epoch: 13, | Train Acc: 0.9130 Vali Acc: 0.8000
EarlyStopping counter: 2 out of 4
Epoch: 14, | Train Loss: 0.127 Vali Loss: 0.171
Epoch: 14, | Train Acc: 0.9348 Vali Acc: 0.7714
EarlyStopping counter: 3 out of 4
Epoch: 15, | Train Loss: 0.122 Vali Loss: 0.167
Epoch: 15, | Train Acc: 0.9203 Vali Acc: 0.7714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           12            6
True 1            0           17

Accuracy:0.828571
acc_clas_0:0.666667
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 0.156 Vali Loss: 0.131
Epoch: 1, | Train Acc: 0.8705 Vali Acc: 0.8824
Validation loss decreased (inf --> 0.130510).  Saving model ...
Epoch: 2, | Train Loss: 0.147 Vali Loss: 0.135
Epoch: 2, | Train Acc: 0.8489 Vali Acc: 0.8824
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 0.139 Vali Loss: 0.145
Epoch: 3, | Train Acc: 0.9424 Vali Acc: 0.9118
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 0.138 Vali Loss: 0.132
Epoch: 4, | Train Acc: 0.9209 Vali Acc: 0.8824
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 0.130 Vali Loss: 0.154
Epoch: 5, | Train Acc: 0.9424 Vali Acc: 0.9706
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            8            4
True 1            0           22

Accuracy:0.882353
acc_clas_0:0.666667
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 0.152 Vali Loss: 0.110
Epoch: 1, | Train Acc: 0.8921 Vali Acc: 0.9118
Validation loss decreased (inf --> 0.110480).  Saving model ...
Epoch: 2, | Train Loss: 0.154 Vali Loss: 0.145
Epoch: 2, | Train Acc: 0.7914 Vali Acc: 0.9118
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 0.144 Vali Loss: 0.155
Epoch: 3, | Train Acc: 0.8921 Vali Acc: 0.9118
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 0.137 Vali Loss: 0.105
Epoch: 4, | Train Acc: 0.9568 Vali Acc: 0.9118
Validation loss decreased (0.110480 --> 0.105345).  Saving model ...
Epoch: 5, | Train Loss: 0.141 Vali Loss: 0.143
Epoch: 5, | Train Acc: 0.8129 Vali Acc: 0.9118
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 0.127 Vali Loss: 0.122
Epoch: 6, | Train Acc: 0.9496 Vali Acc: 0.9412
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 0.124 Vali Loss: 0.111
Epoch: 7, | Train Acc: 0.9640 Vali Acc: 0.9118
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 0.123 Vali Loss: 0.107
Epoch: 8, | Train Acc: 0.9353 Vali Acc: 0.9118
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           12            3
True 1            0           19

Accuracy:0.911765
acc_clas_0:0.800000
acc_clas_1:1.000000
total avg vali acc:0.764538  total avg vali acc_clas_0: 0.450196  total avg vali acc_clas_1: 1.000000
