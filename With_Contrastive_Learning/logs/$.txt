Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=0.125, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_0.125_pretrain_True_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.690 Vali Loss: 4.689
Epoch: 1, | Train Acc: 0.5435 Vali Acc: 0.3143
Validation loss decreased (inf --> 4.689173).  Saving model ...
Epoch: 2, | Train Loss: 5.669 Vali Loss: 4.712
Epoch: 2, | Train Acc: 0.6449 Vali Acc: 0.3429
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.597 Vali Loss: 4.690
Epoch: 3, | Train Acc: 0.6812 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.440 Vali Loss: 4.736
Epoch: 4, | Train Acc: 0.6739 Vali Acc: 0.6571
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.192 Vali Loss: 4.613
Epoch: 5, | Train Acc: 0.6812 Vali Acc: 0.6286
Validation loss decreased (4.689173 --> 4.612713).  Saving model ...
Epoch: 6, | Train Loss: 4.975 Vali Loss: 4.665
Epoch: 6, | Train Acc: 0.6232 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 4.905 Vali Loss: 4.749
Epoch: 7, | Train Acc: 0.5797 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 4.634 Vali Loss: 5.038
Epoch: 8, | Train Acc: 0.6159 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 4.502 Vali Loss: 5.145
Epoch: 9, | Train Acc: 0.5942 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           13
True 1            0           22

Accuracy:0.628571
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.226 Vali Loss: 4.561
Epoch: 1, | Train Acc: 0.6232 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.560514).  Saving model ...
Epoch: 2, | Train Loss: 4.994 Vali Loss: 4.632
Epoch: 2, | Train Acc: 0.6087 Vali Acc: 0.4571
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 4.807 Vali Loss: 3.909
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.6286
Validation loss decreased (4.560514 --> 3.909484).  Saving model ...
Epoch: 4, | Train Loss: 4.720 Vali Loss: 3.970
Epoch: 4, | Train Acc: 0.5507 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 4.538 Vali Loss: 4.114
Epoch: 5, | Train Acc: 0.5797 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 4.487 Vali Loss: 4.310
Epoch: 6, | Train Acc: 0.5507 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 4.454 Vali Loss: 4.466
Epoch: 7, | Train Acc: 0.5580 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           10            7
True 1            6           12

Accuracy:0.628571
acc_clas_0:0.588235
acc_clas_1:0.666667
Fold 3/5
Epoch: 1, | Train Loss: 4.776 Vali Loss: 3.936
Epoch: 1, | Train Acc: 0.5580 Vali Acc: 0.5714
Validation loss decreased (inf --> 3.936483).  Saving model ...
Epoch: 2, | Train Loss: 4.755 Vali Loss: 4.040
Epoch: 2, | Train Acc: 0.6304 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 4.579 Vali Loss: 3.976
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 4.497 Vali Loss: 3.595
Epoch: 4, | Train Acc: 0.5290 Vali Acc: 0.6286
Validation loss decreased (3.936483 --> 3.595021).  Saving model ...
Epoch: 5, | Train Loss: 4.426 Vali Loss: 3.681
Epoch: 5, | Train Acc: 0.5217 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 4.445 Vali Loss: 3.830
Epoch: 6, | Train Acc: 0.5580 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 4.456 Vali Loss: 4.046
Epoch: 7, | Train Acc: 0.5507 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 4.416 Vali Loss: 4.185
Epoch: 8, | Train Acc: 0.5290 Vali Acc: 0.6000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           11            7
True 1            6           11

Accuracy:0.628571
acc_clas_0:0.611111
acc_clas_1:0.647059
Fold 4/5
Epoch: 1, | Train Loss: 4.601 Vali Loss: 3.986
Epoch: 1, | Train Acc: 0.5755 Vali Acc: 0.4706
Validation loss decreased (inf --> 3.985692).  Saving model ...
Epoch: 2, | Train Loss: 4.604 Vali Loss: 4.167
Epoch: 2, | Train Acc: 0.5683 Vali Acc: 0.4412
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 4.579 Vali Loss: 3.822
Epoch: 3, | Train Acc: 0.5899 Vali Acc: 0.4412
Validation loss decreased (3.985692 --> 3.821918).  Saving model ...
Epoch: 4, | Train Loss: 4.494 Vali Loss: 3.022
Epoch: 4, | Train Acc: 0.5827 Vali Acc: 0.4706
Validation loss decreased (3.821918 --> 3.021534).  Saving model ...
Epoch: 5, | Train Loss: 4.501 Vali Loss: 3.543
Epoch: 5, | Train Acc: 0.5755 Vali Acc: 0.5000
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 4.473 Vali Loss: 4.137
Epoch: 6, | Train Acc: 0.5755 Vali Acc: 0.5000
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 4.345 Vali Loss: 3.995
Epoch: 7, | Train Acc: 0.5899 Vali Acc: 0.5000
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 4.318 Vali Loss: 3.877
Epoch: 8, | Train Acc: 0.5683 Vali Acc: 0.4412
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            5            7
True 1           11           11

Accuracy:0.470588
acc_clas_0:0.416667
acc_clas_1:0.500000
Fold 5/5
Epoch: 1, | Train Loss: 4.416 Vali Loss: 3.202
Epoch: 1, | Train Acc: 0.5540 Vali Acc: 0.6176
Validation loss decreased (inf --> 3.202294).  Saving model ...
Epoch: 2, | Train Loss: 4.704 Vali Loss: 3.088
Epoch: 2, | Train Acc: 0.5540 Vali Acc: 0.5588
Validation loss decreased (3.202294 --> 3.088173).  Saving model ...
Epoch: 3, | Train Loss: 4.488 Vali Loss: 4.078
Epoch: 3, | Train Acc: 0.5683 Vali Acc: 0.5882
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 4.413 Vali Loss: 3.539
Epoch: 4, | Train Acc: 0.5540 Vali Acc: 0.6176
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 4.330 Vali Loss: 4.010
Epoch: 5, | Train Acc: 0.5396 Vali Acc: 0.6471
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 4.318 Vali Loss: 3.540
Epoch: 6, | Train Acc: 0.5468 Vali Acc: 0.6471
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            5           10
True 1            5           14

Accuracy:0.558824
acc_clas_0:0.333333
acc_clas_1:0.736842
total avg vali acc:0.583025  total avg vali acc_clas_0: 0.389869  total avg vali acc_clas_1: 0.710114
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=0.125, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_0.125_pretrain_True_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.683 Vali Loss: 4.687
Epoch: 1, | Train Acc: 0.5942 Vali Acc: 0.5429
Validation loss decreased (inf --> 4.686885).  Saving model ...
Epoch: 2, | Train Loss: 5.662 Vali Loss: 4.680
Epoch: 2, | Train Acc: 0.6014 Vali Acc: 0.5429
Validation loss decreased (4.686885 --> 4.680077).  Saving model ...
Epoch: 3, | Train Loss: 5.611 Vali Loss: 4.668
Epoch: 3, | Train Acc: 0.7174 Vali Acc: 0.5429
Validation loss decreased (4.680077 --> 4.667525).  Saving model ...
Epoch: 4, | Train Loss: 5.538 Vali Loss: 4.716
Epoch: 4, | Train Acc: 0.8043 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.416 Vali Loss: 4.692
Epoch: 5, | Train Acc: 0.7899 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.309 Vali Loss: 4.647
Epoch: 6, | Train Acc: 0.7174 Vali Acc: 0.6571
Validation loss decreased (4.667525 --> 4.647194).  Saving model ...
Epoch: 7, | Train Loss: 5.170 Vali Loss: 4.725
Epoch: 7, | Train Acc: 0.7174 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 4.968 Vali Loss: 4.682
Epoch: 8, | Train Acc: 0.6739 Vali Acc: 0.6857
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 4.765 Vali Loss: 4.788
Epoch: 9, | Train Acc: 0.6377 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 4.684 Vali Loss: 4.835
Epoch: 10, | Train Acc: 0.6739 Vali Acc: 0.6857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            9            7
True 1            5           14

Accuracy:0.657143
acc_clas_0:0.562500
acc_clas_1:0.736842
Fold 2/5
Epoch: 1, | Train Loss: 5.363 Vali Loss: 4.114
Epoch: 1, | Train Acc: 0.6667 Vali Acc: 0.7714
Validation loss decreased (inf --> 4.114389).  Saving model ...
Epoch: 2, | Train Loss: 5.161 Vali Loss: 4.552
Epoch: 2, | Train Acc: 0.6884 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.035 Vali Loss: 4.489
Epoch: 3, | Train Acc: 0.6449 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 4.872 Vali Loss: 4.457
Epoch: 4, | Train Acc: 0.6884 Vali Acc: 0.7143
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 4.672 Vali Loss: 4.156
Epoch: 5, | Train Acc: 0.6667 Vali Acc: 0.7429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           14            2
True 1            6           13

Accuracy:0.771429
acc_clas_0:0.875000
acc_clas_1:0.684211
Fold 3/5
Epoch: 1, | Train Loss: 5.316 Vali Loss: 4.443
Epoch: 1, | Train Acc: 0.6667 Vali Acc: 0.4857
Validation loss decreased (inf --> 4.442583).  Saving model ...
Epoch: 2, | Train Loss: 5.113 Vali Loss: 4.285
Epoch: 2, | Train Acc: 0.6522 Vali Acc: 0.7429
Validation loss decreased (4.442583 --> 4.284597).  Saving model ...
Epoch: 3, | Train Loss: 4.967 Vali Loss: 4.238
Epoch: 3, | Train Acc: 0.6739 Vali Acc: 0.6000
Validation loss decreased (4.284597 --> 4.238285).  Saving model ...
Epoch: 4, | Train Loss: 4.775 Vali Loss: 4.456
Epoch: 4, | Train Acc: 0.6377 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 4.669 Vali Loss: 4.461
Epoch: 5, | Train Acc: 0.6014 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 4.530 Vali Loss: 4.304
Epoch: 6, | Train Acc: 0.6304 Vali Acc: 0.6571
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 4.519 Vali Loss: 4.250
Epoch: 7, | Train Acc: 0.5942 Vali Acc: 0.7143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           10            5
True 1            9           11

Accuracy:0.600000
acc_clas_0:0.666667
acc_clas_1:0.550000
Fold 4/5
Epoch: 1, | Train Loss: 4.919 Vali Loss: 3.960
Epoch: 1, | Train Acc: 0.6835 Vali Acc: 0.6176
Validation loss decreased (inf --> 3.959795).  Saving model ...
Epoch: 2, | Train Loss: 4.788 Vali Loss: 4.014
Epoch: 2, | Train Acc: 0.6331 Vali Acc: 0.7059
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 4.657 Vali Loss: 4.241
Epoch: 3, | Train Acc: 0.6835 Vali Acc: 0.7353
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 4.683 Vali Loss: 3.679
Epoch: 4, | Train Acc: 0.6475 Vali Acc: 0.6765
Validation loss decreased (3.959795 --> 3.678751).  Saving model ...
Epoch: 5, | Train Loss: 4.473 Vali Loss: 3.479
Epoch: 5, | Train Acc: 0.6475 Vali Acc: 0.6176
Validation loss decreased (3.678751 --> 3.479179).  Saving model ...
Epoch: 6, | Train Loss: 4.550 Vali Loss: 3.866
Epoch: 6, | Train Acc: 0.6403 Vali Acc: 0.5588
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 4.389 Vali Loss: 3.560
Epoch: 7, | Train Acc: 0.6259 Vali Acc: 0.6176
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 4.330 Vali Loss: 3.899
Epoch: 8, | Train Acc: 0.6331 Vali Acc: 0.6176
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 4.272 Vali Loss: 3.856
Epoch: 9, | Train Acc: 0.6403 Vali Acc: 0.5882
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            8            7
True 1            6           13

Accuracy:0.617647
acc_clas_0:0.533333
acc_clas_1:0.684211
Fold 5/5
Epoch: 1, | Train Loss: 4.595 Vali Loss: 3.958
Epoch: 1, | Train Acc: 0.6403 Vali Acc: 0.5882
Validation loss decreased (inf --> 3.957840).  Saving model ...
Epoch: 2, | Train Loss: 4.513 Vali Loss: 3.792
Epoch: 2, | Train Acc: 0.6763 Vali Acc: 0.5882
Validation loss decreased (3.957840 --> 3.791534).  Saving model ...
Epoch: 3, | Train Loss: 4.366 Vali Loss: 3.173
Epoch: 3, | Train Acc: 0.6403 Vali Acc: 0.5588
Validation loss decreased (3.791534 --> 3.172811).  Saving model ...
Epoch: 4, | Train Loss: 4.349 Vali Loss: 3.133
Epoch: 4, | Train Acc: 0.6763 Vali Acc: 0.5882
Validation loss decreased (3.172811 --> 3.132905).  Saving model ...
Epoch: 5, | Train Loss: 4.256 Vali Loss: 3.767
Epoch: 5, | Train Acc: 0.6475 Vali Acc: 0.5882
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 4.282 Vali Loss: 3.897
Epoch: 6, | Train Acc: 0.6547 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 4.272 Vali Loss: 3.443
Epoch: 7, | Train Acc: 0.6403 Vali Acc: 0.5588
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 4.249 Vali Loss: 3.101
Epoch: 8, | Train Acc: 0.6403 Vali Acc: 0.5294
Validation loss decreased (3.132905 --> 3.101207).  Saving model ...
Epoch: 9, | Train Loss: 4.304 Vali Loss: 4.174
Epoch: 9, | Train Acc: 0.6475 Vali Acc: 0.5588
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 4.236 Vali Loss: 3.715
Epoch: 10, | Train Acc: 0.6475 Vali Acc: 0.5294
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 4.197 Vali Loss: 3.758
Epoch: 11, | Train Acc: 0.6403 Vali Acc: 0.5588
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 4.236 Vali Loss: 3.422
Epoch: 12, | Train Acc: 0.6259 Vali Acc: 0.5882
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            8            5
True 1           11           10

Accuracy:0.529412
acc_clas_0:0.615385
acc_clas_1:0.476190
total avg vali acc:0.635126  total avg vali acc_clas_0: 0.650577  total avg vali acc_clas_1: 0.626291
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=0.125, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_0.125_pretrain_False_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.690 Vali Loss: 4.676
Epoch: 1, | Train Acc: 0.5000 Vali Acc: 0.6571
Validation loss decreased (inf --> 4.675643).  Saving model ...
Epoch: 2, | Train Loss: 5.688 Vali Loss: 4.676
Epoch: 2, | Train Acc: 0.5435 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.676 Vali Loss: 4.701
Epoch: 3, | Train Acc: 0.5652 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.656 Vali Loss: 4.716
Epoch: 4, | Train Acc: 0.5725 Vali Acc: 0.3429
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.633 Vali Loss: 4.758
Epoch: 5, | Train Acc: 0.5725 Vali Acc: 0.3429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           11
True 1            1           22

Accuracy:0.657143
acc_clas_0:0.083333
acc_clas_1:0.956522
Fold 2/5
Epoch: 1, | Train Loss: 5.688 Vali Loss: 4.675
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.675359).  Saving model ...
Epoch: 2, | Train Loss: 5.683 Vali Loss: 4.676
Epoch: 2, | Train Acc: 0.5580 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.665 Vali Loss: 4.692
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.647 Vali Loss: 4.688
Epoch: 4, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.614 Vali Loss: 4.757
Epoch: 5, | Train Acc: 0.5797 Vali Acc: 0.6000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           15
True 1            0           20

Accuracy:0.571429
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.684 Vali Loss: 4.695
Epoch: 1, | Train Acc: 0.5942 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.695330).  Saving model ...
Epoch: 2, | Train Loss: 5.671 Vali Loss: 4.690
Epoch: 2, | Train Acc: 0.6014 Vali Acc: 0.5143
Validation loss decreased (4.695330 --> 4.689514).  Saving model ...
Epoch: 3, | Train Loss: 5.650 Vali Loss: 4.814
Epoch: 3, | Train Acc: 0.6014 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.625 Vali Loss: 4.744
Epoch: 4, | Train Acc: 0.5942 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.587 Vali Loss: 4.788
Epoch: 5, | Train Acc: 0.6014 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.529 Vali Loss: 4.802
Epoch: 6, | Train Acc: 0.6014 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           16
True 1            1           16

Accuracy:0.514286
acc_clas_0:0.111111
acc_clas_1:0.941176
Fold 4/5
Epoch: 1, | Train Loss: 5.696 Vali Loss: 4.398
Epoch: 1, | Train Acc: 0.5612 Vali Acc: 0.4706
Validation loss decreased (inf --> 4.397941).  Saving model ...
Epoch: 2, | Train Loss: 5.673 Vali Loss: 4.401
Epoch: 2, | Train Acc: 0.5827 Vali Acc: 0.7059
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.645 Vali Loss: 4.426
Epoch: 3, | Train Acc: 0.5755 Vali Acc: 0.4412
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.614 Vali Loss: 4.364
Epoch: 4, | Train Acc: 0.5755 Vali Acc: 0.5882
Validation loss decreased (4.397941 --> 4.363899).  Saving model ...
Epoch: 5, | Train Loss: 5.553 Vali Loss: 4.379
Epoch: 5, | Train Acc: 0.5468 Vali Acc: 0.6471
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.492 Vali Loss: 4.381
Epoch: 6, | Train Acc: 0.5827 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.463 Vali Loss: 4.366
Epoch: 7, | Train Acc: 0.5540 Vali Acc: 0.5882
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.390 Vali Loss: 4.426
Epoch: 8, | Train Acc: 0.5755 Vali Acc: 0.5882
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           14
True 1            0           19

Accuracy:0.588235
acc_clas_0:0.066667
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.610 Vali Loss: 4.110
Epoch: 1, | Train Acc: 0.5755 Vali Acc: 0.5882
Validation loss decreased (inf --> 4.110230).  Saving model ...
Epoch: 2, | Train Loss: 5.566 Vali Loss: 4.428
Epoch: 2, | Train Acc: 0.5827 Vali Acc: 0.5000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.536 Vali Loss: 4.624
Epoch: 3, | Train Acc: 0.5827 Vali Acc: 0.4412
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.461 Vali Loss: 4.475
Epoch: 4, | Train Acc: 0.5971 Vali Acc: 0.4412
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.412 Vali Loss: 4.335
Epoch: 5, | Train Acc: 0.6187 Vali Acc: 0.5588
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           13
True 1            1           18

Accuracy:0.588235
acc_clas_0:0.133333
acc_clas_1:0.947368
total avg vali acc:0.583866  total avg vali acc_clas_0: 0.078889  total avg vali acc_clas_1: 0.969013
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=0.125, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_0.125_pretrain_False_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.683 Vali Loss: 4.720
Epoch: 1, | Train Acc: 0.6232 Vali Acc: 0.3429
Validation loss decreased (inf --> 4.719782).  Saving model ...
Epoch: 2, | Train Loss: 5.675 Vali Loss: 4.694
Epoch: 2, | Train Acc: 0.6232 Vali Acc: 0.3429
Validation loss decreased (4.719782 --> 4.694380).  Saving model ...
Epoch: 3, | Train Loss: 5.670 Vali Loss: 4.701
Epoch: 3, | Train Acc: 0.6232 Vali Acc: 0.3429
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.667 Vali Loss: 4.732
Epoch: 4, | Train Acc: 0.6232 Vali Acc: 0.3429
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.654 Vali Loss: 4.716
Epoch: 5, | Train Acc: 0.6377 Vali Acc: 0.3429
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.641 Vali Loss: 4.681
Epoch: 6, | Train Acc: 0.6522 Vali Acc: 0.3714
Validation loss decreased (4.694380 --> 4.681014).  Saving model ...
Epoch: 7, | Train Loss: 5.624 Vali Loss: 4.746
Epoch: 7, | Train Acc: 0.6522 Vali Acc: 0.3143
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.599 Vali Loss: 4.714
Epoch: 8, | Train Acc: 0.6449 Vali Acc: 0.3429
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.566 Vali Loss: 4.785
Epoch: 9, | Train Acc: 0.6522 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.536 Vali Loss: 4.825
Epoch: 10, | Train Acc: 0.6739 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           22
True 1            0           12

Accuracy:0.371429
acc_clas_0:0.043478
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.650 Vali Loss: 4.700
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.3143
Validation loss decreased (inf --> 4.699811).  Saving model ...
Epoch: 2, | Train Loss: 5.629 Vali Loss: 4.666
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.6571
Validation loss decreased (4.699811 --> 4.665776).  Saving model ...
Epoch: 3, | Train Loss: 5.599 Vali Loss: 4.698
Epoch: 3, | Train Acc: 0.5580 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.580 Vali Loss: 4.694
Epoch: 4, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.572 Vali Loss: 4.725
Epoch: 5, | Train Acc: 0.6087 Vali Acc: 0.3143
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.521 Vali Loss: 4.683
Epoch: 6, | Train Acc: 0.6377 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           11
True 1            1           23

Accuracy:0.657143
acc_clas_0:0.000000
acc_clas_1:0.958333
Fold 3/5
Epoch: 1, | Train Loss: 5.651 Vali Loss: 4.651
Epoch: 1, | Train Acc: 0.5290 Vali Acc: 0.4000
Validation loss decreased (inf --> 4.650654).  Saving model ...
Epoch: 2, | Train Loss: 5.624 Vali Loss: 4.636
Epoch: 2, | Train Acc: 0.5435 Vali Acc: 0.6857
Validation loss decreased (4.650654 --> 4.635995).  Saving model ...
Epoch: 3, | Train Loss: 5.596 Vali Loss: 4.506
Epoch: 3, | Train Acc: 0.5507 Vali Acc: 0.8286
Validation loss decreased (4.635995 --> 4.506417).  Saving model ...
Epoch: 4, | Train Loss: 5.581 Vali Loss: 4.941
Epoch: 4, | Train Acc: 0.5580 Vali Acc: 0.3714
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.563 Vali Loss: 4.543
Epoch: 5, | Train Acc: 0.5580 Vali Acc: 0.8571
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.542 Vali Loss: 4.577
Epoch: 6, | Train Acc: 0.5725 Vali Acc: 0.6857
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.498 Vali Loss: 4.570
Epoch: 7, | Train Acc: 0.5725 Vali Acc: 0.8000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            9            4
True 1            2           20

Accuracy:0.828571
acc_clas_0:0.692308
acc_clas_1:0.909091
Fold 4/5
Epoch: 1, | Train Loss: 5.613 Vali Loss: 4.704
Epoch: 1, | Train Acc: 0.5683 Vali Acc: 0.3235
Validation loss decreased (inf --> 4.703679).  Saving model ...
Epoch: 2, | Train Loss: 5.600 Vali Loss: 4.868
Epoch: 2, | Train Acc: 0.5683 Vali Acc: 0.3235
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.548 Vali Loss: 4.689
Epoch: 3, | Train Acc: 0.6043 Vali Acc: 0.3235
Validation loss decreased (4.703679 --> 4.688509).  Saving model ...
Epoch: 4, | Train Loss: 5.528 Vali Loss: 4.340
Epoch: 4, | Train Acc: 0.6475 Vali Acc: 0.7353
Validation loss decreased (4.688509 --> 4.340294).  Saving model ...
Epoch: 5, | Train Loss: 5.517 Vali Loss: 4.270
Epoch: 5, | Train Acc: 0.5827 Vali Acc: 0.6765
Validation loss decreased (4.340294 --> 4.270324).  Saving model ...
Epoch: 6, | Train Loss: 5.502 Vali Loss: 4.412
Epoch: 6, | Train Acc: 0.5755 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.472 Vali Loss: 4.295
Epoch: 7, | Train Acc: 0.5827 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.417 Vali Loss: 4.248
Epoch: 8, | Train Acc: 0.5971 Vali Acc: 0.6765
Validation loss decreased (4.270324 --> 4.247527).  Saving model ...
Epoch: 9, | Train Loss: 5.433 Vali Loss: 4.243
Epoch: 9, | Train Acc: 0.5827 Vali Acc: 0.6471
Validation loss decreased (4.247527 --> 4.243068).  Saving model ...
Epoch: 10, | Train Loss: 5.398 Vali Loss: 4.488
Epoch: 10, | Train Acc: 0.5612 Vali Acc: 0.5294
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.347 Vali Loss: 4.497
Epoch: 11, | Train Acc: 0.5899 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 5.346 Vali Loss: 4.331
Epoch: 12, | Train Acc: 0.5971 Vali Acc: 0.6765
EarlyStopping counter: 3 out of 4
Epoch: 13, | Train Loss: 5.323 Vali Loss: 4.591
Epoch: 13, | Train Acc: 0.5899 Vali Acc: 0.6176
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           10
True 1            2           21

Accuracy:0.647059
acc_clas_0:0.090909
acc_clas_1:0.913043
Fold 5/5
Epoch: 1, | Train Loss: 5.443 Vali Loss: 4.822
Epoch: 1, | Train Acc: 0.6403 Vali Acc: 0.5000
Validation loss decreased (inf --> 4.821608).  Saving model ...
Epoch: 2, | Train Loss: 5.389 Vali Loss: 4.773
Epoch: 2, | Train Acc: 0.6115 Vali Acc: 0.5000
Validation loss decreased (4.821608 --> 4.773091).  Saving model ...
Epoch: 3, | Train Loss: 5.355 Vali Loss: 4.288
Epoch: 3, | Train Acc: 0.6115 Vali Acc: 0.5588
Validation loss decreased (4.773091 --> 4.287667).  Saving model ...
Epoch: 4, | Train Loss: 5.404 Vali Loss: 4.187
Epoch: 4, | Train Acc: 0.5827 Vali Acc: 0.6176
Validation loss decreased (4.287667 --> 4.187050).  Saving model ...
Epoch: 5, | Train Loss: 5.320 Vali Loss: 4.308
Epoch: 5, | Train Acc: 0.6043 Vali Acc: 0.6471
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.288 Vali Loss: 4.556
Epoch: 6, | Train Acc: 0.5899 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.319 Vali Loss: 4.457
Epoch: 7, | Train Acc: 0.5899 Vali Acc: 0.6471
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.296 Vali Loss: 4.297
Epoch: 8, | Train Acc: 0.6043 Vali Acc: 0.5294
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            5           12
True 1            1           16

Accuracy:0.617647
acc_clas_0:0.294118
acc_clas_1:0.941176
total avg vali acc:0.624370  total avg vali acc_clas_0: 0.224163  total avg vali acc_clas_1: 0.944329
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=0.125, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_0.125_pretrain_True_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.712 Vali Loss: 4.727
Epoch: 1, | Train Acc: 0.5217 Vali Acc: 0.4857
Validation loss decreased (inf --> 4.726616).  Saving model ...
Epoch: 2, | Train Loss: 5.693 Vali Loss: 4.684
Epoch: 2, | Train Acc: 0.5870 Vali Acc: 0.4857
Validation loss decreased (4.726616 --> 4.683978).  Saving model ...
Epoch: 3, | Train Loss: 5.687 Vali Loss: 4.680
Epoch: 3, | Train Acc: 0.5797 Vali Acc: 0.4857
Validation loss decreased (4.683978 --> 4.680269).  Saving model ...
Epoch: 4, | Train Loss: 5.690 Vali Loss: 4.722
Epoch: 4, | Train Acc: 0.5072 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.687 Vali Loss: 4.704
Epoch: 5, | Train Acc: 0.5870 Vali Acc: 0.4857
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.680 Vali Loss: 4.684
Epoch: 6, | Train Acc: 0.5870 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.669 Vali Loss: 4.686
Epoch: 7, | Train Acc: 0.6087 Vali Acc: 0.4857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           18
True 1            0           17

Accuracy:0.485714
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.714 Vali Loss: 4.647
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.647112).  Saving model ...
Epoch: 2, | Train Loss: 5.693 Vali Loss: 4.687
Epoch: 2, | Train Acc: 0.5290 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.687 Vali Loss: 4.679
Epoch: 3, | Train Acc: 0.5652 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.692 Vali Loss: 4.671
Epoch: 4, | Train Acc: 0.5290 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.680 Vali Loss: 4.670
Epoch: 5, | Train Acc: 0.5652 Vali Acc: 0.5714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           15
True 1            0           20

Accuracy:0.571429
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.704 Vali Loss: 4.653
Epoch: 1, | Train Acc: 0.4710 Vali Acc: 0.6571
Validation loss decreased (inf --> 4.653253).  Saving model ...
Epoch: 2, | Train Loss: 5.688 Vali Loss: 4.666
Epoch: 2, | Train Acc: 0.5507 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.680 Vali Loss: 4.640
Epoch: 3, | Train Acc: 0.5652 Vali Acc: 0.6286
Validation loss decreased (4.653253 --> 4.639949).  Saving model ...
Epoch: 4, | Train Loss: 5.660 Vali Loss: 4.633
Epoch: 4, | Train Acc: 0.5580 Vali Acc: 0.6286
Validation loss decreased (4.639949 --> 4.632625).  Saving model ...
Epoch: 5, | Train Loss: 5.655 Vali Loss: 4.630
Epoch: 5, | Train Acc: 0.5652 Vali Acc: 0.6286
Validation loss decreased (4.632625 --> 4.629573).  Saving model ...
Epoch: 6, | Train Loss: 5.596 Vali Loss: 4.638
Epoch: 6, | Train Acc: 0.5652 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.551 Vali Loss: 4.631
Epoch: 7, | Train Acc: 0.5652 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.506 Vali Loss: 4.570
Epoch: 8, | Train Acc: 0.5652 Vali Acc: 0.6286
Validation loss decreased (4.629573 --> 4.570140).  Saving model ...
Epoch: 9, | Train Loss: 5.500 Vali Loss: 4.656
Epoch: 9, | Train Acc: 0.5652 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.476 Vali Loss: 4.643
Epoch: 10, | Train Acc: 0.5652 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.453 Vali Loss: 4.607
Epoch: 11, | Train Acc: 0.5652 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.436 Vali Loss: 4.659
Epoch: 12, | Train Acc: 0.5652 Vali Acc: 0.6286
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           11
True 1            2           21

Accuracy:0.628571
acc_clas_0:0.083333
acc_clas_1:0.913043
Fold 4/5
Epoch: 1, | Train Loss: 5.586 Vali Loss: 4.256
Epoch: 1, | Train Acc: 0.5540 Vali Acc: 0.6765
Validation loss decreased (inf --> 4.255984).  Saving model ...
Epoch: 2, | Train Loss: 5.662 Vali Loss: 4.170
Epoch: 2, | Train Acc: 0.5540 Vali Acc: 0.6765
Validation loss decreased (4.255984 --> 4.169842).  Saving model ...
Epoch: 3, | Train Loss: 5.551 Vali Loss: 4.147
Epoch: 3, | Train Acc: 0.5540 Vali Acc: 0.6765
Validation loss decreased (4.169842 --> 4.146649).  Saving model ...
Epoch: 4, | Train Loss: 5.503 Vali Loss: 3.825
Epoch: 4, | Train Acc: 0.5540 Vali Acc: 0.6765
Validation loss decreased (4.146649 --> 3.824631).  Saving model ...
Epoch: 5, | Train Loss: 5.489 Vali Loss: 4.278
Epoch: 5, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.468 Vali Loss: 3.867
Epoch: 6, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.471 Vali Loss: 4.184
Epoch: 7, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.474 Vali Loss: 4.205
Epoch: 8, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           11
True 1            0           21

Accuracy:0.676471
acc_clas_0:0.153846
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.582 Vali Loss: 4.096
Epoch: 1, | Train Acc: 0.5899 Vali Acc: 0.5294
Validation loss decreased (inf --> 4.095895).  Saving model ...
Epoch: 2, | Train Loss: 5.512 Vali Loss: 4.265
Epoch: 2, | Train Acc: 0.5899 Vali Acc: 0.5294
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.496 Vali Loss: 3.901
Epoch: 3, | Train Acc: 0.5899 Vali Acc: 0.5294
Validation loss decreased (4.095895 --> 3.900860).  Saving model ...
Epoch: 4, | Train Loss: 5.492 Vali Loss: 4.069
Epoch: 4, | Train Acc: 0.5899 Vali Acc: 0.5294
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.481 Vali Loss: 4.128
Epoch: 5, | Train Acc: 0.5899 Vali Acc: 0.5294
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.493 Vali Loss: 4.187
Epoch: 6, | Train Acc: 0.5899 Vali Acc: 0.5294
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.499 Vali Loss: 4.126
Epoch: 7, | Train Acc: 0.5899 Vali Acc: 0.5294
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           15
True 1            1           16

Accuracy:0.529412
acc_clas_0:0.117647
acc_clas_1:0.941176
total avg vali acc:0.578319  total avg vali acc_clas_0: 0.070965  total avg vali acc_clas_1: 0.970844
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=0.125, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_0.125_pretrain_True_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.690 Vali Loss: 4.678
Epoch: 1, | Train Acc: 0.5217 Vali Acc: 0.4286
Validation loss decreased (inf --> 4.678007).  Saving model ...
Epoch: 2, | Train Loss: 5.693 Vali Loss: 4.660
Epoch: 2, | Train Acc: 0.5652 Vali Acc: 0.6000
Validation loss decreased (4.678007 --> 4.660419).  Saving model ...
Epoch: 3, | Train Loss: 5.666 Vali Loss: 4.649
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.4857
Validation loss decreased (4.660419 --> 4.649099).  Saving model ...
Epoch: 4, | Train Loss: 5.666 Vali Loss: 4.654
Epoch: 4, | Train Acc: 0.5580 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.613 Vali Loss: 4.664
Epoch: 5, | Train Acc: 0.5652 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.557 Vali Loss: 4.661
Epoch: 6, | Train Acc: 0.5942 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.513 Vali Loss: 4.613
Epoch: 7, | Train Acc: 0.5797 Vali Acc: 0.5429
Validation loss decreased (4.649099 --> 4.612862).  Saving model ...
Epoch: 8, | Train Loss: 5.366 Vali Loss: 4.651
Epoch: 8, | Train Acc: 0.5652 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.428 Vali Loss: 4.739
Epoch: 9, | Train Acc: 0.6232 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.756 Vali Loss: 4.750
Epoch: 10, | Train Acc: 0.5797 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.739 Vali Loss: 4.768
Epoch: 11, | Train Acc: 0.5652 Vali Acc: 0.6000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           14
True 1            2           19

Accuracy:0.542857
acc_clas_0:0.000000
acc_clas_1:0.904762
Fold 2/5
Epoch: 1, | Train Loss: 5.551 Vali Loss: 4.588
Epoch: 1, | Train Acc: 0.5435 Vali Acc: 0.6571
Validation loss decreased (inf --> 4.587554).  Saving model ...
Epoch: 2, | Train Loss: 5.502 Vali Loss: 4.566
Epoch: 2, | Train Acc: 0.5580 Vali Acc: 0.5714
Validation loss decreased (4.587554 --> 4.565815).  Saving model ...
Epoch: 3, | Train Loss: 5.448 Vali Loss: 4.575
Epoch: 3, | Train Acc: 0.5145 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.394 Vali Loss: 4.440
Epoch: 4, | Train Acc: 0.5580 Vali Acc: 0.5714
Validation loss decreased (4.565815 --> 4.440497).  Saving model ...
Epoch: 5, | Train Loss: 5.184 Vali Loss: 4.429
Epoch: 5, | Train Acc: 0.5362 Vali Acc: 0.6000
Validation loss decreased (4.440497 --> 4.428854).  Saving model ...
Epoch: 6, | Train Loss: 5.071 Vali Loss: 4.139
Epoch: 6, | Train Acc: 0.5145 Vali Acc: 0.6000
Validation loss decreased (4.428854 --> 4.139404).  Saving model ...
Epoch: 7, | Train Loss: 4.845 Vali Loss: 4.348
Epoch: 7, | Train Acc: 0.5290 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 4.713 Vali Loss: 4.425
Epoch: 8, | Train Acc: 0.5145 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 4.574 Vali Loss: 4.038
Epoch: 9, | Train Acc: 0.5000 Vali Acc: 0.6000
Validation loss decreased (4.139404 --> 4.038131).  Saving model ...
Epoch: 10, | Train Loss: 4.456 Vali Loss: 3.936
Epoch: 10, | Train Acc: 0.5145 Vali Acc: 0.5429
Validation loss decreased (4.038131 --> 3.935962).  Saving model ...
Epoch: 11, | Train Loss: 4.447 Vali Loss: 4.520
Epoch: 11, | Train Acc: 0.5145 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 12, | Train Loss: 4.323 Vali Loss: 4.379
Epoch: 12, | Train Acc: 0.5145 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 13, | Train Loss: 4.350 Vali Loss: 4.454
Epoch: 13, | Train Acc: 0.4928 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 14, | Train Loss: 4.341 Vali Loss: 4.446
Epoch: 14, | Train Acc: 0.5217 Vali Acc: 0.5714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            4            8
True 1            8           15

Accuracy:0.542857
acc_clas_0:0.333333
acc_clas_1:0.652174
Fold 3/5
Epoch: 1, | Train Loss: 5.022 Vali Loss: 3.260
Epoch: 1, | Train Acc: 0.5290 Vali Acc: 0.5429
Validation loss decreased (inf --> 3.260060).  Saving model ...
Epoch: 2, | Train Loss: 4.640 Vali Loss: 3.709
Epoch: 2, | Train Acc: 0.5217 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 4.518 Vali Loss: 3.583
Epoch: 3, | Train Acc: 0.5072 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 4.440 Vali Loss: 3.702
Epoch: 4, | Train Acc: 0.5217 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 4.500 Vali Loss: 3.473
Epoch: 5, | Train Acc: 0.5145 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            6           10
True 1            6           13

Accuracy:0.542857
acc_clas_0:0.375000
acc_clas_1:0.684211
Fold 4/5
Epoch: 1, | Train Loss: 4.936 Vali Loss: 3.058
Epoch: 1, | Train Acc: 0.5540 Vali Acc: 0.4412
Validation loss decreased (inf --> 3.058315).  Saving model ...
Epoch: 2, | Train Loss: 4.761 Vali Loss: 3.691
Epoch: 2, | Train Acc: 0.5252 Vali Acc: 0.4412
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 4.716 Vali Loss: 3.538
Epoch: 3, | Train Acc: 0.5827 Vali Acc: 0.4706
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 4.461 Vali Loss: 3.116
Epoch: 4, | Train Acc: 0.5468 Vali Acc: 0.4412
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 4.458 Vali Loss: 3.597
Epoch: 5, | Train Acc: 0.5612 Vali Acc: 0.4412
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            7           10
True 1            9            8

Accuracy:0.441176
acc_clas_0:0.411765
acc_clas_1:0.470588
Fold 5/5
Epoch: 1, | Train Loss: 4.719 Vali Loss: 4.031
Epoch: 1, | Train Acc: 0.5324 Vali Acc: 0.4706
Validation loss decreased (inf --> 4.031370).  Saving model ...
Epoch: 2, | Train Loss: 4.977 Vali Loss: 3.418
Epoch: 2, | Train Acc: 0.5324 Vali Acc: 0.5000
Validation loss decreased (4.031370 --> 3.417939).  Saving model ...
Epoch: 3, | Train Loss: 4.851 Vali Loss: 3.863
Epoch: 3, | Train Acc: 0.5540 Vali Acc: 0.5000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 4.555 Vali Loss: 3.462
Epoch: 4, | Train Acc: 0.5396 Vali Acc: 0.4706
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 4.632 Vali Loss: 3.823
Epoch: 5, | Train Acc: 0.5612 Vali Acc: 0.5294
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 4.515 Vali Loss: 3.647
Epoch: 6, | Train Acc: 0.5468 Vali Acc: 0.4412
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            7            9
True 1            8           10

Accuracy:0.500000
acc_clas_0:0.437500
acc_clas_1:0.555556
total avg vali acc:0.513950  total avg vali acc_clas_0: 0.311520  total avg vali acc_clas_1: 0.653458
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=0.125, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_0.125_pretrain_False_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.713 Vali Loss: 4.683
Epoch: 1, | Train Acc: 0.5580 Vali Acc: 0.5429
Validation loss decreased (inf --> 4.683108).  Saving model ...
Epoch: 2, | Train Loss: 5.688 Vali Loss: 4.683
Epoch: 2, | Train Acc: 0.5652 Vali Acc: 0.4571
Validation loss decreased (4.683108 --> 4.682563).  Saving model ...
Epoch: 3, | Train Loss: 5.699 Vali Loss: 4.705
Epoch: 3, | Train Acc: 0.5145 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.692 Vali Loss: 4.677
Epoch: 4, | Train Acc: 0.4710 Vali Acc: 0.5143
Validation loss decreased (4.682563 --> 4.676999).  Saving model ...
Epoch: 5, | Train Loss: 5.684 Vali Loss: 4.652
Epoch: 5, | Train Acc: 0.6014 Vali Acc: 0.5429
Validation loss decreased (4.676999 --> 4.651954).  Saving model ...
Epoch: 6, | Train Loss: 5.680 Vali Loss: 4.675
Epoch: 6, | Train Acc: 0.5797 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.679 Vali Loss: 4.678
Epoch: 7, | Train Acc: 0.6739 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.677 Vali Loss: 4.670
Epoch: 8, | Train Acc: 0.5797 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.678 Vali Loss: 4.675
Epoch: 9, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           16
True 1            0           19

Accuracy:0.542857
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.699 Vali Loss: 4.665
Epoch: 1, | Train Acc: 0.5362 Vali Acc: 0.6286
Validation loss decreased (inf --> 4.665453).  Saving model ...
Epoch: 2, | Train Loss: 5.682 Vali Loss: 4.700
Epoch: 2, | Train Acc: 0.5652 Vali Acc: 0.4000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.682 Vali Loss: 4.689
Epoch: 3, | Train Acc: 0.5652 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.642 Vali Loss: 4.671
Epoch: 4, | Train Acc: 0.5797 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.603 Vali Loss: 4.741
Epoch: 5, | Train Acc: 0.5725 Vali Acc: 0.5714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           13
True 1            0           22

Accuracy:0.628571
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.692 Vali Loss: 4.687
Epoch: 1, | Train Acc: 0.5870 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.686741).  Saving model ...
Epoch: 2, | Train Loss: 5.686 Vali Loss: 4.673
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.5143
Validation loss decreased (4.686741 --> 4.673428).  Saving model ...
Epoch: 3, | Train Loss: 5.665 Vali Loss: 4.697
Epoch: 3, | Train Acc: 0.6014 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.651 Vali Loss: 4.729
Epoch: 4, | Train Acc: 0.5942 Vali Acc: 0.4857
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.644 Vali Loss: 4.699
Epoch: 5, | Train Acc: 0.6014 Vali Acc: 0.4857
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.585 Vali Loss: 4.729
Epoch: 6, | Train Acc: 0.6014 Vali Acc: 0.4857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           17
True 1            0           18

Accuracy:0.514286
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.710 Vali Loss: 4.437
Epoch: 1, | Train Acc: 0.5755 Vali Acc: 0.5294
Validation loss decreased (inf --> 4.436811).  Saving model ...
Epoch: 2, | Train Loss: 5.688 Vali Loss: 4.401
Epoch: 2, | Train Acc: 0.5755 Vali Acc: 0.5882
Validation loss decreased (4.436811 --> 4.401432).  Saving model ...
Epoch: 3, | Train Loss: 5.695 Vali Loss: 4.329
Epoch: 3, | Train Acc: 0.5683 Vali Acc: 0.5882
Validation loss decreased (4.401432 --> 4.329008).  Saving model ...
Epoch: 4, | Train Loss: 5.653 Vali Loss: 4.403
Epoch: 4, | Train Acc: 0.5755 Vali Acc: 0.5882
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.603 Vali Loss: 4.407
Epoch: 5, | Train Acc: 0.5683 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.547 Vali Loss: 4.188
Epoch: 6, | Train Acc: 0.5755 Vali Acc: 0.5882
Validation loss decreased (4.329008 --> 4.188155).  Saving model ...
Epoch: 7, | Train Loss: 5.500 Vali Loss: 4.400
Epoch: 7, | Train Acc: 0.5755 Vali Acc: 0.5882
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.466 Vali Loss: 4.360
Epoch: 8, | Train Acc: 0.5755 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.465 Vali Loss: 4.406
Epoch: 9, | Train Acc: 0.5755 Vali Acc: 0.5882
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.431 Vali Loss: 4.431
Epoch: 10, | Train Acc: 0.5755 Vali Acc: 0.5882
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           14
True 1            0           18

Accuracy:0.588235
acc_clas_0:0.125000
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.560 Vali Loss: 4.197
Epoch: 1, | Train Acc: 0.5540 Vali Acc: 0.6765
Validation loss decreased (inf --> 4.197210).  Saving model ...
Epoch: 2, | Train Loss: 5.547 Vali Loss: 4.272
Epoch: 2, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.518 Vali Loss: 4.157
Epoch: 3, | Train Acc: 0.5540 Vali Acc: 0.6765
Validation loss decreased (4.197210 --> 4.156872).  Saving model ...
Epoch: 4, | Train Loss: 5.498 Vali Loss: 4.149
Epoch: 4, | Train Acc: 0.5540 Vali Acc: 0.6765
Validation loss decreased (4.156872 --> 4.148624).  Saving model ...
Epoch: 5, | Train Loss: 5.458 Vali Loss: 4.136
Epoch: 5, | Train Acc: 0.5540 Vali Acc: 0.6765
Validation loss decreased (4.148624 --> 4.136466).  Saving model ...
Epoch: 6, | Train Loss: 5.443 Vali Loss: 4.167
Epoch: 6, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.446 Vali Loss: 4.192
Epoch: 7, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.437 Vali Loss: 4.154
Epoch: 8, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.430 Vali Loss: 4.188
Epoch: 9, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           11
True 1            0           21

Accuracy:0.676471
acc_clas_0:0.153846
acc_clas_1:1.000000
total avg vali acc:0.590084  total avg vali acc_clas_0: 0.055769  total avg vali acc_clas_1: 1.000000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=0.125, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_0.125_pretrain_False_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.683 Vali Loss: 4.661
Epoch: 1, | Train Acc: 0.5362 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.660505).  Saving model ...
Epoch: 2, | Train Loss: 5.683 Vali Loss: 4.678
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.679 Vali Loss: 4.680
Epoch: 3, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.677 Vali Loss: 4.676
Epoch: 4, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.672 Vali Loss: 4.660
Epoch: 5, | Train Acc: 0.5942 Vali Acc: 0.5143
Validation loss decreased (4.660505 --> 4.660239).  Saving model ...
Epoch: 6, | Train Loss: 5.665 Vali Loss: 4.696
Epoch: 6, | Train Acc: 0.5942 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.650 Vali Loss: 4.675
Epoch: 7, | Train Acc: 0.6014 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.624 Vali Loss: 4.690
Epoch: 8, | Train Acc: 0.5870 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.603 Vali Loss: 4.715
Epoch: 9, | Train Acc: 0.5942 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           17
True 1            0           18

Accuracy:0.514286
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.669 Vali Loss: 4.679
Epoch: 1, | Train Acc: 0.6449 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.678886).  Saving model ...
Epoch: 2, | Train Loss: 5.661 Vali Loss: 4.672
Epoch: 2, | Train Acc: 0.5870 Vali Acc: 0.5143
Validation loss decreased (4.678886 --> 4.672332).  Saving model ...
Epoch: 3, | Train Loss: 5.642 Vali Loss: 4.671
Epoch: 3, | Train Acc: 0.5942 Vali Acc: 0.5143
Validation loss decreased (4.672332 --> 4.670613).  Saving model ...
Epoch: 4, | Train Loss: 5.615 Vali Loss: 4.671
Epoch: 4, | Train Acc: 0.5942 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.588 Vali Loss: 4.683
Epoch: 5, | Train Acc: 0.5942 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.563 Vali Loss: 4.668
Epoch: 6, | Train Acc: 0.5942 Vali Acc: 0.5143
Validation loss decreased (4.670613 --> 4.667767).  Saving model ...
Epoch: 7, | Train Loss: 5.501 Vali Loss: 4.655
Epoch: 7, | Train Acc: 0.5942 Vali Acc: 0.5143
Validation loss decreased (4.667767 --> 4.655251).  Saving model ...
Epoch: 8, | Train Loss: 5.446 Vali Loss: 4.709
Epoch: 8, | Train Acc: 0.5942 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.416 Vali Loss: 4.691
Epoch: 9, | Train Acc: 0.5942 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.374 Vali Loss: 4.656
Epoch: 10, | Train Acc: 0.5942 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.291 Vali Loss: 4.727
Epoch: 11, | Train Acc: 0.5942 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           17
True 1            0           18

Accuracy:0.514286
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.531 Vali Loss: 4.576
Epoch: 1, | Train Acc: 0.5725 Vali Acc: 0.6000
Validation loss decreased (inf --> 4.576120).  Saving model ...
Epoch: 2, | Train Loss: 5.465 Vali Loss: 4.587
Epoch: 2, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.446 Vali Loss: 4.574
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.6000
Validation loss decreased (4.576120 --> 4.574352).  Saving model ...
Epoch: 4, | Train Loss: 5.398 Vali Loss: 4.561
Epoch: 4, | Train Acc: 0.5725 Vali Acc: 0.6000
Validation loss decreased (4.574352 --> 4.561100).  Saving model ...
Epoch: 5, | Train Loss: 5.382 Vali Loss: 4.579
Epoch: 5, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.349 Vali Loss: 4.587
Epoch: 6, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.331 Vali Loss: 4.511
Epoch: 7, | Train Acc: 0.5725 Vali Acc: 0.6000
Validation loss decreased (4.561100 --> 4.511408).  Saving model ...
Epoch: 8, | Train Loss: 5.313 Vali Loss: 4.563
Epoch: 8, | Train Acc: 0.5797 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.308 Vali Loss: 4.608
Epoch: 9, | Train Acc: 0.5942 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.272 Vali Loss: 4.547
Epoch: 10, | Train Acc: 0.5870 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.281 Vali Loss: 4.555
Epoch: 11, | Train Acc: 0.5797 Vali Acc: 0.6286
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           13
True 1            1           21

Accuracy:0.600000
acc_clas_0:0.000000
acc_clas_1:0.954545
Fold 4/5
Epoch: 1, | Train Loss: 5.506 Vali Loss: 4.108
Epoch: 1, | Train Acc: 0.5612 Vali Acc: 0.6471
Validation loss decreased (inf --> 4.107620).  Saving model ...
Epoch: 2, | Train Loss: 5.489 Vali Loss: 3.963
Epoch: 2, | Train Acc: 0.5612 Vali Acc: 0.6471
Validation loss decreased (4.107620 --> 3.963461).  Saving model ...
Epoch: 3, | Train Loss: 5.461 Vali Loss: 3.918
Epoch: 3, | Train Acc: 0.5683 Vali Acc: 0.6765
Validation loss decreased (3.963461 --> 3.918097).  Saving model ...
Epoch: 4, | Train Loss: 5.459 Vali Loss: 3.958
Epoch: 4, | Train Acc: 0.5612 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.443 Vali Loss: 3.955
Epoch: 5, | Train Acc: 0.5899 Vali Acc: 0.6176
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.381 Vali Loss: 3.919
Epoch: 6, | Train Acc: 0.5755 Vali Acc: 0.6765
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.340 Vali Loss: 3.890
Epoch: 7, | Train Acc: 0.5683 Vali Acc: 0.6176
Validation loss decreased (3.918097 --> 3.889559).  Saving model ...
Epoch: 8, | Train Loss: 5.302 Vali Loss: 3.760
Epoch: 8, | Train Acc: 0.5540 Vali Acc: 0.6176
Validation loss decreased (3.889559 --> 3.760334).  Saving model ...
Epoch: 9, | Train Loss: 5.330 Vali Loss: 3.634
Epoch: 9, | Train Acc: 0.5755 Vali Acc: 0.6471
Validation loss decreased (3.760334 --> 3.634093).  Saving model ...
Epoch: 10, | Train Loss: 5.281 Vali Loss: 3.987
Epoch: 10, | Train Acc: 0.5971 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.197 Vali Loss: 4.014
Epoch: 11, | Train Acc: 0.5683 Vali Acc: 0.7353
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 5.172 Vali Loss: 3.940
Epoch: 12, | Train Acc: 0.5683 Vali Acc: 0.7353
EarlyStopping counter: 3 out of 4
Epoch: 13, | Train Loss: 5.161 Vali Loss: 3.985
Epoch: 13, | Train Acc: 0.5612 Vali Acc: 0.7353
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            4           10
True 1            2           18

Accuracy:0.647059
acc_clas_0:0.285714
acc_clas_1:0.900000
Fold 5/5
Epoch: 1, | Train Loss: 5.232 Vali Loss: 4.142
Epoch: 1, | Train Acc: 0.5899 Vali Acc: 0.6176
Validation loss decreased (inf --> 4.142251).  Saving model ...
Epoch: 2, | Train Loss: 5.240 Vali Loss: 4.099
Epoch: 2, | Train Acc: 0.5827 Vali Acc: 0.5882
Validation loss decreased (4.142251 --> 4.099010).  Saving model ...
Epoch: 3, | Train Loss: 5.175 Vali Loss: 4.176
Epoch: 3, | Train Acc: 0.5827 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.152 Vali Loss: 4.197
Epoch: 4, | Train Acc: 0.5755 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.145 Vali Loss: 4.102
Epoch: 5, | Train Acc: 0.6403 Vali Acc: 0.7059
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.121 Vali Loss: 4.212
Epoch: 6, | Train Acc: 0.6115 Vali Acc: 0.5882
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           13
True 1            1           19

Accuracy:0.588235
acc_clas_0:0.071429
acc_clas_1:0.950000
total avg vali acc:0.572773  total avg vali acc_clas_0: 0.071429  total avg vali acc_clas_1: 0.960909
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=0.25, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_0.25_pretrain_True_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.719 Vali Loss: 4.683
Epoch: 1, | Train Acc: 0.4275 Vali Acc: 0.4571
Validation loss decreased (inf --> 4.682843).  Saving model ...
Epoch: 2, | Train Loss: 5.690 Vali Loss: 4.682
Epoch: 2, | Train Acc: 0.5362 Vali Acc: 0.4571
Validation loss decreased (4.682843 --> 4.682136).  Saving model ...
Epoch: 3, | Train Loss: 5.647 Vali Loss: 4.662
Epoch: 3, | Train Acc: 0.8116 Vali Acc: 0.6000
Validation loss decreased (4.682136 --> 4.662177).  Saving model ...
Epoch: 4, | Train Loss: 5.583 Vali Loss: 4.676
Epoch: 4, | Train Acc: 0.8623 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.483 Vali Loss: 4.671
Epoch: 5, | Train Acc: 0.8116 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.374 Vali Loss: 4.653
Epoch: 6, | Train Acc: 0.7899 Vali Acc: 0.5714
Validation loss decreased (4.662177 --> 4.653225).  Saving model ...
Epoch: 7, | Train Loss: 5.200 Vali Loss: 4.679
Epoch: 7, | Train Acc: 0.7899 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.042 Vali Loss: 4.726
Epoch: 8, | Train Acc: 0.7101 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 4.907 Vali Loss: 4.755
Epoch: 9, | Train Acc: 0.6957 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 4.761 Vali Loss: 4.713
Epoch: 10, | Train Acc: 0.6812 Vali Acc: 0.6000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           15
True 1            0           19

Accuracy:0.571429
acc_clas_0:0.062500
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.363 Vali Loss: 4.551
Epoch: 1, | Train Acc: 0.7246 Vali Acc: 0.6857
Validation loss decreased (inf --> 4.550713).  Saving model ...
Epoch: 2, | Train Loss: 5.225 Vali Loss: 4.468
Epoch: 2, | Train Acc: 0.6957 Vali Acc: 0.7429
Validation loss decreased (4.550713 --> 4.467673).  Saving model ...
Epoch: 3, | Train Loss: 5.058 Vali Loss: 4.360
Epoch: 3, | Train Acc: 0.6884 Vali Acc: 0.6571
Validation loss decreased (4.467673 --> 4.360100).  Saving model ...
Epoch: 4, | Train Loss: 4.992 Vali Loss: 4.456
Epoch: 4, | Train Acc: 0.6594 Vali Acc: 0.7429
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 4.848 Vali Loss: 4.453
Epoch: 5, | Train Acc: 0.6304 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 4.767 Vali Loss: 4.345
Epoch: 6, | Train Acc: 0.6522 Vali Acc: 0.6000
Validation loss decreased (4.360100 --> 4.344913).  Saving model ...
Epoch: 7, | Train Loss: 4.726 Vali Loss: 4.470
Epoch: 7, | Train Acc: 0.6377 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 4.658 Vali Loss: 4.394
Epoch: 8, | Train Acc: 0.6377 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 4.705 Vali Loss: 4.621
Epoch: 9, | Train Acc: 0.6594 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 4.737 Vali Loss: 4.576
Epoch: 10, | Train Acc: 0.6159 Vali Acc: 0.5714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           12            1
True 1           13            9

Accuracy:0.600000
acc_clas_0:0.923077
acc_clas_1:0.409091
Fold 3/5
Epoch: 1, | Train Loss: 4.947 Vali Loss: 3.594
Epoch: 1, | Train Acc: 0.6087 Vali Acc: 0.8000
Validation loss decreased (inf --> 3.593629).  Saving model ...
Epoch: 2, | Train Loss: 4.840 Vali Loss: 4.529
Epoch: 2, | Train Acc: 0.5652 Vali Acc: 0.6857
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 4.766 Vali Loss: 3.975
Epoch: 3, | Train Acc: 0.5942 Vali Acc: 0.8000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 4.718 Vali Loss: 3.593
Epoch: 4, | Train Acc: 0.5870 Vali Acc: 0.8286
Validation loss decreased (3.593629 --> 3.593424).  Saving model ...
Epoch: 5, | Train Loss: 4.743 Vali Loss: 3.892
Epoch: 5, | Train Acc: 0.5797 Vali Acc: 0.8286
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 4.794 Vali Loss: 3.992
Epoch: 6, | Train Acc: 0.5797 Vali Acc: 0.8000
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 4.728 Vali Loss: 3.566
Epoch: 7, | Train Acc: 0.5942 Vali Acc: 0.8000
Validation loss decreased (3.593424 --> 3.566253).  Saving model ...
Epoch: 8, | Train Loss: 4.670 Vali Loss: 3.764
Epoch: 8, | Train Acc: 0.5580 Vali Acc: 0.8000
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 4.649 Vali Loss: 3.521
Epoch: 9, | Train Acc: 0.5797 Vali Acc: 0.8000
Validation loss decreased (3.566253 --> 3.521265).  Saving model ...
Epoch: 10, | Train Loss: 4.585 Vali Loss: 3.627
Epoch: 10, | Train Acc: 0.6014 Vali Acc: 0.8000
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 4.542 Vali Loss: 3.797
Epoch: 11, | Train Acc: 0.5507 Vali Acc: 0.8000
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 4.557 Vali Loss: 4.410
Epoch: 12, | Train Acc: 0.6014 Vali Acc: 0.8000
EarlyStopping counter: 3 out of 4
Epoch: 13, | Train Loss: 4.588 Vali Loss: 3.596
Epoch: 13, | Train Acc: 0.5870 Vali Acc: 0.8000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           11            4
True 1            3           17

Accuracy:0.800000
acc_clas_0:0.733333
acc_clas_1:0.850000
Fold 4/5
Epoch: 1, | Train Loss: 4.661 Vali Loss: 4.122
Epoch: 1, | Train Acc: 0.6259 Vali Acc: 0.6471
Validation loss decreased (inf --> 4.121833).  Saving model ...
Epoch: 2, | Train Loss: 4.607 Vali Loss: 3.726
Epoch: 2, | Train Acc: 0.6259 Vali Acc: 0.6176
Validation loss decreased (4.121833 --> 3.725950).  Saving model ...
Epoch: 3, | Train Loss: 4.640 Vali Loss: 3.633
Epoch: 3, | Train Acc: 0.6043 Vali Acc: 0.5882
Validation loss decreased (3.725950 --> 3.632590).  Saving model ...
Epoch: 4, | Train Loss: 4.568 Vali Loss: 4.284
Epoch: 4, | Train Acc: 0.6331 Vali Acc: 0.5882
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 4.560 Vali Loss: 3.634
Epoch: 5, | Train Acc: 0.6331 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 4.562 Vali Loss: 3.387
Epoch: 6, | Train Acc: 0.6331 Vali Acc: 0.5882
Validation loss decreased (3.632590 --> 3.387456).  Saving model ...
Epoch: 7, | Train Loss: 4.489 Vali Loss: 3.879
Epoch: 7, | Train Acc: 0.6331 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 4.494 Vali Loss: 3.749
Epoch: 8, | Train Acc: 0.6331 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 4.506 Vali Loss: 4.064
Epoch: 9, | Train Acc: 0.6331 Vali Acc: 0.5882
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 4.559 Vali Loss: 4.255
Epoch: 10, | Train Acc: 0.6331 Vali Acc: 0.5882
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           10            4
True 1           10           10

Accuracy:0.588235
acc_clas_0:0.714286
acc_clas_1:0.500000
Fold 5/5
Epoch: 1, | Train Loss: 4.598 Vali Loss: 4.072
Epoch: 1, | Train Acc: 0.6475 Vali Acc: 0.5588
Validation loss decreased (inf --> 4.071920).  Saving model ...
Epoch: 2, | Train Loss: 4.610 Vali Loss: 4.131
Epoch: 2, | Train Acc: 0.6475 Vali Acc: 0.5588
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 4.563 Vali Loss: 3.409
Epoch: 3, | Train Acc: 0.6403 Vali Acc: 0.5588
Validation loss decreased (4.071920 --> 3.409165).  Saving model ...
Epoch: 4, | Train Loss: 4.531 Vali Loss: 3.782
Epoch: 4, | Train Acc: 0.6475 Vali Acc: 0.5294
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 4.505 Vali Loss: 3.830
Epoch: 5, | Train Acc: 0.6331 Vali Acc: 0.5588
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 4.525 Vali Loss: 3.486
Epoch: 6, | Train Acc: 0.6403 Vali Acc: 0.5588
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 4.512 Vali Loss: 3.857
Epoch: 7, | Train Acc: 0.6475 Vali Acc: 0.5294
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            9            8
True 1            7           10

Accuracy:0.558824
acc_clas_0:0.529412
acc_clas_1:0.588235
total avg vali acc:0.623697  total avg vali acc_clas_0: 0.592522  total avg vali acc_clas_1: 0.669465
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=0.25, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_0.25_pretrain_True_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.694 Vali Loss: 4.692
Epoch: 1, | Train Acc: 0.5507 Vali Acc: 0.4571
Validation loss decreased (inf --> 4.691863).  Saving model ...
Epoch: 2, | Train Loss: 5.653 Vali Loss: 4.734
Epoch: 2, | Train Acc: 0.6014 Vali Acc: 0.4571
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.593 Vali Loss: 4.730
Epoch: 3, | Train Acc: 0.6449 Vali Acc: 0.4571
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.482 Vali Loss: 4.707
Epoch: 4, | Train Acc: 0.7101 Vali Acc: 0.4571
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.380 Vali Loss: 4.723
Epoch: 5, | Train Acc: 0.6884 Vali Acc: 0.4857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           19
True 1            0           16

Accuracy:0.457143
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.673 Vali Loss: 4.651
Epoch: 1, | Train Acc: 0.6014 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.650885).  Saving model ...
Epoch: 2, | Train Loss: 5.644 Vali Loss: 4.668
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.558 Vali Loss: 4.649
Epoch: 3, | Train Acc: 0.6232 Vali Acc: 0.5429
Validation loss decreased (4.650885 --> 4.649247).  Saving model ...
Epoch: 4, | Train Loss: 5.469 Vali Loss: 4.680
Epoch: 4, | Train Acc: 0.6449 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.326 Vali Loss: 4.681
Epoch: 5, | Train Acc: 0.6377 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.209 Vali Loss: 4.544
Epoch: 6, | Train Acc: 0.6087 Vali Acc: 0.5143
Validation loss decreased (4.649247 --> 4.543688).  Saving model ...
Epoch: 7, | Train Loss: 5.108 Vali Loss: 4.766
Epoch: 7, | Train Acc: 0.5652 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 4.960 Vali Loss: 4.652
Epoch: 8, | Train Acc: 0.5725 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 4.956 Vali Loss: 4.651
Epoch: 9, | Train Acc: 0.5507 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 4.741 Vali Loss: 4.749
Epoch: 10, | Train Acc: 0.5580 Vali Acc: 0.5714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           14
True 1            3           16

Accuracy:0.514286
acc_clas_0:0.125000
acc_clas_1:0.842105
Fold 3/5
Epoch: 1, | Train Loss: 5.349 Vali Loss: 4.667
Epoch: 1, | Train Acc: 0.4928 Vali Acc: 0.6286
Validation loss decreased (inf --> 4.667169).  Saving model ...
Epoch: 2, | Train Loss: 5.200 Vali Loss: 4.682
Epoch: 2, | Train Acc: 0.5435 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.080 Vali Loss: 4.294
Epoch: 3, | Train Acc: 0.5217 Vali Acc: 0.7714
Validation loss decreased (4.667169 --> 4.293562).  Saving model ...
Epoch: 4, | Train Loss: 4.944 Vali Loss: 4.085
Epoch: 4, | Train Acc: 0.5290 Vali Acc: 0.7429
Validation loss decreased (4.293562 --> 4.084805).  Saving model ...
Epoch: 5, | Train Loss: 4.876 Vali Loss: 4.239
Epoch: 5, | Train Acc: 0.5217 Vali Acc: 0.8000
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 4.841 Vali Loss: 4.294
Epoch: 6, | Train Acc: 0.5217 Vali Acc: 0.7143
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 4.753 Vali Loss: 4.198
Epoch: 7, | Train Acc: 0.5290 Vali Acc: 0.7429
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 4.716 Vali Loss: 3.936
Epoch: 8, | Train Acc: 0.5145 Vali Acc: 0.7429
Validation loss decreased (4.084805 --> 3.935580).  Saving model ...
Epoch: 9, | Train Loss: 4.671 Vali Loss: 4.124
Epoch: 9, | Train Acc: 0.5290 Vali Acc: 0.7143
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 4.625 Vali Loss: 4.181
Epoch: 10, | Train Acc: 0.5217 Vali Acc: 0.7143
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 4.656 Vali Loss: 4.162
Epoch: 11, | Train Acc: 0.5217 Vali Acc: 0.7429
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 4.658 Vali Loss: 4.155
Epoch: 12, | Train Acc: 0.5000 Vali Acc: 0.7714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           12            3
True 1            6           14

Accuracy:0.742857
acc_clas_0:0.800000
acc_clas_1:0.700000
Fold 4/5
Epoch: 1, | Train Loss: 4.818 Vali Loss: 4.057
Epoch: 1, | Train Acc: 0.5252 Vali Acc: 0.6471
Validation loss decreased (inf --> 4.057371).  Saving model ...
Epoch: 2, | Train Loss: 4.736 Vali Loss: 4.105
Epoch: 2, | Train Acc: 0.5324 Vali Acc: 0.5882
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 4.805 Vali Loss: 3.689
Epoch: 3, | Train Acc: 0.5252 Vali Acc: 0.6176
Validation loss decreased (4.057371 --> 3.689164).  Saving model ...
Epoch: 4, | Train Loss: 4.710 Vali Loss: 3.778
Epoch: 4, | Train Acc: 0.5540 Vali Acc: 0.5588
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 4.619 Vali Loss: 3.761
Epoch: 5, | Train Acc: 0.5468 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 4.701 Vali Loss: 3.929
Epoch: 6, | Train Acc: 0.5396 Vali Acc: 0.6471
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 4.591 Vali Loss: 3.352
Epoch: 7, | Train Acc: 0.5468 Vali Acc: 0.6176
Validation loss decreased (3.689164 --> 3.351521).  Saving model ...
Epoch: 8, | Train Loss: 4.564 Vali Loss: 3.295
Epoch: 8, | Train Acc: 0.5540 Vali Acc: 0.5882
Validation loss decreased (3.351521 --> 3.294835).  Saving model ...
Epoch: 9, | Train Loss: 4.679 Vali Loss: 3.625
Epoch: 9, | Train Acc: 0.5396 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 4.606 Vali Loss: 3.776
Epoch: 10, | Train Acc: 0.5612 Vali Acc: 0.6176
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 4.682 Vali Loss: 4.047
Epoch: 11, | Train Acc: 0.5683 Vali Acc: 0.6471
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 4.579 Vali Loss: 3.913
Epoch: 12, | Train Acc: 0.5540 Vali Acc: 0.5882
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            7            6
True 1            8           13

Accuracy:0.588235
acc_clas_0:0.538462
acc_clas_1:0.619048
Fold 5/5
Epoch: 1, | Train Loss: 4.608 Vali Loss: 3.871
Epoch: 1, | Train Acc: 0.6187 Vali Acc: 0.3235
Validation loss decreased (inf --> 3.870798).  Saving model ...
Epoch: 2, | Train Loss: 4.595 Vali Loss: 3.844
Epoch: 2, | Train Acc: 0.6187 Vali Acc: 0.3824
Validation loss decreased (3.870798 --> 3.844176).  Saving model ...
Epoch: 3, | Train Loss: 4.561 Vali Loss: 3.692
Epoch: 3, | Train Acc: 0.6259 Vali Acc: 0.3235
Validation loss decreased (3.844176 --> 3.691798).  Saving model ...
Epoch: 4, | Train Loss: 4.627 Vali Loss: 3.962
Epoch: 4, | Train Acc: 0.6187 Vali Acc: 0.3824
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 4.562 Vali Loss: 3.801
Epoch: 5, | Train Acc: 0.6187 Vali Acc: 0.3235
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 4.536 Vali Loss: 4.049
Epoch: 6, | Train Acc: 0.6475 Vali Acc: 0.3529
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 4.484 Vali Loss: 3.766
Epoch: 7, | Train Acc: 0.6259 Vali Acc: 0.2941
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            4            8
True 1           15            7

Accuracy:0.323529
acc_clas_0:0.333333
acc_clas_1:0.318182
total avg vali acc:0.525210  total avg vali acc_clas_0: 0.359359  total avg vali acc_clas_1: 0.695867
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=0.25, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_0.25_pretrain_False_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.691 Vali Loss: 4.678
Epoch: 1, | Train Acc: 0.5072 Vali Acc: 0.6000
Validation loss decreased (inf --> 4.677974).  Saving model ...
Epoch: 2, | Train Loss: 5.684 Vali Loss: 4.679
Epoch: 2, | Train Acc: 0.5580 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.675 Vali Loss: 4.684
Epoch: 3, | Train Acc: 0.5870 Vali Acc: 0.3714
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.665 Vali Loss: 4.674
Epoch: 4, | Train Acc: 0.5870 Vali Acc: 0.5714
Validation loss decreased (4.677974 --> 4.674055).  Saving model ...
Epoch: 5, | Train Loss: 5.641 Vali Loss: 4.690
Epoch: 5, | Train Acc: 0.5797 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.592 Vali Loss: 4.718
Epoch: 6, | Train Acc: 0.6449 Vali Acc: 0.4000
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.550 Vali Loss: 4.758
Epoch: 7, | Train Acc: 0.6377 Vali Acc: 0.4000
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.480 Vali Loss: 4.800
Epoch: 8, | Train Acc: 0.6087 Vali Acc: 0.4000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           13
True 1            2           19

Accuracy:0.571429
acc_clas_0:0.071429
acc_clas_1:0.904762
Fold 2/5
Epoch: 1, | Train Loss: 5.664 Vali Loss: 4.708
Epoch: 1, | Train Acc: 0.5797 Vali Acc: 0.4857
Validation loss decreased (inf --> 4.707924).  Saving model ...
Epoch: 2, | Train Loss: 5.654 Vali Loss: 4.722
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.634 Vali Loss: 4.689
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.4857
Validation loss decreased (4.707924 --> 4.689322).  Saving model ...
Epoch: 4, | Train Loss: 5.585 Vali Loss: 4.641
Epoch: 4, | Train Acc: 0.5942 Vali Acc: 0.6571
Validation loss decreased (4.689322 --> 4.641318).  Saving model ...
Epoch: 5, | Train Loss: 5.547 Vali Loss: 4.649
Epoch: 5, | Train Acc: 0.5870 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.474 Vali Loss: 4.626
Epoch: 6, | Train Acc: 0.6087 Vali Acc: 0.6857
Validation loss decreased (4.641318 --> 4.626122).  Saving model ...
Epoch: 7, | Train Loss: 5.388 Vali Loss: 4.524
Epoch: 7, | Train Acc: 0.5870 Vali Acc: 0.6286
Validation loss decreased (4.626122 --> 4.523501).  Saving model ...
Epoch: 8, | Train Loss: 5.292 Vali Loss: 4.690
Epoch: 8, | Train Acc: 0.6014 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.238 Vali Loss: 4.703
Epoch: 9, | Train Acc: 0.6087 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.222 Vali Loss: 4.858
Epoch: 10, | Train Acc: 0.6087 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.059 Vali Loss: 4.475
Epoch: 11, | Train Acc: 0.6232 Vali Acc: 0.5714
Validation loss decreased (4.523501 --> 4.474510).  Saving model ...
Epoch: 12, | Train Loss: 5.007 Vali Loss: 4.458
Epoch: 12, | Train Acc: 0.6159 Vali Acc: 0.6571
Validation loss decreased (4.474510 --> 4.457613).  Saving model ...
Epoch: 13, | Train Loss: 4.951 Vali Loss: 4.817
Epoch: 13, | Train Acc: 0.6159 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 14, | Train Loss: 4.923 Vali Loss: 4.870
Epoch: 14, | Train Acc: 0.6449 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 15, | Train Loss: 4.886 Vali Loss: 4.971
Epoch: 15, | Train Acc: 0.6522 Vali Acc: 0.4857
EarlyStopping counter: 3 out of 4
Epoch: 16, | Train Loss: 4.808 Vali Loss: 4.761
Epoch: 16, | Train Acc: 0.6159 Vali Acc: 0.5714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           10            7
True 1            5           13

Accuracy:0.657143
acc_clas_0:0.588235
acc_clas_1:0.722222
Fold 3/5
Epoch: 1, | Train Loss: 5.156 Vali Loss: 4.251
Epoch: 1, | Train Acc: 0.6304 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.250603).  Saving model ...
Epoch: 2, | Train Loss: 5.132 Vali Loss: 4.767
Epoch: 2, | Train Acc: 0.6449 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.059 Vali Loss: 5.055
Epoch: 3, | Train Acc: 0.6232 Vali Acc: 0.3714
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.093 Vali Loss: 4.968
Epoch: 4, | Train Acc: 0.6232 Vali Acc: 0.3714
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 4.969 Vali Loss: 5.029
Epoch: 5, | Train Acc: 0.6087 Vali Acc: 0.3714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            7            6
True 1            9           13

Accuracy:0.571429
acc_clas_0:0.538462
acc_clas_1:0.590909
Fold 4/5
Epoch: 1, | Train Loss: 5.239 Vali Loss: 3.710
Epoch: 1, | Train Acc: 0.6043 Vali Acc: 0.7941
Validation loss decreased (inf --> 3.709932).  Saving model ...
Epoch: 2, | Train Loss: 5.203 Vali Loss: 4.207
Epoch: 2, | Train Acc: 0.5827 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.097 Vali Loss: 4.756
Epoch: 3, | Train Acc: 0.5899 Vali Acc: 0.4412
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.031 Vali Loss: 4.432
Epoch: 4, | Train Acc: 0.5899 Vali Acc: 0.5000
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.006 Vali Loss: 3.806
Epoch: 5, | Train Acc: 0.5683 Vali Acc: 0.7647
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           11            4
True 1            3           16

Accuracy:0.794118
acc_clas_0:0.733333
acc_clas_1:0.842105
Fold 5/5
Epoch: 1, | Train Loss: 5.134 Vali Loss: 4.084
Epoch: 1, | Train Acc: 0.6547 Vali Acc: 0.5882
Validation loss decreased (inf --> 4.084438).  Saving model ...
Epoch: 2, | Train Loss: 5.074 Vali Loss: 4.753
Epoch: 2, | Train Acc: 0.6187 Vali Acc: 0.4706
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.092 Vali Loss: 4.376
Epoch: 3, | Train Acc: 0.6187 Vali Acc: 0.6471
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 4.970 Vali Loss: 4.887
Epoch: 4, | Train Acc: 0.6403 Vali Acc: 0.4706
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 4.929 Vali Loss: 4.298
Epoch: 5, | Train Acc: 0.6187 Vali Acc: 0.5882
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            9            7
True 1            7           11

Accuracy:0.588235
acc_clas_0:0.562500
acc_clas_1:0.611111
total avg vali acc:0.636471  total avg vali acc_clas_0: 0.498792  total avg vali acc_clas_1: 0.734222
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=0.25, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_0.25_pretrain_False_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.691 Vali Loss: 4.672
Epoch: 1, | Train Acc: 0.5435 Vali Acc: 0.6571
Validation loss decreased (inf --> 4.672247).  Saving model ...
Epoch: 2, | Train Loss: 5.686 Vali Loss: 4.674
Epoch: 2, | Train Acc: 0.5435 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.684 Vali Loss: 4.676
Epoch: 3, | Train Acc: 0.5435 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.680 Vali Loss: 4.667
Epoch: 4, | Train Acc: 0.5435 Vali Acc: 0.6571
Validation loss decreased (4.672247 --> 4.667236).  Saving model ...
Epoch: 5, | Train Loss: 5.675 Vali Loss: 4.659
Epoch: 5, | Train Acc: 0.5435 Vali Acc: 0.6571
Validation loss decreased (4.667236 --> 4.658986).  Saving model ...
Epoch: 6, | Train Loss: 5.666 Vali Loss: 4.670
Epoch: 6, | Train Acc: 0.5435 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.655 Vali Loss: 4.662
Epoch: 7, | Train Acc: 0.6014 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.642 Vali Loss: 4.682
Epoch: 8, | Train Acc: 0.6667 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.630 Vali Loss: 4.663
Epoch: 9, | Train Acc: 0.7826 Vali Acc: 0.6000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           12
True 1            0           23

Accuracy:0.657143
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.669 Vali Loss: 4.674
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.674473).  Saving model ...
Epoch: 2, | Train Loss: 5.661 Vali Loss: 4.635
Epoch: 2, | Train Acc: 0.5652 Vali Acc: 0.5714
Validation loss decreased (4.674473 --> 4.634589).  Saving model ...
Epoch: 3, | Train Loss: 5.648 Vali Loss: 4.648
Epoch: 3, | Train Acc: 0.5652 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.640 Vali Loss: 4.641
Epoch: 4, | Train Acc: 0.6087 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.622 Vali Loss: 4.636
Epoch: 5, | Train Acc: 0.6377 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.611 Vali Loss: 4.666
Epoch: 6, | Train Acc: 0.7754 Vali Acc: 0.6000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           15
True 1            0           20

Accuracy:0.571429
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.666 Vali Loss: 4.728
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.727540).  Saving model ...
Epoch: 2, | Train Loss: 5.650 Vali Loss: 4.635
Epoch: 2, | Train Acc: 0.5725 Vali Acc: 0.5714
Validation loss decreased (4.727540 --> 4.634821).  Saving model ...
Epoch: 3, | Train Loss: 5.638 Vali Loss: 4.653
Epoch: 3, | Train Acc: 0.6304 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.634 Vali Loss: 4.662
Epoch: 4, | Train Acc: 0.7029 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.621 Vali Loss: 4.644
Epoch: 5, | Train Acc: 0.6667 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.605 Vali Loss: 4.615
Epoch: 6, | Train Acc: 0.7029 Vali Acc: 0.8286
Validation loss decreased (4.634821 --> 4.614553).  Saving model ...
Epoch: 7, | Train Loss: 5.586 Vali Loss: 4.609
Epoch: 7, | Train Acc: 0.7246 Vali Acc: 0.8000
Validation loss decreased (4.614553 --> 4.608578).  Saving model ...
Epoch: 8, | Train Loss: 5.567 Vali Loss: 4.606
Epoch: 8, | Train Acc: 0.7246 Vali Acc: 0.8000
Validation loss decreased (4.608578 --> 4.606432).  Saving model ...
Epoch: 9, | Train Loss: 5.548 Vali Loss: 4.589
Epoch: 9, | Train Acc: 0.7319 Vali Acc: 0.8286
Validation loss decreased (4.606432 --> 4.589360).  Saving model ...
Epoch: 10, | Train Loss: 5.521 Vali Loss: 4.695
Epoch: 10, | Train Acc: 0.7029 Vali Acc: 0.7714
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.522 Vali Loss: 4.646
Epoch: 11, | Train Acc: 0.6377 Vali Acc: 0.8000
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 5.476 Vali Loss: 4.627
Epoch: 12, | Train Acc: 0.6087 Vali Acc: 0.7143
EarlyStopping counter: 3 out of 4
Epoch: 13, | Train Loss: 5.525 Vali Loss: 4.630
Epoch: 13, | Train Acc: 0.7029 Vali Acc: 0.7714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           11            4
True 1            2           18

Accuracy:0.828571
acc_clas_0:0.733333
acc_clas_1:0.900000
Fold 4/5
Epoch: 1, | Train Loss: 5.607 Vali Loss: 4.331
Epoch: 1, | Train Acc: 0.6906 Vali Acc: 0.6176
Validation loss decreased (inf --> 4.331081).  Saving model ...
Epoch: 2, | Train Loss: 5.597 Vali Loss: 4.261
Epoch: 2, | Train Acc: 0.7410 Vali Acc: 0.8529
Validation loss decreased (4.331081 --> 4.261279).  Saving model ...
Epoch: 3, | Train Loss: 5.576 Vali Loss: 4.327
Epoch: 3, | Train Acc: 0.7266 Vali Acc: 0.7353
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.555 Vali Loss: 4.265
Epoch: 4, | Train Acc: 0.7266 Vali Acc: 0.8235
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.539 Vali Loss: 4.257
Epoch: 5, | Train Acc: 0.6547 Vali Acc: 0.7647
Validation loss decreased (4.261279 --> 4.256849).  Saving model ...
Epoch: 6, | Train Loss: 5.550 Vali Loss: 4.307
Epoch: 6, | Train Acc: 0.6691 Vali Acc: 0.7941
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.513 Vali Loss: 4.047
Epoch: 7, | Train Acc: 0.6403 Vali Acc: 0.7353
Validation loss decreased (4.256849 --> 4.047206).  Saving model ...
Epoch: 8, | Train Loss: 5.519 Vali Loss: 4.303
Epoch: 8, | Train Acc: 0.6547 Vali Acc: 0.7647
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.514 Vali Loss: 4.404
Epoch: 9, | Train Acc: 0.6187 Vali Acc: 0.5588
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.472 Vali Loss: 4.248
Epoch: 10, | Train Acc: 0.5827 Vali Acc: 0.7059
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.497 Vali Loss: 4.282
Epoch: 11, | Train Acc: 0.6259 Vali Acc: 0.7941
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           18            1
True 1            8            7

Accuracy:0.735294
acc_clas_0:0.947368
acc_clas_1:0.466667
Fold 5/5
Epoch: 1, | Train Loss: 5.502 Vali Loss: 4.358
Epoch: 1, | Train Acc: 0.6691 Vali Acc: 0.6176
Validation loss decreased (inf --> 4.357784).  Saving model ...
Epoch: 2, | Train Loss: 5.513 Vali Loss: 4.401
Epoch: 2, | Train Acc: 0.5540 Vali Acc: 0.5882
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.472 Vali Loss: 4.349
Epoch: 3, | Train Acc: 0.6187 Vali Acc: 0.7647
Validation loss decreased (4.357784 --> 4.349005).  Saving model ...
Epoch: 4, | Train Loss: 5.468 Vali Loss: 4.319
Epoch: 4, | Train Acc: 0.5108 Vali Acc: 0.5882
Validation loss decreased (4.349005 --> 4.319060).  Saving model ...
Epoch: 5, | Train Loss: 5.445 Vali Loss: 4.309
Epoch: 5, | Train Acc: 0.5971 Vali Acc: 0.6471
Validation loss decreased (4.319060 --> 4.309117).  Saving model ...
Epoch: 6, | Train Loss: 5.421 Vali Loss: 4.383
Epoch: 6, | Train Acc: 0.5396 Vali Acc: 0.5882
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.424 Vali Loss: 4.375
Epoch: 7, | Train Acc: 0.5180 Vali Acc: 0.6176
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.390 Vali Loss: 4.318
Epoch: 8, | Train Acc: 0.6043 Vali Acc: 0.6176
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.353 Vali Loss: 4.337
Epoch: 9, | Train Acc: 0.5899 Vali Acc: 0.5882
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           11            3
True 1            9           11

Accuracy:0.647059
acc_clas_0:0.785714
acc_clas_1:0.550000
total avg vali acc:0.687899  total avg vali acc_clas_0: 0.493283  total avg vali acc_clas_1: 0.783333
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=0.25, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_0.25_pretrain_True_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.702 Vali Loss: 4.661
Epoch: 1, | Train Acc: 0.4855 Vali Acc: 0.6571
Validation loss decreased (inf --> 4.661196).  Saving model ...
Epoch: 2, | Train Loss: 5.695 Vali Loss: 4.660
Epoch: 2, | Train Acc: 0.5435 Vali Acc: 0.6571
Validation loss decreased (4.661196 --> 4.660391).  Saving model ...
Epoch: 3, | Train Loss: 5.684 Vali Loss: 4.681
Epoch: 3, | Train Acc: 0.5435 Vali Acc: 0.3429
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.688 Vali Loss: 4.690
Epoch: 4, | Train Acc: 0.5217 Vali Acc: 0.4857
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.663 Vali Loss: 4.662
Epoch: 5, | Train Acc: 0.6522 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.605 Vali Loss: 4.684
Epoch: 6, | Train Acc: 0.7101 Vali Acc: 0.5714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           12
True 1            0           23

Accuracy:0.657143
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.687 Vali Loss: 4.666
Epoch: 1, | Train Acc: 0.5725 Vali Acc: 0.7143
Validation loss decreased (inf --> 4.665527).  Saving model ...
Epoch: 2, | Train Loss: 5.706 Vali Loss: 4.690
Epoch: 2, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.695 Vali Loss: 4.672
Epoch: 3, | Train Acc: 0.5652 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.684 Vali Loss: 4.651
Epoch: 4, | Train Acc: 0.5000 Vali Acc: 0.5429
Validation loss decreased (4.665527 --> 4.651410).  Saving model ...
Epoch: 5, | Train Loss: 5.689 Vali Loss: 4.679
Epoch: 5, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.687 Vali Loss: 4.682
Epoch: 6, | Train Acc: 0.5797 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.686 Vali Loss: 4.682
Epoch: 7, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.680 Vali Loss: 4.684
Epoch: 8, | Train Acc: 0.6014 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           16
True 1            0           19

Accuracy:0.542857
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.692 Vali Loss: 4.674
Epoch: 1, | Train Acc: 0.5942 Vali Acc: 0.4571
Validation loss decreased (inf --> 4.673664).  Saving model ...
Epoch: 2, | Train Loss: 5.680 Vali Loss: 4.718
Epoch: 2, | Train Acc: 0.6159 Vali Acc: 0.4571
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.682 Vali Loss: 4.694
Epoch: 3, | Train Acc: 0.5942 Vali Acc: 0.4571
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.680 Vali Loss: 4.685
Epoch: 4, | Train Acc: 0.5942 Vali Acc: 0.4571
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.673 Vali Loss: 4.707
Epoch: 5, | Train Acc: 0.5942 Vali Acc: 0.4571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           19
True 1            0           16

Accuracy:0.457143
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.707 Vali Loss: 4.400
Epoch: 1, | Train Acc: 0.5899 Vali Acc: 0.4706
Validation loss decreased (inf --> 4.400089).  Saving model ...
Epoch: 2, | Train Loss: 5.717 Vali Loss: 4.461
Epoch: 2, | Train Acc: 0.5899 Vali Acc: 0.4706
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.703 Vali Loss: 4.419
Epoch: 3, | Train Acc: 0.5899 Vali Acc: 0.4706
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.703 Vali Loss: 4.460
Epoch: 4, | Train Acc: 0.5899 Vali Acc: 0.4706
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.701 Vali Loss: 4.431
Epoch: 5, | Train Acc: 0.5899 Vali Acc: 0.4706
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           18
True 1            0           16

Accuracy:0.470588
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.724 Vali Loss: 4.397
Epoch: 1, | Train Acc: 0.4892 Vali Acc: 0.7059
Validation loss decreased (inf --> 4.396805).  Saving model ...
Epoch: 2, | Train Loss: 5.709 Vali Loss: 4.408
Epoch: 2, | Train Acc: 0.5324 Vali Acc: 0.3529
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.705 Vali Loss: 4.401
Epoch: 3, | Train Acc: 0.6259 Vali Acc: 0.7059
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.698 Vali Loss: 4.392
Epoch: 4, | Train Acc: 0.6763 Vali Acc: 0.7059
Validation loss decreased (4.396805 --> 4.392066).  Saving model ...
Epoch: 5, | Train Loss: 5.684 Vali Loss: 4.406
Epoch: 5, | Train Acc: 0.5827 Vali Acc: 0.7059
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.675 Vali Loss: 4.404
Epoch: 6, | Train Acc: 0.5755 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.655 Vali Loss: 4.381
Epoch: 7, | Train Acc: 0.5827 Vali Acc: 0.7059
Validation loss decreased (4.392066 --> 4.381484).  Saving model ...
Epoch: 8, | Train Loss: 5.624 Vali Loss: 4.461
Epoch: 8, | Train Acc: 0.5755 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.634 Vali Loss: 4.424
Epoch: 9, | Train Acc: 0.6547 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.580 Vali Loss: 4.388
Epoch: 10, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.563 Vali Loss: 4.381
Epoch: 11, | Train Acc: 0.5540 Vali Acc: 0.6765
Validation loss decreased (4.381484 --> 4.381028).  Saving model ...
Epoch: 12, | Train Loss: 5.524 Vali Loss: 4.421
Epoch: 12, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 13, | Train Loss: 5.493 Vali Loss: 4.366
Epoch: 13, | Train Acc: 0.5540 Vali Acc: 0.6765
Validation loss decreased (4.381028 --> 4.365717).  Saving model ...
Epoch: 14, | Train Loss: 5.468 Vali Loss: 4.353
Epoch: 14, | Train Acc: 0.5540 Vali Acc: 0.6765
Validation loss decreased (4.365717 --> 4.352902).  Saving model ...
Epoch: 15, | Train Loss: 5.448 Vali Loss: 4.366
Epoch: 15, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 16, | Train Loss: 5.442 Vali Loss: 4.395
Epoch: 16, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 17, | Train Loss: 5.426 Vali Loss: 4.389
Epoch: 17, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 3 out of 4
Epoch: 18, | Train Loss: 5.412 Vali Loss: 4.354
Epoch: 18, | Train Acc: 0.5540 Vali Acc: 0.6765
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           10
True 1            1           23

Accuracy:0.676471
acc_clas_0:0.000000
acc_clas_1:0.958333
total avg vali acc:0.560840  total avg vali acc_clas_0: 0.000000  total avg vali acc_clas_1: 0.991667
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=0.25, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_0.25_pretrain_True_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.689 Vali Loss: 4.661
Epoch: 1, | Train Acc: 0.5290 Vali Acc: 0.6000
Validation loss decreased (inf --> 4.660534).  Saving model ...
Epoch: 2, | Train Loss: 5.672 Vali Loss: 4.677
Epoch: 2, | Train Acc: 0.6304 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.660 Vali Loss: 4.657
Epoch: 3, | Train Acc: 0.5870 Vali Acc: 0.6571
Validation loss decreased (4.660534 --> 4.657070).  Saving model ...
Epoch: 4, | Train Loss: 5.650 Vali Loss: 4.680
Epoch: 4, | Train Acc: 0.6232 Vali Acc: 0.4286
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.606 Vali Loss: 4.669
Epoch: 5, | Train Acc: 0.7101 Vali Acc: 0.7143
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.538 Vali Loss: 4.594
Epoch: 6, | Train Acc: 0.7029 Vali Acc: 0.7429
Validation loss decreased (4.657070 --> 4.593668).  Saving model ...
Epoch: 7, | Train Loss: 5.480 Vali Loss: 4.621
Epoch: 7, | Train Acc: 0.7246 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.446 Vali Loss: 4.638
Epoch: 8, | Train Acc: 0.6522 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.278 Vali Loss: 4.717
Epoch: 9, | Train Acc: 0.7174 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.142 Vali Loss: 4.615
Epoch: 10, | Train Acc: 0.6884 Vali Acc: 0.6286
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            4            8
True 1            1           22

Accuracy:0.742857
acc_clas_0:0.333333
acc_clas_1:0.956522
Fold 2/5
Epoch: 1, | Train Loss: 5.570 Vali Loss: 4.696
Epoch: 1, | Train Acc: 0.6884 Vali Acc: 0.4857
Validation loss decreased (inf --> 4.695523).  Saving model ...
Epoch: 2, | Train Loss: 5.567 Vali Loss: 4.521
Epoch: 2, | Train Acc: 0.6884 Vali Acc: 0.6857
Validation loss decreased (4.695523 --> 4.520690).  Saving model ...
Epoch: 3, | Train Loss: 5.471 Vali Loss: 4.350
Epoch: 3, | Train Acc: 0.7391 Vali Acc: 0.6857
Validation loss decreased (4.520690 --> 4.350270).  Saving model ...
Epoch: 4, | Train Loss: 5.392 Vali Loss: 4.402
Epoch: 4, | Train Acc: 0.7464 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.327 Vali Loss: 4.470
Epoch: 5, | Train Acc: 0.7609 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.245 Vali Loss: 4.273
Epoch: 6, | Train Acc: 0.7464 Vali Acc: 0.6571
Validation loss decreased (4.350270 --> 4.272507).  Saving model ...
Epoch: 7, | Train Loss: 5.089 Vali Loss: 4.270
Epoch: 7, | Train Acc: 0.7391 Vali Acc: 0.7143
Validation loss decreased (4.272507 --> 4.270253).  Saving model ...
Epoch: 8, | Train Loss: 5.020 Vali Loss: 4.219
Epoch: 8, | Train Acc: 0.7391 Vali Acc: 0.7143
Validation loss decreased (4.270253 --> 4.219190).  Saving model ...
Epoch: 9, | Train Loss: 4.932 Vali Loss: 4.151
Epoch: 9, | Train Acc: 0.7464 Vali Acc: 0.7143
Validation loss decreased (4.219190 --> 4.151102).  Saving model ...
Epoch: 10, | Train Loss: 4.842 Vali Loss: 4.432
Epoch: 10, | Train Acc: 0.7391 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 4.771 Vali Loss: 4.337
Epoch: 11, | Train Acc: 0.7464 Vali Acc: 0.7143
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 4.751 Vali Loss: 3.990
Epoch: 12, | Train Acc: 0.7319 Vali Acc: 0.7429
Validation loss decreased (4.151102 --> 3.989922).  Saving model ...
Epoch: 13, | Train Loss: 4.664 Vali Loss: 3.991
Epoch: 13, | Train Acc: 0.7609 Vali Acc: 0.7143
EarlyStopping counter: 1 out of 4
Epoch: 14, | Train Loss: 4.611 Vali Loss: 4.129
Epoch: 14, | Train Acc: 0.7391 Vali Acc: 0.6857
EarlyStopping counter: 2 out of 4
Epoch: 15, | Train Loss: 4.642 Vali Loss: 4.136
Epoch: 15, | Train Acc: 0.7464 Vali Acc: 0.7429
EarlyStopping counter: 3 out of 4
Epoch: 16, | Train Loss: 4.561 Vali Loss: 4.208
Epoch: 16, | Train Acc: 0.7536 Vali Acc: 0.7143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           12            8
True 1            1           14

Accuracy:0.742857
acc_clas_0:0.600000
acc_clas_1:0.933333
Fold 3/5
Epoch: 1, | Train Loss: 4.965 Vali Loss: 3.897
Epoch: 1, | Train Acc: 0.7029 Vali Acc: 0.7714
Validation loss decreased (inf --> 3.897289).  Saving model ...
Epoch: 2, | Train Loss: 5.033 Vali Loss: 4.123
Epoch: 2, | Train Acc: 0.7246 Vali Acc: 0.8000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.022 Vali Loss: 3.869
Epoch: 3, | Train Acc: 0.6957 Vali Acc: 0.7429
Validation loss decreased (3.897289 --> 3.869396).  Saving model ...
Epoch: 4, | Train Loss: 4.851 Vali Loss: 3.864
Epoch: 4, | Train Acc: 0.7029 Vali Acc: 0.7714
Validation loss decreased (3.869396 --> 3.864445).  Saving model ...
Epoch: 5, | Train Loss: 4.812 Vali Loss: 3.891
Epoch: 5, | Train Acc: 0.7391 Vali Acc: 0.7714
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 4.753 Vali Loss: 3.948
Epoch: 6, | Train Acc: 0.7174 Vali Acc: 0.8000
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 4.756 Vali Loss: 3.795
Epoch: 7, | Train Acc: 0.7246 Vali Acc: 0.7714
Validation loss decreased (3.864445 --> 3.795490).  Saving model ...
Epoch: 8, | Train Loss: 4.717 Vali Loss: 3.646
Epoch: 8, | Train Acc: 0.7464 Vali Acc: 0.7714
Validation loss decreased (3.795490 --> 3.646097).  Saving model ...
Epoch: 9, | Train Loss: 4.653 Vali Loss: 3.954
Epoch: 9, | Train Acc: 0.7029 Vali Acc: 0.7429
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 4.584 Vali Loss: 3.944
Epoch: 10, | Train Acc: 0.7246 Vali Acc: 0.7429
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 4.593 Vali Loss: 3.648
Epoch: 11, | Train Acc: 0.7319 Vali Acc: 0.7714
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 4.547 Vali Loss: 4.019
Epoch: 12, | Train Acc: 0.7246 Vali Acc: 0.7429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            6            4
True 1            4           21

Accuracy:0.771429
acc_clas_0:0.600000
acc_clas_1:0.840000
Fold 4/5
Epoch: 1, | Train Loss: 4.837 Vali Loss: 3.211
Epoch: 1, | Train Acc: 0.7050 Vali Acc: 0.8235
Validation loss decreased (inf --> 3.211294).  Saving model ...
Epoch: 2, | Train Loss: 4.763 Vali Loss: 3.556
Epoch: 2, | Train Acc: 0.7050 Vali Acc: 0.7941
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 4.666 Vali Loss: 3.130
Epoch: 3, | Train Acc: 0.7410 Vali Acc: 0.7941
Validation loss decreased (3.211294 --> 3.129786).  Saving model ...
Epoch: 4, | Train Loss: 4.647 Vali Loss: 3.652
Epoch: 4, | Train Acc: 0.7194 Vali Acc: 0.7647
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 4.656 Vali Loss: 3.592
Epoch: 5, | Train Acc: 0.7050 Vali Acc: 0.7941
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 4.642 Vali Loss: 3.399
Epoch: 6, | Train Acc: 0.7050 Vali Acc: 0.8235
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 4.558 Vali Loss: 3.579
Epoch: 7, | Train Acc: 0.6978 Vali Acc: 0.7941
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           15            3
True 1            4           12

Accuracy:0.794118
acc_clas_0:0.833333
acc_clas_1:0.750000
Fold 5/5
Epoch: 1, | Train Loss: 4.819 Vali Loss: 3.158
Epoch: 1, | Train Acc: 0.7194 Vali Acc: 0.6765
Validation loss decreased (inf --> 3.158412).  Saving model ...
Epoch: 2, | Train Loss: 4.748 Vali Loss: 3.622
Epoch: 2, | Train Acc: 0.7050 Vali Acc: 0.7059
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 4.694 Vali Loss: 3.626
Epoch: 3, | Train Acc: 0.7410 Vali Acc: 0.7353
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 4.674 Vali Loss: 3.147
Epoch: 4, | Train Acc: 0.7482 Vali Acc: 0.7353
Validation loss decreased (3.158412 --> 3.146798).  Saving model ...
Epoch: 5, | Train Loss: 4.581 Vali Loss: 3.139
Epoch: 5, | Train Acc: 0.7482 Vali Acc: 0.7353
Validation loss decreased (3.146798 --> 3.138596).  Saving model ...
Epoch: 6, | Train Loss: 4.544 Vali Loss: 3.463
Epoch: 6, | Train Acc: 0.7482 Vali Acc: 0.7353
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 4.550 Vali Loss: 3.272
Epoch: 7, | Train Acc: 0.7266 Vali Acc: 0.7059
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 4.499 Vali Loss: 3.671
Epoch: 8, | Train Acc: 0.7554 Vali Acc: 0.7647
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 4.502 Vali Loss: 3.670
Epoch: 9, | Train Acc: 0.7626 Vali Acc: 0.7353
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            9            6
True 1            3           16

Accuracy:0.735294
acc_clas_0:0.600000
acc_clas_1:0.842105
total avg vali acc:0.757311  total avg vali acc_clas_0: 0.593333  total avg vali acc_clas_1: 0.864392
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=0.25, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_0.25_pretrain_False_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.728 Vali Loss: 4.706
Epoch: 1, | Train Acc: 0.4420 Vali Acc: 0.6571
Validation loss decreased (inf --> 4.705739).  Saving model ...
Epoch: 2, | Train Loss: 5.720 Vali Loss: 4.696
Epoch: 2, | Train Acc: 0.5435 Vali Acc: 0.6571
Validation loss decreased (4.705739 --> 4.696114).  Saving model ...
Epoch: 3, | Train Loss: 5.714 Vali Loss: 4.625
Epoch: 3, | Train Acc: 0.5435 Vali Acc: 0.6571
Validation loss decreased (4.696114 --> 4.624765).  Saving model ...
Epoch: 4, | Train Loss: 5.693 Vali Loss: 4.688
Epoch: 4, | Train Acc: 0.5435 Vali Acc: 0.3429
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.705 Vali Loss: 4.677
Epoch: 5, | Train Acc: 0.4565 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.696 Vali Loss: 4.629
Epoch: 6, | Train Acc: 0.5435 Vali Acc: 0.6571
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.693 Vali Loss: 4.685
Epoch: 7, | Train Acc: 0.5797 Vali Acc: 0.3429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           12
True 1            0           23

Accuracy:0.657143
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.706 Vali Loss: 4.678
Epoch: 1, | Train Acc: 0.4855 Vali Acc: 0.5429
Validation loss decreased (inf --> 4.677950).  Saving model ...
Epoch: 2, | Train Loss: 5.698 Vali Loss: 4.685
Epoch: 2, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.692 Vali Loss: 4.688
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.688 Vali Loss: 4.672
Epoch: 4, | Train Acc: 0.5652 Vali Acc: 0.5429
Validation loss decreased (4.677950 --> 4.671542).  Saving model ...
Epoch: 5, | Train Loss: 5.682 Vali Loss: 4.657
Epoch: 5, | Train Acc: 0.5725 Vali Acc: 0.5429
Validation loss decreased (4.671542 --> 4.657276).  Saving model ...
Epoch: 6, | Train Loss: 5.686 Vali Loss: 4.651
Epoch: 6, | Train Acc: 0.5725 Vali Acc: 0.5429
Validation loss decreased (4.657276 --> 4.651361).  Saving model ...
Epoch: 7, | Train Loss: 5.690 Vali Loss: 4.670
Epoch: 7, | Train Acc: 0.5797 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.681 Vali Loss: 4.650
Epoch: 8, | Train Acc: 0.5725 Vali Acc: 0.5429
Validation loss decreased (4.651361 --> 4.649507).  Saving model ...
Epoch: 9, | Train Loss: 5.680 Vali Loss: 4.670
Epoch: 9, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.678 Vali Loss: 4.672
Epoch: 10, | Train Acc: 0.6014 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.669 Vali Loss: 4.676
Epoch: 11, | Train Acc: 0.5797 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.663 Vali Loss: 4.638
Epoch: 12, | Train Acc: 0.5725 Vali Acc: 0.6000
Validation loss decreased (4.649507 --> 4.637749).  Saving model ...
Epoch: 13, | Train Loss: 5.650 Vali Loss: 4.647
Epoch: 13, | Train Acc: 0.5652 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 14, | Train Loss: 5.629 Vali Loss: 4.633
Epoch: 14, | Train Acc: 0.5725 Vali Acc: 0.6000
Validation loss decreased (4.637749 --> 4.633171).  Saving model ...
Epoch: 15, | Train Loss: 5.603 Vali Loss: 4.657
Epoch: 15, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 16, | Train Loss: 5.573 Vali Loss: 4.683
Epoch: 16, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 17, | Train Loss: 5.547 Vali Loss: 4.644
Epoch: 17, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 18, | Train Loss: 5.505 Vali Loss: 4.733
Epoch: 18, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3           13
True 1            1           18

Accuracy:0.600000
acc_clas_0:0.187500
acc_clas_1:0.947368
Fold 3/5
Epoch: 1, | Train Loss: 5.610 Vali Loss: 4.698
Epoch: 1, | Train Acc: 0.5870 Vali Acc: 0.5429
Validation loss decreased (inf --> 4.697776).  Saving model ...
Epoch: 2, | Train Loss: 5.574 Vali Loss: 4.734
Epoch: 2, | Train Acc: 0.5870 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.547 Vali Loss: 4.736
Epoch: 3, | Train Acc: 0.5870 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.502 Vali Loss: 4.657
Epoch: 4, | Train Acc: 0.5870 Vali Acc: 0.5429
Validation loss decreased (4.697776 --> 4.656549).  Saving model ...
Epoch: 5, | Train Loss: 5.524 Vali Loss: 4.695
Epoch: 5, | Train Acc: 0.5870 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.477 Vali Loss: 4.734
Epoch: 6, | Train Acc: 0.5870 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.466 Vali Loss: 4.755
Epoch: 7, | Train Acc: 0.5870 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.457 Vali Loss: 4.714
Epoch: 8, | Train Acc: 0.5870 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           16
True 1            0           19

Accuracy:0.542857
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.591 Vali Loss: 4.147
Epoch: 1, | Train Acc: 0.5899 Vali Acc: 0.5294
Validation loss decreased (inf --> 4.146524).  Saving model ...
Epoch: 2, | Train Loss: 5.574 Vali Loss: 4.305
Epoch: 2, | Train Acc: 0.5899 Vali Acc: 0.5294
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.528 Vali Loss: 4.219
Epoch: 3, | Train Acc: 0.5899 Vali Acc: 0.5294
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.540 Vali Loss: 4.376
Epoch: 4, | Train Acc: 0.5899 Vali Acc: 0.5294
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.517 Vali Loss: 4.277
Epoch: 5, | Train Acc: 0.5899 Vali Acc: 0.5294
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           16
True 1            0           16

Accuracy:0.529412
acc_clas_0:0.111111
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.514 Vali Loss: 4.365
Epoch: 1, | Train Acc: 0.5683 Vali Acc: 0.6176
Validation loss decreased (inf --> 4.365061).  Saving model ...
Epoch: 2, | Train Loss: 5.475 Vali Loss: 4.505
Epoch: 2, | Train Acc: 0.5683 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.484 Vali Loss: 4.428
Epoch: 3, | Train Acc: 0.5683 Vali Acc: 0.6176
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.462 Vali Loss: 4.478
Epoch: 4, | Train Acc: 0.5683 Vali Acc: 0.6176
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.424 Vali Loss: 4.406
Epoch: 5, | Train Acc: 0.5683 Vali Acc: 0.6176
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           13
True 1            0           21

Accuracy:0.617647
acc_clas_0:0.000000
acc_clas_1:1.000000
total avg vali acc:0.589412  total avg vali acc_clas_0: 0.059722  total avg vali acc_clas_1: 0.989474
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=0.25, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_0.25_pretrain_False_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.685 Vali Loss: 4.660
Epoch: 1, | Train Acc: 0.5797 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.659778).  Saving model ...
Epoch: 2, | Train Loss: 5.682 Vali Loss: 4.712
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.680 Vali Loss: 4.676
Epoch: 3, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.675 Vali Loss: 4.704
Epoch: 4, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.672 Vali Loss: 4.706
Epoch: 5, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           17
True 1            0           18

Accuracy:0.514286
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.689 Vali Loss: 4.675
Epoch: 1, | Train Acc: 0.5507 Vali Acc: 0.6571
Validation loss decreased (inf --> 4.674766).  Saving model ...
Epoch: 2, | Train Loss: 5.689 Vali Loss: 4.649
Epoch: 2, | Train Acc: 0.5290 Vali Acc: 0.6571
Validation loss decreased (4.674766 --> 4.648935).  Saving model ...
Epoch: 3, | Train Loss: 5.681 Vali Loss: 4.667
Epoch: 3, | Train Acc: 0.5435 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.679 Vali Loss: 4.670
Epoch: 4, | Train Acc: 0.6014 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.676 Vali Loss: 4.663
Epoch: 5, | Train Acc: 0.6377 Vali Acc: 0.6571
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.672 Vali Loss: 4.658
Epoch: 6, | Train Acc: 0.5870 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           12
True 1            0           23

Accuracy:0.657143
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.679 Vali Loss: 4.657
Epoch: 1, | Train Acc: 0.5942 Vali Acc: 0.4857
Validation loss decreased (inf --> 4.657344).  Saving model ...
Epoch: 2, | Train Loss: 5.676 Vali Loss: 4.672
Epoch: 2, | Train Acc: 0.5870 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.668 Vali Loss: 4.688
Epoch: 3, | Train Acc: 0.5942 Vali Acc: 0.4857
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.662 Vali Loss: 4.691
Epoch: 4, | Train Acc: 0.5942 Vali Acc: 0.4857
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.654 Vali Loss: 4.687
Epoch: 5, | Train Acc: 0.5942 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           18
True 1            0           17

Accuracy:0.485714
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.702 Vali Loss: 4.416
Epoch: 1, | Train Acc: 0.5683 Vali Acc: 0.5882
Validation loss decreased (inf --> 4.416112).  Saving model ...
Epoch: 2, | Train Loss: 5.700 Vali Loss: 4.385
Epoch: 2, | Train Acc: 0.6475 Vali Acc: 0.6176
Validation loss decreased (4.416112 --> 4.384824).  Saving model ...
Epoch: 3, | Train Loss: 5.691 Vali Loss: 4.390
Epoch: 3, | Train Acc: 0.5755 Vali Acc: 0.5588
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.689 Vali Loss: 4.363
Epoch: 4, | Train Acc: 0.5683 Vali Acc: 0.5882
Validation loss decreased (4.384824 --> 4.363191).  Saving model ...
Epoch: 5, | Train Loss: 5.683 Vali Loss: 4.384
Epoch: 5, | Train Acc: 0.5755 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.675 Vali Loss: 4.389
Epoch: 6, | Train Acc: 0.6547 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.663 Vali Loss: 4.347
Epoch: 7, | Train Acc: 0.5971 Vali Acc: 0.6176
Validation loss decreased (4.363191 --> 4.346523).  Saving model ...
Epoch: 8, | Train Loss: 5.654 Vali Loss: 4.237
Epoch: 8, | Train Acc: 0.5899 Vali Acc: 0.5588
Validation loss decreased (4.346523 --> 4.236681).  Saving model ...
Epoch: 9, | Train Loss: 5.629 Vali Loss: 4.358
Epoch: 9, | Train Acc: 0.6187 Vali Acc: 0.5588
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.617 Vali Loss: 4.414
Epoch: 10, | Train Acc: 0.6259 Vali Acc: 0.5588
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.593 Vali Loss: 4.316
Epoch: 11, | Train Acc: 0.5971 Vali Acc: 0.5588
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.571 Vali Loss: 4.320
Epoch: 12, | Train Acc: 0.6187 Vali Acc: 0.5588
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           13
True 1            2           17

Accuracy:0.558824
acc_clas_0:0.133333
acc_clas_1:0.894737
Fold 5/5
Epoch: 1, | Train Loss: 5.634 Vali Loss: 4.330
Epoch: 1, | Train Acc: 0.5899 Vali Acc: 0.6765
Validation loss decreased (inf --> 4.330323).  Saving model ...
Epoch: 2, | Train Loss: 5.597 Vali Loss: 4.326
Epoch: 2, | Train Acc: 0.5755 Vali Acc: 0.6765
Validation loss decreased (4.330323 --> 4.325870).  Saving model ...
Epoch: 3, | Train Loss: 5.581 Vali Loss: 4.327
Epoch: 3, | Train Acc: 0.5899 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.555 Vali Loss: 4.360
Epoch: 4, | Train Acc: 0.5755 Vali Acc: 0.6471
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.513 Vali Loss: 4.358
Epoch: 5, | Train Acc: 0.5683 Vali Acc: 0.6765
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.498 Vali Loss: 4.359
Epoch: 6, | Train Acc: 0.5827 Vali Acc: 0.6765
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           11
True 1            0           21

Accuracy:0.676471
acc_clas_0:0.153846
acc_clas_1:1.000000
total avg vali acc:0.578487  total avg vali acc_clas_0: 0.057436  total avg vali acc_clas_1: 0.978947
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=1.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_1.0_pretrain_True_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.687 Vali Loss: 4.691
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.5429
Validation loss decreased (inf --> 4.691035).  Saving model ...
Epoch: 2, | Train Loss: 5.650 Vali Loss: 4.677
Epoch: 2, | Train Acc: 0.6522 Vali Acc: 0.5429
Validation loss decreased (4.691035 --> 4.676589).  Saving model ...
Epoch: 3, | Train Loss: 5.621 Vali Loss: 4.669
Epoch: 3, | Train Acc: 0.7826 Vali Acc: 0.5714
Validation loss decreased (4.676589 --> 4.669104).  Saving model ...
Epoch: 4, | Train Loss: 5.582 Vali Loss: 4.662
Epoch: 4, | Train Acc: 0.9348 Vali Acc: 0.5429
Validation loss decreased (4.669104 --> 4.661962).  Saving model ...
Epoch: 5, | Train Loss: 5.535 Vali Loss: 4.664
Epoch: 5, | Train Acc: 0.9855 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.466 Vali Loss: 4.686
Epoch: 6, | Train Acc: 0.9928 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.435 Vali Loss: 4.671
Epoch: 7, | Train Acc: 0.9928 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.386 Vali Loss: 4.680
Epoch: 8, | Train Acc: 0.9928 Vali Acc: 0.6000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           16
True 1            0           19

Accuracy:0.542857
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.588 Vali Loss: 4.593
Epoch: 1, | Train Acc: 0.8913 Vali Acc: 0.8571
Validation loss decreased (inf --> 4.592564).  Saving model ...
Epoch: 2, | Train Loss: 5.527 Vali Loss: 4.592
Epoch: 2, | Train Acc: 0.9638 Vali Acc: 0.9429
Validation loss decreased (4.592564 --> 4.591596).  Saving model ...
Epoch: 3, | Train Loss: 5.479 Vali Loss: 4.576
Epoch: 3, | Train Acc: 0.9855 Vali Acc: 0.8571
Validation loss decreased (4.591596 --> 4.575527).  Saving model ...
Epoch: 4, | Train Loss: 5.415 Vali Loss: 4.566
Epoch: 4, | Train Acc: 0.9928 Vali Acc: 1.0000
Validation loss decreased (4.575527 --> 4.565946).  Saving model ...
Epoch: 5, | Train Loss: 5.389 Vali Loss: 4.533
Epoch: 5, | Train Acc: 0.9855 Vali Acc: 1.0000
Validation loss decreased (4.565946 --> 4.532718).  Saving model ...
Epoch: 6, | Train Loss: 5.325 Vali Loss: 4.520
Epoch: 6, | Train Acc: 0.9855 Vali Acc: 1.0000
Validation loss decreased (4.532718 --> 4.519516).  Saving model ...
Epoch: 7, | Train Loss: 5.307 Vali Loss: 4.444
Epoch: 7, | Train Acc: 0.9855 Vali Acc: 1.0000
Validation loss decreased (4.519516 --> 4.443958).  Saving model ...
Epoch: 8, | Train Loss: 5.262 Vali Loss: 4.481
Epoch: 8, | Train Acc: 0.9710 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.240 Vali Loss: 4.512
Epoch: 9, | Train Acc: 0.9855 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.210 Vali Loss: 4.505
Epoch: 10, | Train Acc: 0.9638 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.180 Vali Loss: 4.519
Epoch: 11, | Train Acc: 0.9565 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           15            0
True 1            0           20

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.368 Vali Loss: 4.418
Epoch: 1, | Train Acc: 0.9348 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.417796).  Saving model ...
Epoch: 2, | Train Loss: 5.302 Vali Loss: 4.343
Epoch: 2, | Train Acc: 0.9710 Vali Acc: 0.9429
Validation loss decreased (4.417796 --> 4.343354).  Saving model ...
Epoch: 3, | Train Loss: 5.269 Vali Loss: 4.566
Epoch: 3, | Train Acc: 0.9783 Vali Acc: 0.8857
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.252 Vali Loss: 4.352
Epoch: 4, | Train Acc: 0.9565 Vali Acc: 0.9143
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.225 Vali Loss: 4.340
Epoch: 5, | Train Acc: 0.9565 Vali Acc: 0.8857
Validation loss decreased (4.343354 --> 4.339997).  Saving model ...
Epoch: 6, | Train Loss: 5.197 Vali Loss: 4.537
Epoch: 6, | Train Acc: 0.9638 Vali Acc: 0.9143
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.181 Vali Loss: 4.210
Epoch: 7, | Train Acc: 0.9710 Vali Acc: 1.0000
Validation loss decreased (4.339997 --> 4.209746).  Saving model ...
Epoch: 8, | Train Loss: 5.153 Vali Loss: 4.231
Epoch: 8, | Train Acc: 0.9783 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.138 Vali Loss: 4.141
Epoch: 9, | Train Acc: 0.9783 Vali Acc: 1.0000
Validation loss decreased (4.209746 --> 4.140524).  Saving model ...
Epoch: 10, | Train Loss: 5.133 Vali Loss: 4.143
Epoch: 10, | Train Acc: 0.9638 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.106 Vali Loss: 4.523
Epoch: 11, | Train Acc: 0.9565 Vali Acc: 0.8000
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 5.099 Vali Loss: 4.538
Epoch: 12, | Train Acc: 0.9565 Vali Acc: 0.8571
EarlyStopping counter: 3 out of 4
Epoch: 13, | Train Loss: 5.090 Vali Loss: 4.585
Epoch: 13, | Train Acc: 0.9420 Vali Acc: 0.8857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           14            0
True 1            0           21

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.187 Vali Loss: 4.160
Epoch: 1, | Train Acc: 0.9568 Vali Acc: 0.8235
Validation loss decreased (inf --> 4.160156).  Saving model ...
Epoch: 2, | Train Loss: 5.175 Vali Loss: 4.072
Epoch: 2, | Train Acc: 0.9424 Vali Acc: 0.9706
Validation loss decreased (4.160156 --> 4.071894).  Saving model ...
Epoch: 3, | Train Loss: 5.144 Vali Loss: 4.141
Epoch: 3, | Train Acc: 0.9568 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.132 Vali Loss: 3.766
Epoch: 4, | Train Acc: 0.9640 Vali Acc: 1.0000
Validation loss decreased (4.071894 --> 3.766376).  Saving model ...
Epoch: 5, | Train Loss: 5.099 Vali Loss: 4.039
Epoch: 5, | Train Acc: 0.9568 Vali Acc: 0.9412
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.123 Vali Loss: 3.787
Epoch: 6, | Train Acc: 0.9424 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.079 Vali Loss: 4.182
Epoch: 7, | Train Acc: 0.9496 Vali Acc: 0.9118
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.099 Vali Loss: 4.230
Epoch: 8, | Train Acc: 0.9496 Vali Acc: 0.9412
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           13            0
True 1            0           21

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.128 Vali Loss: 3.986
Epoch: 1, | Train Acc: 0.9640 Vali Acc: 0.9412
Validation loss decreased (inf --> 3.985892).  Saving model ...
Epoch: 2, | Train Loss: 5.101 Vali Loss: 4.087
Epoch: 2, | Train Acc: 0.9640 Vali Acc: 0.9706
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.083 Vali Loss: 3.956
Epoch: 3, | Train Acc: 0.9568 Vali Acc: 0.9706
Validation loss decreased (3.985892 --> 3.956306).  Saving model ...
Epoch: 4, | Train Loss: 5.055 Vali Loss: 4.037
Epoch: 4, | Train Acc: 0.9568 Vali Acc: 0.9706
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.078 Vali Loss: 3.704
Epoch: 5, | Train Acc: 0.9640 Vali Acc: 1.0000
Validation loss decreased (3.956306 --> 3.703789).  Saving model ...
Epoch: 6, | Train Loss: 5.043 Vali Loss: 3.920
Epoch: 6, | Train Acc: 0.9640 Vali Acc: 0.9706
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.048 Vali Loss: 3.888
Epoch: 7, | Train Acc: 0.9568 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.031 Vali Loss: 3.800
Epoch: 8, | Train Acc: 0.9640 Vali Acc: 0.9706
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 4.980 Vali Loss: 3.705
Epoch: 9, | Train Acc: 0.9568 Vali Acc: 0.9706
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           17            0
True 1            0           17

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
total avg vali acc:0.908571  total avg vali acc_clas_0: 0.800000  total avg vali acc_clas_1: 1.000000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=1.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_1.0_pretrain_True_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.690 Vali Loss: 4.679
Epoch: 1, | Train Acc: 0.5580 Vali Acc: 0.6000
Validation loss decreased (inf --> 4.679400).  Saving model ...
Epoch: 2, | Train Loss: 5.669 Vali Loss: 4.678
Epoch: 2, | Train Acc: 0.6232 Vali Acc: 0.6286
Validation loss decreased (4.679400 --> 4.677876).  Saving model ...
Epoch: 3, | Train Loss: 5.641 Vali Loss: 4.662
Epoch: 3, | Train Acc: 0.7391 Vali Acc: 0.6571
Validation loss decreased (4.677876 --> 4.661788).  Saving model ...
Epoch: 4, | Train Loss: 5.616 Vali Loss: 4.661
Epoch: 4, | Train Acc: 0.9058 Vali Acc: 0.6857
Validation loss decreased (4.661788 --> 4.661188).  Saving model ...
Epoch: 5, | Train Loss: 5.593 Vali Loss: 4.680
Epoch: 5, | Train Acc: 0.9493 Vali Acc: 0.6857
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.557 Vali Loss: 4.660
Epoch: 6, | Train Acc: 0.9638 Vali Acc: 0.6857
Validation loss decreased (4.661188 --> 4.660474).  Saving model ...
Epoch: 7, | Train Loss: 5.522 Vali Loss: 4.664
Epoch: 7, | Train Acc: 0.9855 Vali Acc: 0.6857
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.496 Vali Loss: 4.683
Epoch: 8, | Train Acc: 0.9710 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.435 Vali Loss: 4.688
Epoch: 9, | Train Acc: 0.9710 Vali Acc: 0.6857
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.420 Vali Loss: 4.659
Epoch: 10, | Train Acc: 0.9420 Vali Acc: 0.6571
Validation loss decreased (4.660474 --> 4.659144).  Saving model ...
Epoch: 11, | Train Loss: 5.365 Vali Loss: 4.651
Epoch: 11, | Train Acc: 0.9420 Vali Acc: 0.6286
Validation loss decreased (4.659144 --> 4.651391).  Saving model ...
Epoch: 12, | Train Loss: 5.344 Vali Loss: 4.663
Epoch: 12, | Train Acc: 0.9275 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 13, | Train Loss: 5.280 Vali Loss: 4.652
Epoch: 13, | Train Acc: 0.9420 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 14, | Train Loss: 5.254 Vali Loss: 4.659
Epoch: 14, | Train Acc: 0.9420 Vali Acc: 0.6857
EarlyStopping counter: 3 out of 4
Epoch: 15, | Train Loss: 5.255 Vali Loss: 4.680
Epoch: 15, | Train Acc: 0.9493 Vali Acc: 0.6286
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            4            9
True 1            4           18

Accuracy:0.628571
acc_clas_0:0.307692
acc_clas_1:0.818182
Fold 2/5
Epoch: 1, | Train Loss: 5.447 Vali Loss: 4.413
Epoch: 1, | Train Acc: 0.8841 Vali Acc: 0.9143
Validation loss decreased (inf --> 4.413496).  Saving model ...
Epoch: 2, | Train Loss: 5.358 Vali Loss: 4.449
Epoch: 2, | Train Acc: 0.9058 Vali Acc: 0.9143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.327 Vali Loss: 4.459
Epoch: 3, | Train Acc: 0.9275 Vali Acc: 0.8857
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.294 Vali Loss: 4.428
Epoch: 4, | Train Acc: 0.9420 Vali Acc: 0.9429
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.283 Vali Loss: 4.401
Epoch: 5, | Train Acc: 0.9275 Vali Acc: 0.9429
Validation loss decreased (4.413496 --> 4.401151).  Saving model ...
Epoch: 6, | Train Loss: 5.261 Vali Loss: 4.378
Epoch: 6, | Train Acc: 0.9275 Vali Acc: 0.8857
Validation loss decreased (4.401151 --> 4.377635).  Saving model ...
Epoch: 7, | Train Loss: 5.212 Vali Loss: 4.377
Epoch: 7, | Train Acc: 0.9203 Vali Acc: 0.8857
Validation loss decreased (4.377635 --> 4.377423).  Saving model ...
Epoch: 8, | Train Loss: 5.198 Vali Loss: 4.405
Epoch: 8, | Train Acc: 0.9348 Vali Acc: 0.9143
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.196 Vali Loss: 4.263
Epoch: 9, | Train Acc: 0.9275 Vali Acc: 0.9143
Validation loss decreased (4.377423 --> 4.263079).  Saving model ...
Epoch: 10, | Train Loss: 5.153 Vali Loss: 4.402
Epoch: 10, | Train Acc: 0.9493 Vali Acc: 0.8857
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.128 Vali Loss: 4.266
Epoch: 11, | Train Acc: 0.9348 Vali Acc: 0.8857
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 5.126 Vali Loss: 4.404
Epoch: 12, | Train Acc: 0.9420 Vali Acc: 0.8286
EarlyStopping counter: 3 out of 4
Epoch: 13, | Train Loss: 5.102 Vali Loss: 4.293
Epoch: 13, | Train Acc: 0.9348 Vali Acc: 0.8571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           14            1
True 1            2           18

Accuracy:0.914286
acc_clas_0:0.933333
acc_clas_1:0.900000
Fold 3/5
Epoch: 1, | Train Loss: 5.208 Vali Loss: 4.333
Epoch: 1, | Train Acc: 0.8986 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.332618).  Saving model ...
Epoch: 2, | Train Loss: 5.209 Vali Loss: 4.157
Epoch: 2, | Train Acc: 0.8986 Vali Acc: 1.0000
Validation loss decreased (4.332618 --> 4.157001).  Saving model ...
Epoch: 3, | Train Loss: 5.172 Vali Loss: 4.166
Epoch: 3, | Train Acc: 0.8841 Vali Acc: 0.9714
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.191 Vali Loss: 4.071
Epoch: 4, | Train Acc: 0.8768 Vali Acc: 1.0000
Validation loss decreased (4.157001 --> 4.070839).  Saving model ...
Epoch: 5, | Train Loss: 5.138 Vali Loss: 4.099
Epoch: 5, | Train Acc: 0.8913 Vali Acc: 0.9714
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.145 Vali Loss: 4.065
Epoch: 6, | Train Acc: 0.8841 Vali Acc: 1.0000
Validation loss decreased (4.070839 --> 4.065003).  Saving model ...
Epoch: 7, | Train Loss: 5.091 Vali Loss: 4.223
Epoch: 7, | Train Acc: 0.8986 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.079 Vali Loss: 4.232
Epoch: 8, | Train Acc: 0.9058 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.066 Vali Loss: 4.167
Epoch: 9, | Train Acc: 0.8913 Vali Acc: 0.9429
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.060 Vali Loss: 4.042
Epoch: 10, | Train Acc: 0.9058 Vali Acc: 1.0000
Validation loss decreased (4.065003 --> 4.041694).  Saving model ...
Epoch: 11, | Train Loss: 5.046 Vali Loss: 4.110
Epoch: 11, | Train Acc: 0.8913 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 12, | Train Loss: 5.047 Vali Loss: 4.104
Epoch: 12, | Train Acc: 0.9203 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 13, | Train Loss: 5.039 Vali Loss: 4.226
Epoch: 13, | Train Acc: 0.8986 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 14, | Train Loss: 4.995 Vali Loss: 4.125
Epoch: 14, | Train Acc: 0.9130 Vali Acc: 0.9714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           16            0
True 1            0           19

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.112 Vali Loss: 3.711
Epoch: 1, | Train Acc: 0.9065 Vali Acc: 0.9706
Validation loss decreased (inf --> 3.710607).  Saving model ...
Epoch: 2, | Train Loss: 5.128 Vali Loss: 3.857
Epoch: 2, | Train Acc: 0.8993 Vali Acc: 0.9706
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.085 Vali Loss: 3.666
Epoch: 3, | Train Acc: 0.8921 Vali Acc: 0.9706
Validation loss decreased (3.710607 --> 3.665840).  Saving model ...
Epoch: 4, | Train Loss: 5.065 Vali Loss: 3.868
Epoch: 4, | Train Acc: 0.9065 Vali Acc: 0.9706
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.057 Vali Loss: 3.915
Epoch: 5, | Train Acc: 0.9065 Vali Acc: 0.9706
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.055 Vali Loss: 3.847
Epoch: 6, | Train Acc: 0.8993 Vali Acc: 0.9706
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.035 Vali Loss: 3.852
Epoch: 7, | Train Acc: 0.9137 Vali Acc: 0.9706
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           18            1
True 1            0           15

Accuracy:0.970588
acc_clas_0:0.947368
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.070 Vali Loss: 3.947
Epoch: 1, | Train Acc: 0.9281 Vali Acc: 0.9706
Validation loss decreased (inf --> 3.946614).  Saving model ...
Epoch: 2, | Train Loss: 5.065 Vali Loss: 3.816
Epoch: 2, | Train Acc: 0.9209 Vali Acc: 0.9706
Validation loss decreased (3.946614 --> 3.815876).  Saving model ...
Epoch: 3, | Train Loss: 5.075 Vali Loss: 3.666
Epoch: 3, | Train Acc: 0.9281 Vali Acc: 0.9706
Validation loss decreased (3.815876 --> 3.665911).  Saving model ...
Epoch: 4, | Train Loss: 5.052 Vali Loss: 3.917
Epoch: 4, | Train Acc: 0.9137 Vali Acc: 0.9706
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.023 Vali Loss: 3.715
Epoch: 5, | Train Acc: 0.9209 Vali Acc: 0.9706
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.091 Vali Loss: 3.695
Epoch: 6, | Train Acc: 0.9209 Vali Acc: 0.9706
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.013 Vali Loss: 3.854
Epoch: 7, | Train Acc: 0.9353 Vali Acc: 0.9706
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           11            1
True 1            0           22

Accuracy:0.970588
acc_clas_0:0.916667
acc_clas_1:1.000000
total avg vali acc:0.896807  total avg vali acc_clas_0: 0.821012  total avg vali acc_clas_1: 0.943636
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=1.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_1.0_pretrain_False_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.690 Vali Loss: 4.675
Epoch: 1, | Train Acc: 0.5507 Vali Acc: 0.4571
Validation loss decreased (inf --> 4.675330).  Saving model ...
Epoch: 2, | Train Loss: 5.683 Vali Loss: 4.688
Epoch: 2, | Train Acc: 0.5942 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.681 Vali Loss: 4.679
Epoch: 3, | Train Acc: 0.6087 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.673 Vali Loss: 4.690
Epoch: 4, | Train Acc: 0.5942 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.667 Vali Loss: 4.683
Epoch: 5, | Train Acc: 0.6159 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           12            5
True 1           14            4

Accuracy:0.457143
acc_clas_0:0.705882
acc_clas_1:0.222222
Fold 2/5
Epoch: 1, | Train Loss: 5.689 Vali Loss: 4.761
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.3714
Validation loss decreased (inf --> 4.761489).  Saving model ...
Epoch: 2, | Train Loss: 5.681 Vali Loss: 4.677
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.4000
Validation loss decreased (4.761489 --> 4.676986).  Saving model ...
Epoch: 3, | Train Loss: 5.679 Vali Loss: 4.670
Epoch: 3, | Train Acc: 0.5580 Vali Acc: 0.6571
Validation loss decreased (4.676986 --> 4.670060).  Saving model ...
Epoch: 4, | Train Loss: 5.671 Vali Loss: 4.642
Epoch: 4, | Train Acc: 0.5580 Vali Acc: 0.6571
Validation loss decreased (4.670060 --> 4.641594).  Saving model ...
Epoch: 5, | Train Loss: 5.661 Vali Loss: 4.674
Epoch: 5, | Train Acc: 0.6232 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.652 Vali Loss: 4.668
Epoch: 6, | Train Acc: 0.6522 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.637 Vali Loss: 4.666
Epoch: 7, | Train Acc: 0.6594 Vali Acc: 0.6857
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.615 Vali Loss: 4.655
Epoch: 8, | Train Acc: 0.7174 Vali Acc: 0.6000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           12
True 1            0           22

Accuracy:0.657143
acc_clas_0:0.076923
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.664 Vali Loss: 4.689
Epoch: 1, | Train Acc: 0.6087 Vali Acc: 0.4857
Validation loss decreased (inf --> 4.688644).  Saving model ...
Epoch: 2, | Train Loss: 5.652 Vali Loss: 4.678
Epoch: 2, | Train Acc: 0.5942 Vali Acc: 0.6000
Validation loss decreased (4.688644 --> 4.677854).  Saving model ...
Epoch: 3, | Train Loss: 5.637 Vali Loss: 4.678
Epoch: 3, | Train Acc: 0.6159 Vali Acc: 0.4571
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.624 Vali Loss: 4.682
Epoch: 4, | Train Acc: 0.6522 Vali Acc: 0.4571
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.605 Vali Loss: 4.653
Epoch: 5, | Train Acc: 0.6739 Vali Acc: 0.6000
Validation loss decreased (4.677854 --> 4.653280).  Saving model ...
Epoch: 6, | Train Loss: 5.585 Vali Loss: 4.683
Epoch: 6, | Train Acc: 0.6522 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.561 Vali Loss: 4.657
Epoch: 7, | Train Acc: 0.7101 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.542 Vali Loss: 4.643
Epoch: 8, | Train Acc: 0.6884 Vali Acc: 0.6286
Validation loss decreased (4.653280 --> 4.643442).  Saving model ...
Epoch: 9, | Train Loss: 5.514 Vali Loss: 4.630
Epoch: 9, | Train Acc: 0.7246 Vali Acc: 0.7429
Validation loss decreased (4.643442 --> 4.629595).  Saving model ...
Epoch: 10, | Train Loss: 5.476 Vali Loss: 4.633
Epoch: 10, | Train Acc: 0.7391 Vali Acc: 0.6857
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.460 Vali Loss: 4.622
Epoch: 11, | Train Acc: 0.7464 Vali Acc: 0.6571
Validation loss decreased (4.629595 --> 4.622334).  Saving model ...
Epoch: 12, | Train Loss: 5.416 Vali Loss: 4.666
Epoch: 12, | Train Acc: 0.7609 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 13, | Train Loss: 5.365 Vali Loss: 4.609
Epoch: 13, | Train Acc: 0.7826 Vali Acc: 0.6571
Validation loss decreased (4.622334 --> 4.609301).  Saving model ...
Epoch: 14, | Train Loss: 5.319 Vali Loss: 4.684
Epoch: 14, | Train Acc: 0.8043 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 15, | Train Loss: 5.251 Vali Loss: 4.657
Epoch: 15, | Train Acc: 0.8333 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 16, | Train Loss: 5.216 Vali Loss: 4.678
Epoch: 16, | Train Acc: 0.8406 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 17, | Train Loss: 5.205 Vali Loss: 4.639
Epoch: 17, | Train Acc: 0.8478 Vali Acc: 0.7714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            9            8
True 1            4           14

Accuracy:0.657143
acc_clas_0:0.529412
acc_clas_1:0.777778
Fold 4/5
Epoch: 1, | Train Loss: 5.463 Vali Loss: 4.343
Epoch: 1, | Train Acc: 0.7410 Vali Acc: 0.7059
Validation loss decreased (inf --> 4.342764).  Saving model ...
Epoch: 2, | Train Loss: 5.425 Vali Loss: 3.999
Epoch: 2, | Train Acc: 0.7410 Vali Acc: 0.8235
Validation loss decreased (4.342764 --> 3.999379).  Saving model ...
Epoch: 3, | Train Loss: 5.378 Vali Loss: 4.231
Epoch: 3, | Train Acc: 0.7698 Vali Acc: 0.7941
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.345 Vali Loss: 4.272
Epoch: 4, | Train Acc: 0.7914 Vali Acc: 0.7059
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.300 Vali Loss: 4.123
Epoch: 5, | Train Acc: 0.7986 Vali Acc: 0.7941
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.258 Vali Loss: 4.123
Epoch: 6, | Train Acc: 0.8058 Vali Acc: 0.8529
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            8            3
True 1            3           20

Accuracy:0.823529
acc_clas_0:0.727273
acc_clas_1:0.869565
Fold 5/5
Epoch: 1, | Train Loss: 5.400 Vali Loss: 4.281
Epoch: 1, | Train Acc: 0.7554 Vali Acc: 0.6765
Validation loss decreased (inf --> 4.281182).  Saving model ...
Epoch: 2, | Train Loss: 5.376 Vali Loss: 4.288
Epoch: 2, | Train Acc: 0.7482 Vali Acc: 0.7353
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.377 Vali Loss: 4.040
Epoch: 3, | Train Acc: 0.7770 Vali Acc: 0.8529
Validation loss decreased (4.281182 --> 4.039655).  Saving model ...
Epoch: 4, | Train Loss: 5.317 Vali Loss: 4.308
Epoch: 4, | Train Acc: 0.8058 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.278 Vali Loss: 4.275
Epoch: 5, | Train Acc: 0.8345 Vali Acc: 0.7059
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.235 Vali Loss: 4.134
Epoch: 6, | Train Acc: 0.8129 Vali Acc: 0.8529
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.226 Vali Loss: 4.279
Epoch: 7, | Train Acc: 0.8129 Vali Acc: 0.8824
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           15            2
True 1            3           14

Accuracy:0.852941
acc_clas_0:0.882353
acc_clas_1:0.823529
total avg vali acc:0.689580  total avg vali acc_clas_0: 0.584369  total avg vali acc_clas_1: 0.738619
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=1.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_1.0_pretrain_False_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.691 Vali Loss: 4.670
Epoch: 1, | Train Acc: 0.4928 Vali Acc: 0.6286
Validation loss decreased (inf --> 4.670444).  Saving model ...
Epoch: 2, | Train Loss: 5.684 Vali Loss: 4.665
Epoch: 2, | Train Acc: 0.5507 Vali Acc: 0.6286
Validation loss decreased (4.670444 --> 4.664626).  Saving model ...
Epoch: 3, | Train Loss: 5.680 Vali Loss: 4.653
Epoch: 3, | Train Acc: 0.5507 Vali Acc: 0.6286
Validation loss decreased (4.664626 --> 4.653403).  Saving model ...
Epoch: 4, | Train Loss: 5.680 Vali Loss: 4.689
Epoch: 4, | Train Acc: 0.5507 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.677 Vali Loss: 4.674
Epoch: 5, | Train Acc: 0.5507 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.673 Vali Loss: 4.691
Epoch: 6, | Train Acc: 0.5797 Vali Acc: 0.4286
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.672 Vali Loss: 4.679
Epoch: 7, | Train Acc: 0.5652 Vali Acc: 0.6286
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           13
True 1            0           22

Accuracy:0.628571
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.684 Vali Loss: 4.672
Epoch: 1, | Train Acc: 0.5870 Vali Acc: 0.6000
Validation loss decreased (inf --> 4.672109).  Saving model ...
Epoch: 2, | Train Loss: 5.680 Vali Loss: 4.681
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.676 Vali Loss: 4.672
Epoch: 3, | Train Acc: 0.5797 Vali Acc: 0.4857
Validation loss decreased (4.672109 --> 4.671622).  Saving model ...
Epoch: 4, | Train Loss: 5.674 Vali Loss: 4.677
Epoch: 4, | Train Acc: 0.5797 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.670 Vali Loss: 4.673
Epoch: 5, | Train Acc: 0.5942 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.666 Vali Loss: 4.669
Epoch: 6, | Train Acc: 0.5942 Vali Acc: 0.5143
Validation loss decreased (4.671622 --> 4.668979).  Saving model ...
Epoch: 7, | Train Loss: 5.661 Vali Loss: 4.666
Epoch: 7, | Train Acc: 0.6449 Vali Acc: 0.6000
Validation loss decreased (4.668979 --> 4.665915).  Saving model ...
Epoch: 8, | Train Loss: 5.654 Vali Loss: 4.667
Epoch: 8, | Train Acc: 0.7029 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.646 Vali Loss: 4.663
Epoch: 9, | Train Acc: 0.6594 Vali Acc: 0.5429
Validation loss decreased (4.665915 --> 4.663445).  Saving model ...
Epoch: 10, | Train Loss: 5.636 Vali Loss: 4.663
Epoch: 10, | Train Acc: 0.7536 Vali Acc: 0.6857
Validation loss decreased (4.663445 --> 4.663205).  Saving model ...
Epoch: 11, | Train Loss: 5.628 Vali Loss: 4.651
Epoch: 11, | Train Acc: 0.8261 Vali Acc: 0.7143
Validation loss decreased (4.663205 --> 4.651073).  Saving model ...
Epoch: 12, | Train Loss: 5.615 Vali Loss: 4.651
Epoch: 12, | Train Acc: 0.8406 Vali Acc: 0.6571
Validation loss decreased (4.651073 --> 4.650888).  Saving model ...
Epoch: 13, | Train Loss: 5.604 Vali Loss: 4.652
Epoch: 13, | Train Acc: 0.8261 Vali Acc: 0.6857
EarlyStopping counter: 1 out of 4
Epoch: 14, | Train Loss: 5.587 Vali Loss: 4.630
Epoch: 14, | Train Acc: 0.8696 Vali Acc: 0.6571
Validation loss decreased (4.650888 --> 4.629925).  Saving model ...
Epoch: 15, | Train Loss: 5.577 Vali Loss: 4.671
Epoch: 15, | Train Acc: 0.8696 Vali Acc: 0.7143
EarlyStopping counter: 1 out of 4
Epoch: 16, | Train Loss: 5.565 Vali Loss: 4.655
Epoch: 16, | Train Acc: 0.8406 Vali Acc: 0.7143
EarlyStopping counter: 2 out of 4
Epoch: 17, | Train Loss: 5.550 Vali Loss: 4.653
Epoch: 17, | Train Acc: 0.8913 Vali Acc: 0.7429
EarlyStopping counter: 3 out of 4
Epoch: 18, | Train Loss: 5.544 Vali Loss: 4.635
Epoch: 18, | Train Acc: 0.8696 Vali Acc: 0.7143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            5           12
True 1            0           18

Accuracy:0.657143
acc_clas_0:0.294118
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.601 Vali Loss: 4.640
Epoch: 1, | Train Acc: 0.8333 Vali Acc: 0.8000
Validation loss decreased (inf --> 4.639803).  Saving model ...
Epoch: 2, | Train Loss: 5.586 Vali Loss: 4.656
Epoch: 2, | Train Acc: 0.8478 Vali Acc: 0.8571
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.582 Vali Loss: 4.630
Epoch: 3, | Train Acc: 0.8406 Vali Acc: 0.8000
Validation loss decreased (4.639803 --> 4.630446).  Saving model ...
Epoch: 4, | Train Loss: 5.561 Vali Loss: 4.629
Epoch: 4, | Train Acc: 0.8406 Vali Acc: 0.7714
Validation loss decreased (4.630446 --> 4.629151).  Saving model ...
Epoch: 5, | Train Loss: 5.554 Vali Loss: 4.639
Epoch: 5, | Train Acc: 0.8696 Vali Acc: 0.7714
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.543 Vali Loss: 4.617
Epoch: 6, | Train Acc: 0.8406 Vali Acc: 0.7143
Validation loss decreased (4.629151 --> 4.616980).  Saving model ...
Epoch: 7, | Train Loss: 5.527 Vali Loss: 4.649
Epoch: 7, | Train Acc: 0.8623 Vali Acc: 0.7714
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.528 Vali Loss: 4.591
Epoch: 8, | Train Acc: 0.8768 Vali Acc: 0.7143
Validation loss decreased (4.616980 --> 4.590503).  Saving model ...
Epoch: 9, | Train Loss: 5.520 Vali Loss: 4.629
Epoch: 9, | Train Acc: 0.8841 Vali Acc: 0.8000
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.509 Vali Loss: 4.604
Epoch: 10, | Train Acc: 0.8841 Vali Acc: 0.7143
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.500 Vali Loss: 4.630
Epoch: 11, | Train Acc: 0.8913 Vali Acc: 0.8286
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.493 Vali Loss: 4.642
Epoch: 12, | Train Acc: 0.8768 Vali Acc: 0.7429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            8           10
True 1            0           17

Accuracy:0.714286
acc_clas_0:0.444444
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.593 Vali Loss: 4.310
Epoch: 1, | Train Acc: 0.8129 Vali Acc: 0.8824
Validation loss decreased (inf --> 4.309999).  Saving model ...
Epoch: 2, | Train Loss: 5.570 Vali Loss: 4.264
Epoch: 2, | Train Acc: 0.8417 Vali Acc: 0.8824
Validation loss decreased (4.309999 --> 4.263776).  Saving model ...
Epoch: 3, | Train Loss: 5.561 Vali Loss: 4.266
Epoch: 3, | Train Acc: 0.8633 Vali Acc: 0.8824
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.551 Vali Loss: 4.281
Epoch: 4, | Train Acc: 0.8345 Vali Acc: 0.8824
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.536 Vali Loss: 4.301
Epoch: 5, | Train Acc: 0.8777 Vali Acc: 0.7941
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.531 Vali Loss: 4.291
Epoch: 6, | Train Acc: 0.9137 Vali Acc: 0.8824
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           10            3
True 1            1           20

Accuracy:0.882353
acc_clas_0:0.769231
acc_clas_1:0.952381
Fold 5/5
Epoch: 1, | Train Loss: 5.572 Vali Loss: 4.286
Epoch: 1, | Train Acc: 0.8273 Vali Acc: 0.8824
Validation loss decreased (inf --> 4.286134).  Saving model ...
Epoch: 2, | Train Loss: 5.563 Vali Loss: 4.276
Epoch: 2, | Train Acc: 0.8201 Vali Acc: 0.9706
Validation loss decreased (4.286134 --> 4.275602).  Saving model ...
Epoch: 3, | Train Loss: 5.551 Vali Loss: 4.259
Epoch: 3, | Train Acc: 0.8849 Vali Acc: 0.9706
Validation loss decreased (4.275602 --> 4.259255).  Saving model ...
Epoch: 4, | Train Loss: 5.541 Vali Loss: 4.280
Epoch: 4, | Train Acc: 0.8633 Vali Acc: 0.8824
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.528 Vali Loss: 4.270
Epoch: 5, | Train Acc: 0.8561 Vali Acc: 0.9706
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.523 Vali Loss: 4.277
Epoch: 6, | Train Acc: 0.8633 Vali Acc: 0.8824
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.517 Vali Loss: 4.287
Epoch: 7, | Train Acc: 0.8993 Vali Acc: 0.9412
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           13            1
True 1            0           20

Accuracy:0.970588
acc_clas_0:0.928571
acc_clas_1:1.000000
total avg vali acc:0.770588  total avg vali acc_clas_0: 0.487273  total avg vali acc_clas_1: 0.990476
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=1.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_1.0_pretrain_True_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.689 Vali Loss: 4.658
Epoch: 1, | Train Acc: 0.5797 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.657683).  Saving model ...
Epoch: 2, | Train Loss: 5.686 Vali Loss: 4.660
Epoch: 2, | Train Acc: 0.5580 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.705 Vali Loss: 4.699
Epoch: 3, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.695 Vali Loss: 4.702
Epoch: 4, | Train Acc: 0.5362 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.684 Vali Loss: 4.702
Epoch: 5, | Train Acc: 0.5942 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           17
True 1            0           18

Accuracy:0.514286
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.698 Vali Loss: 4.659
Epoch: 1, | Train Acc: 0.5217 Vali Acc: 0.6286
Validation loss decreased (inf --> 4.659070).  Saving model ...
Epoch: 2, | Train Loss: 5.689 Vali Loss: 4.673
Epoch: 2, | Train Acc: 0.5507 Vali Acc: 0.7429
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.685 Vali Loss: 4.669
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.682 Vali Loss: 4.673
Epoch: 4, | Train Acc: 0.5725 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.695 Vali Loss: 4.635
Epoch: 5, | Train Acc: 0.5145 Vali Acc: 0.6286
Validation loss decreased (4.659070 --> 4.635146).  Saving model ...
Epoch: 6, | Train Loss: 5.713 Vali Loss: 4.665
Epoch: 6, | Train Acc: 0.4275 Vali Acc: 0.6857
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.700 Vali Loss: 4.644
Epoch: 7, | Train Acc: 0.5725 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.680 Vali Loss: 4.671
Epoch: 8, | Train Acc: 0.5507 Vali Acc: 0.8286
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.678 Vali Loss: 4.666
Epoch: 9, | Train Acc: 0.6014 Vali Acc: 0.6857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           13
True 1            0           22

Accuracy:0.628571
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.694 Vali Loss: 4.664
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.664020).  Saving model ...
Epoch: 2, | Train Loss: 5.676 Vali Loss: 4.665
Epoch: 2, | Train Acc: 0.6014 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.669 Vali Loss: 4.675
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.660 Vali Loss: 4.701
Epoch: 4, | Train Acc: 0.6232 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.666 Vali Loss: 4.699
Epoch: 5, | Train Acc: 0.6014 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           17
True 1            0           18

Accuracy:0.514286
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.698 Vali Loss: 4.416
Epoch: 1, | Train Acc: 0.5899 Vali Acc: 0.5000
Validation loss decreased (inf --> 4.415689).  Saving model ...
Epoch: 2, | Train Loss: 5.692 Vali Loss: 4.397
Epoch: 2, | Train Acc: 0.5899 Vali Acc: 0.5294
Validation loss decreased (4.415689 --> 4.396533).  Saving model ...
Epoch: 3, | Train Loss: 5.684 Vali Loss: 4.418
Epoch: 3, | Train Acc: 0.5971 Vali Acc: 0.5000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.676 Vali Loss: 4.407
Epoch: 4, | Train Acc: 0.6259 Vali Acc: 0.5000
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.670 Vali Loss: 4.425
Epoch: 5, | Train Acc: 0.5971 Vali Acc: 0.5000
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.665 Vali Loss: 4.419
Epoch: 6, | Train Acc: 0.5971 Vali Acc: 0.5294
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            4           13
True 1            3           14

Accuracy:0.529412
acc_clas_0:0.235294
acc_clas_1:0.823529
Fold 5/5
Epoch: 1, | Train Loss: 5.710 Vali Loss: 4.439
Epoch: 1, | Train Acc: 0.5252 Vali Acc: 0.6765
Validation loss decreased (inf --> 4.438790).  Saving model ...
Epoch: 2, | Train Loss: 5.709 Vali Loss: 4.378
Epoch: 2, | Train Acc: 0.5971 Vali Acc: 0.6471
Validation loss decreased (4.438790 --> 4.378300).  Saving model ...
Epoch: 3, | Train Loss: 5.689 Vali Loss: 4.365
Epoch: 3, | Train Acc: 0.5683 Vali Acc: 0.7941
Validation loss decreased (4.378300 --> 4.364807).  Saving model ...
Epoch: 4, | Train Loss: 5.687 Vali Loss: 4.350
Epoch: 4, | Train Acc: 0.5971 Vali Acc: 0.6471
Validation loss decreased (4.364807 --> 4.349749).  Saving model ...
Epoch: 5, | Train Loss: 5.679 Vali Loss: 4.381
Epoch: 5, | Train Acc: 0.5755 Vali Acc: 0.7941
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.673 Vali Loss: 4.351
Epoch: 6, | Train Acc: 0.7194 Vali Acc: 0.6471
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.682 Vali Loss: 4.327
Epoch: 7, | Train Acc: 0.5612 Vali Acc: 0.6471
Validation loss decreased (4.349749 --> 4.326889).  Saving model ...
Epoch: 8, | Train Loss: 5.671 Vali Loss: 4.369
Epoch: 8, | Train Acc: 0.6115 Vali Acc: 0.8529
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.668 Vali Loss: 4.332
Epoch: 9, | Train Acc: 0.6115 Vali Acc: 0.6471
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.645 Vali Loss: 4.350
Epoch: 10, | Train Acc: 0.6475 Vali Acc: 0.8824
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.641 Vali Loss: 4.408
Epoch: 11, | Train Acc: 0.6403 Vali Acc: 0.6471
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           11
True 1            1           22

Accuracy:0.647059
acc_clas_0:0.000000
acc_clas_1:0.956522
total avg vali acc:0.566723  total avg vali acc_clas_0: 0.047059  total avg vali acc_clas_1: 0.956010
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=1.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_1.0_pretrain_True_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.688 Vali Loss: 4.678
Epoch: 1, | Train Acc: 0.5290 Vali Acc: 0.6000
Validation loss decreased (inf --> 4.677626).  Saving model ...
Epoch: 2, | Train Loss: 5.694 Vali Loss: 4.676
Epoch: 2, | Train Acc: 0.4638 Vali Acc: 0.6286
Validation loss decreased (4.677626 --> 4.675998).  Saving model ...
Epoch: 3, | Train Loss: 5.682 Vali Loss: 4.666
Epoch: 3, | Train Acc: 0.6014 Vali Acc: 0.6571
Validation loss decreased (4.675998 --> 4.665733).  Saving model ...
Epoch: 4, | Train Loss: 5.680 Vali Loss: 4.663
Epoch: 4, | Train Acc: 0.5725 Vali Acc: 0.6286
Validation loss decreased (4.665733 --> 4.662734).  Saving model ...
Epoch: 5, | Train Loss: 5.675 Vali Loss: 4.671
Epoch: 5, | Train Acc: 0.5942 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.658 Vali Loss: 4.663
Epoch: 6, | Train Acc: 0.6739 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.671 Vali Loss: 4.671
Epoch: 7, | Train Acc: 0.6304 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.679 Vali Loss: 4.654
Epoch: 8, | Train Acc: 0.5507 Vali Acc: 0.6286
Validation loss decreased (4.662734 --> 4.653671).  Saving model ...
Epoch: 9, | Train Loss: 5.677 Vali Loss: 4.683
Epoch: 9, | Train Acc: 0.5652 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.669 Vali Loss: 4.680
Epoch: 10, | Train Acc: 0.6087 Vali Acc: 0.6857
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.663 Vali Loss: 4.656
Epoch: 11, | Train Acc: 0.6957 Vali Acc: 0.7143
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.659 Vali Loss: 4.628
Epoch: 12, | Train Acc: 0.6159 Vali Acc: 0.6857
Validation loss decreased (4.653671 --> 4.627601).  Saving model ...
Epoch: 13, | Train Loss: 5.649 Vali Loss: 4.660
Epoch: 13, | Train Acc: 0.7826 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 14, | Train Loss: 5.641 Vali Loss: 4.653
Epoch: 14, | Train Acc: 0.8551 Vali Acc: 0.7714
EarlyStopping counter: 2 out of 4
Epoch: 15, | Train Loss: 5.641 Vali Loss: 4.642
Epoch: 15, | Train Acc: 0.6304 Vali Acc: 0.7143
EarlyStopping counter: 3 out of 4
Epoch: 16, | Train Loss: 5.629 Vali Loss: 4.677
Epoch: 16, | Train Acc: 0.8478 Vali Acc: 0.6000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           11
True 1            0           22

Accuracy:0.685714
acc_clas_0:0.153846
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.659 Vali Loss: 4.651
Epoch: 1, | Train Acc: 0.5942 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.650962).  Saving model ...
Epoch: 2, | Train Loss: 5.640 Vali Loss: 4.648
Epoch: 2, | Train Acc: 0.6667 Vali Acc: 0.8571
Validation loss decreased (4.650962 --> 4.647593).  Saving model ...
Epoch: 3, | Train Loss: 5.640 Vali Loss: 4.673
Epoch: 3, | Train Acc: 0.7029 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.630 Vali Loss: 4.647
Epoch: 4, | Train Acc: 0.6377 Vali Acc: 0.6286
Validation loss decreased (4.647593 --> 4.646555).  Saving model ...
Epoch: 5, | Train Loss: 5.624 Vali Loss: 4.647
Epoch: 5, | Train Acc: 0.6667 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.608 Vali Loss: 4.614
Epoch: 6, | Train Acc: 0.6812 Vali Acc: 0.6286
Validation loss decreased (4.646555 --> 4.613739).  Saving model ...
Epoch: 7, | Train Loss: 5.613 Vali Loss: 4.607
Epoch: 7, | Train Acc: 0.7029 Vali Acc: 0.9143
Validation loss decreased (4.613739 --> 4.606653).  Saving model ...
Epoch: 8, | Train Loss: 5.623 Vali Loss: 4.646
Epoch: 8, | Train Acc: 0.8696 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.657 Vali Loss: 4.643
Epoch: 9, | Train Acc: 0.6304 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.633 Vali Loss: 4.641
Epoch: 10, | Train Acc: 0.7609 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.608 Vali Loss: 4.609
Epoch: 11, | Train Acc: 0.6667 Vali Acc: 0.8571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           14            2
True 1            1           18

Accuracy:0.914286
acc_clas_0:0.875000
acc_clas_1:0.947368
Fold 3/5
Epoch: 1, | Train Loss: 5.626 Vali Loss: 4.601
Epoch: 1, | Train Acc: 0.7391 Vali Acc: 0.8571
Validation loss decreased (inf --> 4.600629).  Saving model ...
Epoch: 2, | Train Loss: 5.634 Vali Loss: 4.613
Epoch: 2, | Train Acc: 0.7391 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.617 Vali Loss: 4.594
Epoch: 3, | Train Acc: 0.7536 Vali Acc: 0.8571
Validation loss decreased (4.600629 --> 4.593639).  Saving model ...
Epoch: 4, | Train Loss: 5.605 Vali Loss: 4.576
Epoch: 4, | Train Acc: 0.7754 Vali Acc: 0.6857
Validation loss decreased (4.593639 --> 4.576086).  Saving model ...
Epoch: 5, | Train Loss: 5.611 Vali Loss: 4.600
Epoch: 5, | Train Acc: 0.7101 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.602 Vali Loss: 4.596
Epoch: 6, | Train Acc: 0.8261 Vali Acc: 0.8286
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.595 Vali Loss: 4.582
Epoch: 7, | Train Acc: 0.7971 Vali Acc: 0.6571
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.588 Vali Loss: 4.569
Epoch: 8, | Train Acc: 0.7246 Vali Acc: 0.8000
Validation loss decreased (4.576086 --> 4.568594).  Saving model ...
Epoch: 9, | Train Loss: 5.596 Vali Loss: 4.593
Epoch: 9, | Train Acc: 0.7826 Vali Acc: 0.8286
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.593 Vali Loss: 4.613
Epoch: 10, | Train Acc: 0.8116 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.594 Vali Loss: 4.590
Epoch: 11, | Train Acc: 0.8116 Vali Acc: 0.8286
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.583 Vali Loss: 4.586
Epoch: 12, | Train Acc: 0.9275 Vali Acc: 0.8286
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           15            4
True 1            3           13

Accuracy:0.800000
acc_clas_0:0.789474
acc_clas_1:0.812500
Fold 4/5
Epoch: 1, | Train Loss: 5.616 Vali Loss: 4.291
Epoch: 1, | Train Acc: 0.8201 Vali Acc: 0.9118
Validation loss decreased (inf --> 4.291231).  Saving model ...
Epoch: 2, | Train Loss: 5.616 Vali Loss: 4.310
Epoch: 2, | Train Acc: 0.7554 Vali Acc: 0.8824
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.605 Vali Loss: 4.320
Epoch: 3, | Train Acc: 0.8489 Vali Acc: 0.9412
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.604 Vali Loss: 4.274
Epoch: 4, | Train Acc: 0.8058 Vali Acc: 0.8235
Validation loss decreased (4.291231 --> 4.274486).  Saving model ...
Epoch: 5, | Train Loss: 5.598 Vali Loss: 4.302
Epoch: 5, | Train Acc: 0.8273 Vali Acc: 0.9412
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.594 Vali Loss: 4.318
Epoch: 6, | Train Acc: 0.8129 Vali Acc: 0.8824
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.594 Vali Loss: 4.307
Epoch: 7, | Train Acc: 0.8705 Vali Acc: 0.8824
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.592 Vali Loss: 4.328
Epoch: 8, | Train Acc: 0.8993 Vali Acc: 0.9412
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            5            6
True 1            0           23

Accuracy:0.823529
acc_clas_0:0.454545
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.590 Vali Loss: 4.334
Epoch: 1, | Train Acc: 0.7338 Vali Acc: 0.8529
Validation loss decreased (inf --> 4.334367).  Saving model ...
Epoch: 2, | Train Loss: 5.584 Vali Loss: 4.319
Epoch: 2, | Train Acc: 0.7482 Vali Acc: 0.8235
Validation loss decreased (4.334367 --> 4.318700).  Saving model ...
Epoch: 3, | Train Loss: 5.563 Vali Loss: 4.294
Epoch: 3, | Train Acc: 0.8849 Vali Acc: 0.7941
Validation loss decreased (4.318700 --> 4.293854).  Saving model ...
Epoch: 4, | Train Loss: 5.589 Vali Loss: 4.354
Epoch: 4, | Train Acc: 0.8129 Vali Acc: 0.7059
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.614 Vali Loss: 4.320
Epoch: 5, | Train Acc: 0.7554 Vali Acc: 0.7059
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.599 Vali Loss: 4.328
Epoch: 6, | Train Acc: 0.8777 Vali Acc: 0.9412
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.592 Vali Loss: 4.341
Epoch: 7, | Train Acc: 0.9353 Vali Acc: 0.8235
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            9            7
True 1            0           18

Accuracy:0.794118
acc_clas_0:0.562500
acc_clas_1:1.000000
total avg vali acc:0.803529  total avg vali acc_clas_0: 0.567073  total avg vali acc_clas_1: 0.951974
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=1.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_1.0_pretrain_False_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.693 Vali Loss: 4.761
Epoch: 1, | Train Acc: 0.5797 Vali Acc: 0.4000
Validation loss decreased (inf --> 4.761385).  Saving model ...
Epoch: 2, | Train Loss: 5.687 Vali Loss: 4.756
Epoch: 2, | Train Acc: 0.6087 Vali Acc: 0.4000
Validation loss decreased (4.761385 --> 4.755700).  Saving model ...
Epoch: 3, | Train Loss: 5.687 Vali Loss: 4.738
Epoch: 3, | Train Acc: 0.6087 Vali Acc: 0.4000
Validation loss decreased (4.755700 --> 4.738360).  Saving model ...
Epoch: 4, | Train Loss: 5.686 Vali Loss: 4.753
Epoch: 4, | Train Acc: 0.6087 Vali Acc: 0.4000
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.675 Vali Loss: 4.706
Epoch: 5, | Train Acc: 0.6159 Vali Acc: 0.4000
Validation loss decreased (4.738360 --> 4.706300).  Saving model ...
Epoch: 6, | Train Loss: 5.677 Vali Loss: 4.703
Epoch: 6, | Train Acc: 0.6087 Vali Acc: 0.4000
Validation loss decreased (4.706300 --> 4.702947).  Saving model ...
Epoch: 7, | Train Loss: 5.671 Vali Loss: 4.684
Epoch: 7, | Train Acc: 0.6159 Vali Acc: 0.4000
Validation loss decreased (4.702947 --> 4.684492).  Saving model ...
Epoch: 8, | Train Loss: 5.671 Vali Loss: 4.764
Epoch: 8, | Train Acc: 0.6304 Vali Acc: 0.4000
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.671 Vali Loss: 4.752
Epoch: 9, | Train Acc: 0.6087 Vali Acc: 0.4000
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.661 Vali Loss: 4.691
Epoch: 10, | Train Acc: 0.6159 Vali Acc: 0.4571
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.666 Vali Loss: 4.674
Epoch: 11, | Train Acc: 0.6449 Vali Acc: 0.4286
Validation loss decreased (4.684492 --> 4.673943).  Saving model ...
Epoch: 12, | Train Loss: 5.659 Vali Loss: 4.684
Epoch: 12, | Train Acc: 0.6304 Vali Acc: 0.4571
EarlyStopping counter: 1 out of 4
Epoch: 13, | Train Loss: 5.654 Vali Loss: 4.680
Epoch: 13, | Train Acc: 0.6159 Vali Acc: 0.4286
EarlyStopping counter: 2 out of 4
Epoch: 14, | Train Loss: 5.644 Vali Loss: 4.689
Epoch: 14, | Train Acc: 0.7464 Vali Acc: 0.4571
EarlyStopping counter: 3 out of 4
Epoch: 15, | Train Loss: 5.633 Vali Loss: 4.708
Epoch: 15, | Train Acc: 0.6304 Vali Acc: 0.4571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           20
True 1            0           14

Accuracy:0.428571
acc_clas_0:0.047619
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.675 Vali Loss: 4.652
Epoch: 1, | Train Acc: 0.5870 Vali Acc: 0.6000
Validation loss decreased (inf --> 4.651618).  Saving model ...
Epoch: 2, | Train Loss: 5.671 Vali Loss: 4.663
Epoch: 2, | Train Acc: 0.5870 Vali Acc: 0.7143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.652 Vali Loss: 4.661
Epoch: 3, | Train Acc: 0.6377 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.653 Vali Loss: 4.626
Epoch: 4, | Train Acc: 0.5725 Vali Acc: 0.6857
Validation loss decreased (4.651618 --> 4.625577).  Saving model ...
Epoch: 5, | Train Loss: 5.651 Vali Loss: 4.637
Epoch: 5, | Train Acc: 0.5797 Vali Acc: 0.6857
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.651 Vali Loss: 4.642
Epoch: 6, | Train Acc: 0.7319 Vali Acc: 0.6857
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.639 Vali Loss: 4.630
Epoch: 7, | Train Acc: 0.6304 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.635 Vali Loss: 4.636
Epoch: 8, | Train Acc: 0.7536 Vali Acc: 0.6857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3           11
True 1            0           21

Accuracy:0.685714
acc_clas_0:0.214286
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.650 Vali Loss: 4.618
Epoch: 1, | Train Acc: 0.6014 Vali Acc: 0.6000
Validation loss decreased (inf --> 4.618057).  Saving model ...
Epoch: 2, | Train Loss: 5.662 Vali Loss: 4.704
Epoch: 2, | Train Acc: 0.5942 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.641 Vali Loss: 4.638
Epoch: 3, | Train Acc: 0.5870 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.636 Vali Loss: 4.645
Epoch: 4, | Train Acc: 0.7319 Vali Acc: 0.7143
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.626 Vali Loss: 4.629
Epoch: 5, | Train Acc: 0.5942 Vali Acc: 0.5714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           14
True 1            0           21

Accuracy:0.600000
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.676 Vali Loss: 4.301
Epoch: 1, | Train Acc: 0.6403 Vali Acc: 0.6176
Validation loss decreased (inf --> 4.301198).  Saving model ...
Epoch: 2, | Train Loss: 5.665 Vali Loss: 4.339
Epoch: 2, | Train Acc: 0.6619 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.660 Vali Loss: 4.244
Epoch: 3, | Train Acc: 0.6115 Vali Acc: 0.6176
Validation loss decreased (4.301198 --> 4.244432).  Saving model ...
Epoch: 4, | Train Loss: 5.665 Vali Loss: 4.337
Epoch: 4, | Train Acc: 0.7842 Vali Acc: 0.6471
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.650 Vali Loss: 4.346
Epoch: 5, | Train Acc: 0.5899 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.645 Vali Loss: 4.312
Epoch: 6, | Train Acc: 0.7122 Vali Acc: 0.6471
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.640 Vali Loss: 4.327
Epoch: 7, | Train Acc: 0.7194 Vali Acc: 0.6471
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3           12
True 1            1           18

Accuracy:0.617647
acc_clas_0:0.200000
acc_clas_1:0.947368
Fold 5/5
Epoch: 1, | Train Loss: 5.658 Vali Loss: 4.341
Epoch: 1, | Train Acc: 0.6547 Vali Acc: 0.6765
Validation loss decreased (inf --> 4.340718).  Saving model ...
Epoch: 2, | Train Loss: 5.652 Vali Loss: 4.352
Epoch: 2, | Train Acc: 0.6835 Vali Acc: 0.7941
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.649 Vali Loss: 4.379
Epoch: 3, | Train Acc: 0.7194 Vali Acc: 0.6176
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.637 Vali Loss: 4.377
Epoch: 4, | Train Acc: 0.6115 Vali Acc: 0.8235
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.648 Vali Loss: 4.368
Epoch: 5, | Train Acc: 0.7770 Vali Acc: 0.6471
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           11
True 1            0           23

Accuracy:0.676471
acc_clas_0:0.000000
acc_clas_1:1.000000
total avg vali acc:0.601681  total avg vali acc_clas_0: 0.092381  total avg vali acc_clas_1: 0.989474
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=1.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_1.0_pretrain_False_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.695 Vali Loss: 4.687
Epoch: 1, | Train Acc: 0.5362 Vali Acc: 0.5429
Validation loss decreased (inf --> 4.686915).  Saving model ...
Epoch: 2, | Train Loss: 5.686 Vali Loss: 4.695
Epoch: 2, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.684 Vali Loss: 4.672
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.5429
Validation loss decreased (4.686915 --> 4.672497).  Saving model ...
Epoch: 4, | Train Loss: 5.680 Vali Loss: 4.684
Epoch: 4, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.680 Vali Loss: 4.656
Epoch: 5, | Train Acc: 0.5725 Vali Acc: 0.5429
Validation loss decreased (4.672497 --> 4.655883).  Saving model ...
Epoch: 6, | Train Loss: 5.678 Vali Loss: 4.681
Epoch: 6, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.675 Vali Loss: 4.670
Epoch: 7, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.672 Vali Loss: 4.669
Epoch: 8, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.669 Vali Loss: 4.680
Epoch: 9, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           16
True 1            0           19

Accuracy:0.542857
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.681 Vali Loss: 4.680
Epoch: 1, | Train Acc: 0.5870 Vali Acc: 0.4857
Validation loss decreased (inf --> 4.679808).  Saving model ...
Epoch: 2, | Train Loss: 5.677 Vali Loss: 4.682
Epoch: 2, | Train Acc: 0.5870 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.674 Vali Loss: 4.681
Epoch: 3, | Train Acc: 0.5870 Vali Acc: 0.4857
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.676 Vali Loss: 4.653
Epoch: 4, | Train Acc: 0.5870 Vali Acc: 0.4857
Validation loss decreased (4.679808 --> 4.652949).  Saving model ...
Epoch: 5, | Train Loss: 5.668 Vali Loss: 4.683
Epoch: 5, | Train Acc: 0.5870 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.665 Vali Loss: 4.667
Epoch: 6, | Train Acc: 0.5870 Vali Acc: 0.4857
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.665 Vali Loss: 4.662
Epoch: 7, | Train Acc: 0.6594 Vali Acc: 0.4857
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.659 Vali Loss: 4.693
Epoch: 8, | Train Acc: 0.6014 Vali Acc: 0.4857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           18
True 1            0           17

Accuracy:0.485714
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.676 Vali Loss: 4.643
Epoch: 1, | Train Acc: 0.5580 Vali Acc: 0.6286
Validation loss decreased (inf --> 4.642656).  Saving model ...
Epoch: 2, | Train Loss: 5.671 Vali Loss: 4.673
Epoch: 2, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.668 Vali Loss: 4.652
Epoch: 3, | Train Acc: 0.5652 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.663 Vali Loss: 4.651
Epoch: 4, | Train Acc: 0.6159 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.661 Vali Loss: 4.658
Epoch: 5, | Train Acc: 0.7319 Vali Acc: 0.6286
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           13
True 1            0           21

Accuracy:0.628571
acc_clas_0:0.071429
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.695 Vali Loss: 4.387
Epoch: 1, | Train Acc: 0.5683 Vali Acc: 0.7353
Validation loss decreased (inf --> 4.387124).  Saving model ...
Epoch: 2, | Train Loss: 5.690 Vali Loss: 4.385
Epoch: 2, | Train Acc: 0.7266 Vali Acc: 0.7059
Validation loss decreased (4.387124 --> 4.384905).  Saving model ...
Epoch: 3, | Train Loss: 5.687 Vali Loss: 4.374
Epoch: 3, | Train Acc: 0.5899 Vali Acc: 0.6471
Validation loss decreased (4.384905 --> 4.374109).  Saving model ...
Epoch: 4, | Train Loss: 5.682 Vali Loss: 4.364
Epoch: 4, | Train Acc: 0.6691 Vali Acc: 0.8529
Validation loss decreased (4.374109 --> 4.363734).  Saving model ...
Epoch: 5, | Train Loss: 5.678 Vali Loss: 4.383
Epoch: 5, | Train Acc: 0.8058 Vali Acc: 0.7647
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.675 Vali Loss: 4.358
Epoch: 6, | Train Acc: 0.6547 Vali Acc: 0.7059
Validation loss decreased (4.363734 --> 4.358245).  Saving model ...
Epoch: 7, | Train Loss: 5.668 Vali Loss: 4.381
Epoch: 7, | Train Acc: 0.7338 Vali Acc: 0.8235
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.666 Vali Loss: 4.367
Epoch: 8, | Train Acc: 0.8777 Vali Acc: 0.8235
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.659 Vali Loss: 4.369
Epoch: 9, | Train Acc: 0.8705 Vali Acc: 0.7647
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.657 Vali Loss: 4.377
Epoch: 10, | Train Acc: 0.7698 Vali Acc: 0.8529
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           10
True 1            0           22

Accuracy:0.705882
acc_clas_0:0.166667
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.675 Vali Loss: 4.347
Epoch: 1, | Train Acc: 0.6763 Vali Acc: 0.7353
Validation loss decreased (inf --> 4.346835).  Saving model ...
Epoch: 2, | Train Loss: 5.670 Vali Loss: 4.363
Epoch: 2, | Train Acc: 0.7626 Vali Acc: 0.7059
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.667 Vali Loss: 4.338
Epoch: 3, | Train Acc: 0.7122 Vali Acc: 0.6471
Validation loss decreased (4.346835 --> 4.337728).  Saving model ...
Epoch: 4, | Train Loss: 5.663 Vali Loss: 4.366
Epoch: 4, | Train Acc: 0.7482 Vali Acc: 0.8235
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.661 Vali Loss: 4.368
Epoch: 5, | Train Acc: 0.8129 Vali Acc: 0.8235
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.659 Vali Loss: 4.336
Epoch: 6, | Train Acc: 0.7626 Vali Acc: 0.6471
Validation loss decreased (4.337728 --> 4.335670).  Saving model ...
Epoch: 7, | Train Loss: 5.653 Vali Loss: 4.342
Epoch: 7, | Train Acc: 0.7626 Vali Acc: 0.8529
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.654 Vali Loss: 4.350
Epoch: 8, | Train Acc: 0.8993 Vali Acc: 0.8529
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.651 Vali Loss: 4.380
Epoch: 9, | Train Acc: 0.7698 Vali Acc: 0.6471
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.648 Vali Loss: 4.342
Epoch: 10, | Train Acc: 0.8489 Vali Acc: 0.8824
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3           12
True 1            0           19

Accuracy:0.647059
acc_clas_0:0.200000
acc_clas_1:1.000000
total avg vali acc:0.602017  total avg vali acc_clas_0: 0.087619  total avg vali acc_clas_1: 1.000000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=4.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_4.0_pretrain_True_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.687 Vali Loss: 4.677
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.676864).  Saving model ...
Epoch: 2, | Train Loss: 5.663 Vali Loss: 4.673
Epoch: 2, | Train Acc: 0.6014 Vali Acc: 0.5429
Validation loss decreased (4.676864 --> 4.673179).  Saving model ...
Epoch: 3, | Train Loss: 5.632 Vali Loss: 4.653
Epoch: 3, | Train Acc: 0.7536 Vali Acc: 0.6571
Validation loss decreased (4.673179 --> 4.653337).  Saving model ...
Epoch: 4, | Train Loss: 5.603 Vali Loss: 4.680
Epoch: 4, | Train Acc: 0.9348 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.571 Vali Loss: 4.689
Epoch: 5, | Train Acc: 0.9855 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.537 Vali Loss: 4.701
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.519 Vali Loss: 4.687
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 0.6286
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            4           12
True 1            0           19

Accuracy:0.657143
acc_clas_0:0.250000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.633 Vali Loss: 4.623
Epoch: 1, | Train Acc: 0.7609 Vali Acc: 0.7714
Validation loss decreased (inf --> 4.622546).  Saving model ...
Epoch: 2, | Train Loss: 5.588 Vali Loss: 4.589
Epoch: 2, | Train Acc: 0.9348 Vali Acc: 0.8571
Validation loss decreased (4.622546 --> 4.588506).  Saving model ...
Epoch: 3, | Train Loss: 5.552 Vali Loss: 4.612
Epoch: 3, | Train Acc: 0.9855 Vali Acc: 0.8857
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.535 Vali Loss: 4.580
Epoch: 4, | Train Acc: 1.0000 Vali Acc: 0.8286
Validation loss decreased (4.588506 --> 4.580370).  Saving model ...
Epoch: 5, | Train Loss: 5.523 Vali Loss: 4.621
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 0.8286
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.496 Vali Loss: 4.582
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 0.8571
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.484 Vali Loss: 4.571
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 0.9143
Validation loss decreased (4.580370 --> 4.570719).  Saving model ...
Epoch: 8, | Train Loss: 5.469 Vali Loss: 4.574
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 0.9429
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.456 Vali Loss: 4.553
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 0.8857
Validation loss decreased (4.570719 --> 4.553248).  Saving model ...
Epoch: 10, | Train Loss: 5.447 Vali Loss: 4.522
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 0.9429
Validation loss decreased (4.553248 --> 4.521717).  Saving model ...
Epoch: 11, | Train Loss: 5.429 Vali Loss: 4.512
Epoch: 11, | Train Acc: 1.0000 Vali Acc: 0.8857
Validation loss decreased (4.521717 --> 4.512211).  Saving model ...
Epoch: 12, | Train Loss: 5.425 Vali Loss: 4.534
Epoch: 12, | Train Acc: 1.0000 Vali Acc: 0.9143
EarlyStopping counter: 1 out of 4
Epoch: 13, | Train Loss: 5.419 Vali Loss: 4.535
Epoch: 13, | Train Acc: 1.0000 Vali Acc: 0.8571
EarlyStopping counter: 2 out of 4
Epoch: 14, | Train Loss: 5.404 Vali Loss: 4.551
Epoch: 14, | Train Acc: 1.0000 Vali Acc: 0.8857
EarlyStopping counter: 3 out of 4
Epoch: 15, | Train Loss: 5.405 Vali Loss: 4.525
Epoch: 15, | Train Acc: 1.0000 Vali Acc: 0.9429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           11            4
True 1            0           20

Accuracy:0.885714
acc_clas_0:0.733333
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.469 Vali Loss: 4.532
Epoch: 1, | Train Acc: 0.9638 Vali Acc: 0.8857
Validation loss decreased (inf --> 4.531632).  Saving model ...
Epoch: 2, | Train Loss: 5.454 Vali Loss: 4.494
Epoch: 2, | Train Acc: 0.9855 Vali Acc: 0.9714
Validation loss decreased (4.531632 --> 4.493927).  Saving model ...
Epoch: 3, | Train Loss: 5.435 Vali Loss: 4.418
Epoch: 3, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.493927 --> 4.418497).  Saving model ...
Epoch: 4, | Train Loss: 5.421 Vali Loss: 4.426
Epoch: 4, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.421 Vali Loss: 4.404
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.418497 --> 4.403853).  Saving model ...
Epoch: 6, | Train Loss: 5.410 Vali Loss: 4.375
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.403853 --> 4.374682).  Saving model ...
Epoch: 7, | Train Loss: 5.406 Vali Loss: 4.402
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.390 Vali Loss: 4.424
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.385 Vali Loss: 4.393
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.380 Vali Loss: 4.420
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           13            0
True 1            0           22

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.427 Vali Loss: 4.132
Epoch: 1, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.131532).  Saving model ...
Epoch: 2, | Train Loss: 5.424 Vali Loss: 4.097
Epoch: 2, | Train Acc: 1.0000 Vali Acc: 0.9412
Validation loss decreased (4.131532 --> 4.097488).  Saving model ...
Epoch: 3, | Train Loss: 5.420 Vali Loss: 4.136
Epoch: 3, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.413 Vali Loss: 4.247
Epoch: 4, | Train Acc: 0.9928 Vali Acc: 0.7647
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.428 Vali Loss: 4.263
Epoch: 5, | Train Acc: 0.9928 Vali Acc: 0.8824
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.397 Vali Loss: 4.232
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 0.9118
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           15            2
True 1            0           17

Accuracy:0.941176
acc_clas_0:0.882353
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.418 Vali Loss: 4.098
Epoch: 1, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.097796).  Saving model ...
Epoch: 2, | Train Loss: 5.412 Vali Loss: 4.129
Epoch: 2, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.400 Vali Loss: 4.142
Epoch: 3, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.395 Vali Loss: 4.110
Epoch: 4, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.391 Vali Loss: 4.150
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           14            0
True 1            0           20

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
total avg vali acc:0.896807  total avg vali acc_clas_0: 0.773137  total avg vali acc_clas_1: 1.000000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=4.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_4.0_pretrain_True_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.689 Vali Loss: 4.684
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.684339).  Saving model ...
Epoch: 2, | Train Loss: 5.671 Vali Loss: 4.676
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.5714
Validation loss decreased (4.684339 --> 4.675813).  Saving model ...
Epoch: 3, | Train Loss: 5.650 Vali Loss: 4.673
Epoch: 3, | Train Acc: 0.6884 Vali Acc: 0.5714
Validation loss decreased (4.675813 --> 4.672801).  Saving model ...
Epoch: 4, | Train Loss: 5.628 Vali Loss: 4.673
Epoch: 4, | Train Acc: 0.8623 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.607 Vali Loss: 4.690
Epoch: 5, | Train Acc: 0.9493 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.593 Vali Loss: 4.683
Epoch: 6, | Train Acc: 0.9710 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.579 Vali Loss: 4.665
Epoch: 7, | Train Acc: 0.9493 Vali Acc: 0.6286
Validation loss decreased (4.672801 --> 4.665009).  Saving model ...
Epoch: 8, | Train Loss: 5.560 Vali Loss: 4.670
Epoch: 8, | Train Acc: 0.9855 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.541 Vali Loss: 4.669
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 0.6857
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.520 Vali Loss: 4.652
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 0.6286
Validation loss decreased (4.665009 --> 4.651640).  Saving model ...
Epoch: 11, | Train Loss: 5.512 Vali Loss: 4.665
Epoch: 11, | Train Acc: 0.9928 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 12, | Train Loss: 5.498 Vali Loss: 4.659
Epoch: 12, | Train Acc: 1.0000 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 13, | Train Loss: 5.474 Vali Loss: 4.674
Epoch: 13, | Train Acc: 1.0000 Vali Acc: 0.6571
EarlyStopping counter: 3 out of 4
Epoch: 14, | Train Loss: 5.461 Vali Loss: 4.690
Epoch: 14, | Train Acc: 1.0000 Vali Acc: 0.6857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           13
True 1            0           20

Accuracy:0.628571
acc_clas_0:0.133333
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.567 Vali Loss: 4.510
Epoch: 1, | Train Acc: 0.9275 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.509940).  Saving model ...
Epoch: 2, | Train Loss: 5.542 Vali Loss: 4.573
Epoch: 2, | Train Acc: 0.9493 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.529 Vali Loss: 4.510
Epoch: 3, | Train Acc: 0.9783 Vali Acc: 1.0000
Validation loss decreased (4.509940 --> 4.509753).  Saving model ...
Epoch: 4, | Train Loss: 5.509 Vali Loss: 4.491
Epoch: 4, | Train Acc: 0.9855 Vali Acc: 1.0000
Validation loss decreased (4.509753 --> 4.490968).  Saving model ...
Epoch: 5, | Train Loss: 5.502 Vali Loss: 4.485
Epoch: 5, | Train Acc: 0.9928 Vali Acc: 1.0000
Validation loss decreased (4.490968 --> 4.485454).  Saving model ...
Epoch: 6, | Train Loss: 5.487 Vali Loss: 4.477
Epoch: 6, | Train Acc: 0.9928 Vali Acc: 1.0000
Validation loss decreased (4.485454 --> 4.476757).  Saving model ...
Epoch: 7, | Train Loss: 5.474 Vali Loss: 4.479
Epoch: 7, | Train Acc: 0.9928 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.467 Vali Loss: 4.479
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.451 Vali Loss: 4.465
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.476757 --> 4.464517).  Saving model ...
Epoch: 10, | Train Loss: 5.453 Vali Loss: 4.454
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.464517 --> 4.454016).  Saving model ...
Epoch: 11, | Train Loss: 5.443 Vali Loss: 4.457
Epoch: 11, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 12, | Train Loss: 5.439 Vali Loss: 4.467
Epoch: 12, | Train Acc: 0.9928 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 13, | Train Loss: 5.434 Vali Loss: 4.475
Epoch: 13, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 14, | Train Loss: 5.421 Vali Loss: 4.449
Epoch: 14, | Train Acc: 0.9928 Vali Acc: 1.0000
Validation loss decreased (4.454016 --> 4.448916).  Saving model ...
Epoch: 15, | Train Loss: 5.418 Vali Loss: 4.472
Epoch: 15, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 16, | Train Loss: 5.406 Vali Loss: 4.462
Epoch: 16, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 17, | Train Loss: 5.392 Vali Loss: 4.504
Epoch: 17, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 18, | Train Loss: 5.392 Vali Loss: 4.470
Epoch: 18, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           12            0
True 1            0           23

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.450 Vali Loss: 4.498
Epoch: 1, | Train Acc: 0.9783 Vali Acc: 0.9714
Validation loss decreased (inf --> 4.497937).  Saving model ...
Epoch: 2, | Train Loss: 5.425 Vali Loss: 4.427
Epoch: 2, | Train Acc: 0.9928 Vali Acc: 1.0000
Validation loss decreased (4.497937 --> 4.427365).  Saving model ...
Epoch: 3, | Train Loss: 5.401 Vali Loss: 4.405
Epoch: 3, | Train Acc: 0.9928 Vali Acc: 1.0000
Validation loss decreased (4.427365 --> 4.405322).  Saving model ...
Epoch: 4, | Train Loss: 5.401 Vali Loss: 4.435
Epoch: 4, | Train Acc: 0.9928 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.400 Vali Loss: 4.460
Epoch: 5, | Train Acc: 0.9928 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.387 Vali Loss: 4.491
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 0.9714
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.376 Vali Loss: 4.397
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.405322 --> 4.397195).  Saving model ...
Epoch: 8, | Train Loss: 5.376 Vali Loss: 4.423
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.354 Vali Loss: 4.402
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.356 Vali Loss: 4.432
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.353 Vali Loss: 4.416
Epoch: 11, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           16            0
True 1            0           19

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.417 Vali Loss: 4.122
Epoch: 1, | Train Acc: 0.9928 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.121988).  Saving model ...
Epoch: 2, | Train Loss: 5.412 Vali Loss: 4.062
Epoch: 2, | Train Acc: 0.9928 Vali Acc: 1.0000
Validation loss decreased (4.121988 --> 4.061731).  Saving model ...
Epoch: 3, | Train Loss: 5.397 Vali Loss: 4.118
Epoch: 3, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.386 Vali Loss: 4.105
Epoch: 4, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.371 Vali Loss: 4.104
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.369 Vali Loss: 4.116
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           14            0
True 1            0           20

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.407 Vali Loss: 4.239
Epoch: 1, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.239031).  Saving model ...
Epoch: 2, | Train Loss: 5.393 Vali Loss: 4.134
Epoch: 2, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.239031 --> 4.133607).  Saving model ...
Epoch: 3, | Train Loss: 5.376 Vali Loss: 4.079
Epoch: 3, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.133607 --> 4.078531).  Saving model ...
Epoch: 4, | Train Loss: 5.371 Vali Loss: 4.107
Epoch: 4, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.363 Vali Loss: 4.087
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.356 Vali Loss: 4.121
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.359 Vali Loss: 4.067
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.078531 --> 4.066753).  Saving model ...
Epoch: 8, | Train Loss: 5.366 Vali Loss: 4.051
Epoch: 8, | Train Acc: 0.9928 Vali Acc: 1.0000
Validation loss decreased (4.066753 --> 4.050899).  Saving model ...
Epoch: 9, | Train Loss: 5.345 Vali Loss: 4.106
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.350 Vali Loss: 4.120
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.351 Vali Loss: 4.130
Epoch: 11, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.348 Vali Loss: 4.116
Epoch: 12, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           18            0
True 1            0           16

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
total avg vali acc:0.925714  total avg vali acc_clas_0: 0.826667  total avg vali acc_clas_1: 1.000000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=4.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_4.0_pretrain_False_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.690 Vali Loss: 4.677
Epoch: 1, | Train Acc: 0.5507 Vali Acc: 0.6286
Validation loss decreased (inf --> 4.676935).  Saving model ...
Epoch: 2, | Train Loss: 5.678 Vali Loss: 4.698
Epoch: 2, | Train Acc: 0.5870 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.674 Vali Loss: 4.659
Epoch: 3, | Train Acc: 0.5797 Vali Acc: 0.6286
Validation loss decreased (4.676935 --> 4.659139).  Saving model ...
Epoch: 4, | Train Loss: 5.672 Vali Loss: 4.648
Epoch: 4, | Train Acc: 0.5580 Vali Acc: 0.6286
Validation loss decreased (4.659139 --> 4.647700).  Saving model ...
Epoch: 5, | Train Loss: 5.670 Vali Loss: 4.676
Epoch: 5, | Train Acc: 0.5942 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.660 Vali Loss: 4.688
Epoch: 6, | Train Acc: 0.6594 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.654 Vali Loss: 4.674
Epoch: 7, | Train Acc: 0.6594 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.643 Vali Loss: 4.690
Epoch: 8, | Train Acc: 0.7464 Vali Acc: 0.4000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           13
True 1            0           22

Accuracy:0.628571
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.672 Vali Loss: 4.633
Epoch: 1, | Train Acc: 0.6159 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.633172).  Saving model ...
Epoch: 2, | Train Loss: 5.668 Vali Loss: 4.697
Epoch: 2, | Train Acc: 0.5942 Vali Acc: 0.4286
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.663 Vali Loss: 4.709
Epoch: 3, | Train Acc: 0.6304 Vali Acc: 0.4571
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.654 Vali Loss: 4.658
Epoch: 4, | Train Acc: 0.6449 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.651 Vali Loss: 4.670
Epoch: 5, | Train Acc: 0.6667 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           20            0
True 1           15            0

Accuracy:0.571429
acc_clas_0:1.000000
acc_clas_1:0.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.677 Vali Loss: 4.700
Epoch: 1, | Train Acc: 0.5797 Vali Acc: 0.4286
Validation loss decreased (inf --> 4.700120).  Saving model ...
Epoch: 2, | Train Loss: 5.668 Vali Loss: 4.671
Epoch: 2, | Train Acc: 0.6159 Vali Acc: 0.6000
Validation loss decreased (4.700120 --> 4.670964).  Saving model ...
Epoch: 3, | Train Loss: 5.667 Vali Loss: 4.661
Epoch: 3, | Train Acc: 0.6449 Vali Acc: 0.4857
Validation loss decreased (4.670964 --> 4.661165).  Saving model ...
Epoch: 4, | Train Loss: 5.657 Vali Loss: 4.651
Epoch: 4, | Train Acc: 0.6159 Vali Acc: 0.6000
Validation loss decreased (4.661165 --> 4.651269).  Saving model ...
Epoch: 5, | Train Loss: 5.650 Vali Loss: 4.656
Epoch: 5, | Train Acc: 0.7464 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.641 Vali Loss: 4.638
Epoch: 6, | Train Acc: 0.7609 Vali Acc: 0.7429
Validation loss decreased (4.651269 --> 4.638062).  Saving model ...
Epoch: 7, | Train Loss: 5.628 Vali Loss: 4.675
Epoch: 7, | Train Acc: 0.7174 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.624 Vali Loss: 4.626
Epoch: 8, | Train Acc: 0.7609 Vali Acc: 0.6286
Validation loss decreased (4.638062 --> 4.626211).  Saving model ...
Epoch: 9, | Train Loss: 5.605 Vali Loss: 4.626
Epoch: 9, | Train Acc: 0.8261 Vali Acc: 0.7714
Validation loss decreased (4.626211 --> 4.625864).  Saving model ...
Epoch: 10, | Train Loss: 5.601 Vali Loss: 4.620
Epoch: 10, | Train Acc: 0.8116 Vali Acc: 0.5429
Validation loss decreased (4.625864 --> 4.620041).  Saving model ...
Epoch: 11, | Train Loss: 5.586 Vali Loss: 4.695
Epoch: 11, | Train Acc: 0.8043 Vali Acc: 0.4286
EarlyStopping counter: 1 out of 4
Epoch: 12, | Train Loss: 5.567 Vali Loss: 4.610
Epoch: 12, | Train Acc: 0.8551 Vali Acc: 0.6571
Validation loss decreased (4.620041 --> 4.609579).  Saving model ...
Epoch: 13, | Train Loss: 5.554 Vali Loss: 4.690
Epoch: 13, | Train Acc: 0.8333 Vali Acc: 0.4286
EarlyStopping counter: 1 out of 4
Epoch: 14, | Train Loss: 5.534 Vali Loss: 4.626
Epoch: 14, | Train Acc: 0.8913 Vali Acc: 0.6857
EarlyStopping counter: 2 out of 4
Epoch: 15, | Train Loss: 5.520 Vali Loss: 4.678
Epoch: 15, | Train Acc: 0.8913 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 16, | Train Loss: 5.516 Vali Loss: 4.690
Epoch: 16, | Train Acc: 0.8841 Vali Acc: 0.4286
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3           12
True 1            0           20

Accuracy:0.657143
acc_clas_0:0.200000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.610 Vali Loss: 4.322
Epoch: 1, | Train Acc: 0.7842 Vali Acc: 0.7941
Validation loss decreased (inf --> 4.322005).  Saving model ...
Epoch: 2, | Train Loss: 5.597 Vali Loss: 4.306
Epoch: 2, | Train Acc: 0.8058 Vali Acc: 0.7353
Validation loss decreased (4.322005 --> 4.305638).  Saving model ...
Epoch: 3, | Train Loss: 5.572 Vali Loss: 4.299
Epoch: 3, | Train Acc: 0.8633 Vali Acc: 0.6765
Validation loss decreased (4.305638 --> 4.298651).  Saving model ...
Epoch: 4, | Train Loss: 5.568 Vali Loss: 4.407
Epoch: 4, | Train Acc: 0.8633 Vali Acc: 0.5000
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.559 Vali Loss: 4.335
Epoch: 5, | Train Acc: 0.8417 Vali Acc: 0.6471
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.528 Vali Loss: 4.208
Epoch: 6, | Train Acc: 0.8993 Vali Acc: 0.7941
Validation loss decreased (4.298651 --> 4.207731).  Saving model ...
Epoch: 7, | Train Loss: 5.521 Vali Loss: 4.332
Epoch: 7, | Train Acc: 0.9209 Vali Acc: 0.5000
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.501 Vali Loss: 4.243
Epoch: 8, | Train Acc: 0.8849 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.498 Vali Loss: 4.421
Epoch: 9, | Train Acc: 0.9281 Vali Acc: 0.4412
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.474 Vali Loss: 4.208
Epoch: 10, | Train Acc: 0.9424 Vali Acc: 0.9118
Validation loss decreased (4.207731 --> 4.207578).  Saving model ...
Epoch: 11, | Train Loss: 5.449 Vali Loss: 4.284
Epoch: 11, | Train Acc: 0.9568 Vali Acc: 0.7353
EarlyStopping counter: 1 out of 4
Epoch: 12, | Train Loss: 5.437 Vali Loss: 4.281
Epoch: 12, | Train Acc: 0.9712 Vali Acc: 0.7941
EarlyStopping counter: 2 out of 4
Epoch: 13, | Train Loss: 5.421 Vali Loss: 4.237
Epoch: 13, | Train Acc: 0.9784 Vali Acc: 0.8824
EarlyStopping counter: 3 out of 4
Epoch: 14, | Train Loss: 5.400 Vali Loss: 4.401
Epoch: 14, | Train Acc: 0.9712 Vali Acc: 0.5000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           13            2
True 1            1           18

Accuracy:0.911765
acc_clas_0:0.866667
acc_clas_1:0.947368
Fold 5/5
Epoch: 1, | Train Loss: 5.499 Vali Loss: 4.281
Epoch: 1, | Train Acc: 0.8777 Vali Acc: 0.6471
Validation loss decreased (inf --> 4.281415).  Saving model ...
Epoch: 2, | Train Loss: 5.483 Vali Loss: 4.389
Epoch: 2, | Train Acc: 0.9424 Vali Acc: 0.5000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.444 Vali Loss: 4.142
Epoch: 3, | Train Acc: 0.9353 Vali Acc: 1.0000
Validation loss decreased (4.281415 --> 4.141811).  Saving model ...
Epoch: 4, | Train Loss: 5.437 Vali Loss: 4.145
Epoch: 4, | Train Acc: 0.9712 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.426 Vali Loss: 4.168
Epoch: 5, | Train Acc: 0.9784 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.398 Vali Loss: 4.310
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 0.7353
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.395 Vali Loss: 4.167
Epoch: 7, | Train Acc: 0.9928 Vali Acc: 0.8235
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           12            0
True 1            0           22

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
total avg vali acc:0.753782  total avg vali acc_clas_0: 0.613333  total avg vali acc_clas_1: 0.789474
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=4.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_4.0_pretrain_False_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.692 Vali Loss: 4.671
Epoch: 1, | Train Acc: 0.5145 Vali Acc: 0.6000
Validation loss decreased (inf --> 4.671204).  Saving model ...
Epoch: 2, | Train Loss: 5.683 Vali Loss: 4.667
Epoch: 2, | Train Acc: 0.5725 Vali Acc: 0.6000
Validation loss decreased (4.671204 --> 4.666604).  Saving model ...
Epoch: 3, | Train Loss: 5.682 Vali Loss: 4.669
Epoch: 3, | Train Acc: 0.5580 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.679 Vali Loss: 4.657
Epoch: 4, | Train Acc: 0.5580 Vali Acc: 0.6000
Validation loss decreased (4.666604 --> 4.656593).  Saving model ...
Epoch: 5, | Train Loss: 5.677 Vali Loss: 4.671
Epoch: 5, | Train Acc: 0.5580 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.674 Vali Loss: 4.679
Epoch: 6, | Train Acc: 0.5580 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.669 Vali Loss: 4.687
Epoch: 7, | Train Acc: 0.5870 Vali Acc: 0.4286
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.670 Vali Loss: 4.672
Epoch: 8, | Train Acc: 0.7101 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           14
True 1            0           21

Accuracy:0.600000
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.683 Vali Loss: 4.678
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.678288).  Saving model ...
Epoch: 2, | Train Loss: 5.681 Vali Loss: 4.633
Epoch: 2, | Train Acc: 0.5652 Vali Acc: 0.5714
Validation loss decreased (4.678288 --> 4.633073).  Saving model ...
Epoch: 3, | Train Loss: 5.676 Vali Loss: 4.665
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.672 Vali Loss: 4.657
Epoch: 4, | Train Acc: 0.6159 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.669 Vali Loss: 4.655
Epoch: 5, | Train Acc: 0.7246 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.665 Vali Loss: 4.660
Epoch: 6, | Train Acc: 0.7029 Vali Acc: 0.5714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           15
True 1            0           20

Accuracy:0.571429
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.677 Vali Loss: 4.654
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.653553).  Saving model ...
Epoch: 2, | Train Loss: 5.673 Vali Loss: 4.661
Epoch: 2, | Train Acc: 0.5870 Vali Acc: 0.8000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.670 Vali Loss: 4.653
Epoch: 3, | Train Acc: 0.6522 Vali Acc: 0.6857
Validation loss decreased (4.653553 --> 4.653059).  Saving model ...
Epoch: 4, | Train Loss: 5.666 Vali Loss: 4.666
Epoch: 4, | Train Acc: 0.6739 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.662 Vali Loss: 4.667
Epoch: 5, | Train Acc: 0.7391 Vali Acc: 0.7429
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.654 Vali Loss: 4.643
Epoch: 6, | Train Acc: 0.7971 Vali Acc: 0.7143
Validation loss decreased (4.653059 --> 4.642622).  Saving model ...
Epoch: 7, | Train Loss: 5.651 Vali Loss: 4.657
Epoch: 7, | Train Acc: 0.7536 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.646 Vali Loss: 4.643
Epoch: 8, | Train Acc: 0.7246 Vali Acc: 0.6857
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.642 Vali Loss: 4.655
Epoch: 9, | Train Acc: 0.8696 Vali Acc: 0.7143
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.635 Vali Loss: 4.628
Epoch: 10, | Train Acc: 0.8623 Vali Acc: 0.6571
Validation loss decreased (4.642622 --> 4.628356).  Saving model ...
Epoch: 11, | Train Loss: 5.632 Vali Loss: 4.655
Epoch: 11, | Train Acc: 0.7681 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 12, | Train Loss: 5.625 Vali Loss: 4.630
Epoch: 12, | Train Acc: 0.8116 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 13, | Train Loss: 5.623 Vali Loss: 4.638
Epoch: 13, | Train Acc: 0.8986 Vali Acc: 0.6857
EarlyStopping counter: 3 out of 4
Epoch: 14, | Train Loss: 5.616 Vali Loss: 4.645
Epoch: 14, | Train Acc: 0.8551 Vali Acc: 0.7143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3           12
True 1            0           20

Accuracy:0.657143
acc_clas_0:0.200000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.669 Vali Loss: 4.343
Epoch: 1, | Train Acc: 0.8129 Vali Acc: 0.7647
Validation loss decreased (inf --> 4.342598).  Saving model ...
Epoch: 2, | Train Loss: 5.664 Vali Loss: 4.346
Epoch: 2, | Train Acc: 0.7410 Vali Acc: 0.7941
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.656 Vali Loss: 4.357
Epoch: 3, | Train Acc: 0.8345 Vali Acc: 0.7941
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.650 Vali Loss: 4.352
Epoch: 4, | Train Acc: 0.8777 Vali Acc: 0.8529
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.648 Vali Loss: 4.353
Epoch: 5, | Train Acc: 0.8705 Vali Acc: 0.8824
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            4            8
True 1            0           22

Accuracy:0.764706
acc_clas_0:0.333333
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.667 Vali Loss: 4.371
Epoch: 1, | Train Acc: 0.6835 Vali Acc: 0.7353
Validation loss decreased (inf --> 4.371231).  Saving model ...
Epoch: 2, | Train Loss: 5.657 Vali Loss: 4.331
Epoch: 2, | Train Acc: 0.7770 Vali Acc: 0.7941
Validation loss decreased (4.371231 --> 4.330700).  Saving model ...
Epoch: 3, | Train Loss: 5.653 Vali Loss: 4.364
Epoch: 3, | Train Acc: 0.8058 Vali Acc: 0.7059
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.649 Vali Loss: 4.335
Epoch: 4, | Train Acc: 0.7482 Vali Acc: 0.7647
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.645 Vali Loss: 4.340
Epoch: 5, | Train Acc: 0.7554 Vali Acc: 0.8235
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.641 Vali Loss: 4.352
Epoch: 6, | Train Acc: 0.8273 Vali Acc: 0.8235
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           12            7
True 1            0           15

Accuracy:0.794118
acc_clas_0:0.631579
acc_clas_1:1.000000
total avg vali acc:0.677479  total avg vali acc_clas_0: 0.232982  total avg vali acc_clas_1: 1.000000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=4.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_4.0_pretrain_True_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.690 Vali Loss: 4.610
Epoch: 1, | Train Acc: 0.4348 Vali Acc: 0.6857
Validation loss decreased (inf --> 4.609634).  Saving model ...
Epoch: 2, | Train Loss: 5.717 Vali Loss: 4.645
Epoch: 2, | Train Acc: 0.5362 Vali Acc: 0.6857
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.705 Vali Loss: 4.672
Epoch: 3, | Train Acc: 0.5362 Vali Acc: 0.6857
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.698 Vali Loss: 4.645
Epoch: 4, | Train Acc: 0.5362 Vali Acc: 0.6857
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.687 Vali Loss: 4.658
Epoch: 5, | Train Acc: 0.5362 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           11
True 1            0           24

Accuracy:0.685714
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.710 Vali Loss: 4.616
Epoch: 1, | Train Acc: 0.4855 Vali Acc: 0.6571
Validation loss decreased (inf --> 4.616467).  Saving model ...
Epoch: 2, | Train Loss: 5.704 Vali Loss: 4.659
Epoch: 2, | Train Acc: 0.5435 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.707 Vali Loss: 4.620
Epoch: 3, | Train Acc: 0.4638 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.704 Vali Loss: 4.618
Epoch: 4, | Train Acc: 0.5435 Vali Acc: 0.6571
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.698 Vali Loss: 4.679
Epoch: 5, | Train Acc: 0.5435 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           12
True 1            0           23

Accuracy:0.657143
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.687 Vali Loss: 4.729
Epoch: 1, | Train Acc: 0.5942 Vali Acc: 0.4286
Validation loss decreased (inf --> 4.729483).  Saving model ...
Epoch: 2, | Train Loss: 5.679 Vali Loss: 4.724
Epoch: 2, | Train Acc: 0.6014 Vali Acc: 0.4286
Validation loss decreased (4.729483 --> 4.723897).  Saving model ...
Epoch: 3, | Train Loss: 5.675 Vali Loss: 4.726
Epoch: 3, | Train Acc: 0.6014 Vali Acc: 0.4571
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.677 Vali Loss: 4.747
Epoch: 4, | Train Acc: 0.6232 Vali Acc: 0.4571
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.669 Vali Loss: 4.678
Epoch: 5, | Train Acc: 0.6014 Vali Acc: 0.5143
Validation loss decreased (4.723897 --> 4.678256).  Saving model ...
Epoch: 6, | Train Loss: 5.665 Vali Loss: 4.685
Epoch: 6, | Train Acc: 0.6232 Vali Acc: 0.4571
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.656 Vali Loss: 4.681
Epoch: 7, | Train Acc: 0.6377 Vali Acc: 0.4571
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.653 Vali Loss: 4.684
Epoch: 8, | Train Acc: 0.6377 Vali Acc: 0.4857
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.656 Vali Loss: 4.665
Epoch: 9, | Train Acc: 0.6667 Vali Acc: 0.4571
Validation loss decreased (4.678256 --> 4.665252).  Saving model ...
Epoch: 10, | Train Loss: 5.643 Vali Loss: 4.648
Epoch: 10, | Train Acc: 0.6667 Vali Acc: 0.5143
Validation loss decreased (4.665252 --> 4.647809).  Saving model ...
Epoch: 11, | Train Loss: 5.637 Vali Loss: 4.679
Epoch: 11, | Train Acc: 0.6522 Vali Acc: 0.4571
EarlyStopping counter: 1 out of 4
Epoch: 12, | Train Loss: 5.635 Vali Loss: 4.688
Epoch: 12, | Train Acc: 0.7536 Vali Acc: 0.4571
EarlyStopping counter: 2 out of 4
Epoch: 13, | Train Loss: 5.653 Vali Loss: 4.748
Epoch: 13, | Train Acc: 0.6377 Vali Acc: 0.4571
EarlyStopping counter: 3 out of 4
Epoch: 14, | Train Loss: 5.630 Vali Loss: 4.704
Epoch: 14, | Train Acc: 0.6377 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3           17
True 1            0           15

Accuracy:0.514286
acc_clas_0:0.150000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.681 Vali Loss: 4.335
Epoch: 1, | Train Acc: 0.6043 Vali Acc: 0.6176
Validation loss decreased (inf --> 4.334652).  Saving model ...
Epoch: 2, | Train Loss: 5.689 Vali Loss: 4.376
Epoch: 2, | Train Acc: 0.5971 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.674 Vali Loss: 4.373
Epoch: 3, | Train Acc: 0.6187 Vali Acc: 0.6471
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.673 Vali Loss: 4.365
Epoch: 4, | Train Acc: 0.7194 Vali Acc: 0.6765
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.671 Vali Loss: 4.387
Epoch: 5, | Train Acc: 0.6043 Vali Acc: 0.5882
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3           13
True 1            0           18

Accuracy:0.617647
acc_clas_0:0.187500
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.677 Vali Loss: 4.386
Epoch: 1, | Train Acc: 0.6187 Vali Acc: 0.7647
Validation loss decreased (inf --> 4.385559).  Saving model ...
Epoch: 2, | Train Loss: 5.665 Vali Loss: 4.346
Epoch: 2, | Train Acc: 0.6691 Vali Acc: 0.5294
Validation loss decreased (4.385559 --> 4.345597).  Saving model ...
Epoch: 3, | Train Loss: 5.658 Vali Loss: 4.351
Epoch: 3, | Train Acc: 0.6547 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.651 Vali Loss: 4.367
Epoch: 4, | Train Acc: 0.6547 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.650 Vali Loss: 4.342
Epoch: 5, | Train Acc: 0.7050 Vali Acc: 0.6765
Validation loss decreased (4.345597 --> 4.342266).  Saving model ...
Epoch: 6, | Train Loss: 5.643 Vali Loss: 4.369
Epoch: 6, | Train Acc: 0.6906 Vali Acc: 0.8235
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.644 Vali Loss: 4.364
Epoch: 7, | Train Acc: 0.7698 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.635 Vali Loss: 4.372
Epoch: 8, | Train Acc: 0.7410 Vali Acc: 0.7353
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.629 Vali Loss: 4.341
Epoch: 9, | Train Acc: 0.7482 Vali Acc: 0.7941
Validation loss decreased (4.342266 --> 4.341423).  Saving model ...
Epoch: 10, | Train Loss: 5.625 Vali Loss: 4.335
Epoch: 10, | Train Acc: 0.8489 Vali Acc: 0.6471
Validation loss decreased (4.341423 --> 4.334934).  Saving model ...
Epoch: 11, | Train Loss: 5.626 Vali Loss: 4.335
Epoch: 11, | Train Acc: 0.7122 Vali Acc: 0.7941
Validation loss decreased (4.334934 --> 4.334681).  Saving model ...
Epoch: 12, | Train Loss: 5.620 Vali Loss: 4.361
Epoch: 12, | Train Acc: 0.7122 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 13, | Train Loss: 5.617 Vali Loss: 4.370
Epoch: 13, | Train Acc: 0.8921 Vali Acc: 0.7353
EarlyStopping counter: 2 out of 4
Epoch: 14, | Train Loss: 5.625 Vali Loss: 4.364
Epoch: 14, | Train Acc: 0.6835 Vali Acc: 0.6765
EarlyStopping counter: 3 out of 4
Epoch: 15, | Train Loss: 5.610 Vali Loss: 4.404
Epoch: 15, | Train Acc: 0.8417 Vali Acc: 0.7353
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            9            7
True 1            0           18

Accuracy:0.794118
acc_clas_0:0.562500
acc_clas_1:1.000000
total avg vali acc:0.653782  total avg vali acc_clas_0: 0.180000  total avg vali acc_clas_1: 1.000000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=4.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_4.0_pretrain_True_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.688 Vali Loss: 4.691
Epoch: 1, | Train Acc: 0.5797 Vali Acc: 0.6000
Validation loss decreased (inf --> 4.690992).  Saving model ...
Epoch: 2, | Train Loss: 5.684 Vali Loss: 4.668
Epoch: 2, | Train Acc: 0.5580 Vali Acc: 0.6286
Validation loss decreased (4.690992 --> 4.667656).  Saving model ...
Epoch: 3, | Train Loss: 5.679 Vali Loss: 4.687
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.678 Vali Loss: 4.671
Epoch: 4, | Train Acc: 0.5797 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.675 Vali Loss: 4.672
Epoch: 5, | Train Acc: 0.5725 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.672 Vali Loss: 4.693
Epoch: 6, | Train Acc: 0.6087 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           13
True 1            0           21

Accuracy:0.628571
acc_clas_0:0.071429
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.689 Vali Loss: 4.669
Epoch: 1, | Train Acc: 0.5725 Vali Acc: 0.6857
Validation loss decreased (inf --> 4.668876).  Saving model ...
Epoch: 2, | Train Loss: 5.681 Vali Loss: 4.652
Epoch: 2, | Train Acc: 0.5362 Vali Acc: 0.6857
Validation loss decreased (4.668876 --> 4.651687).  Saving model ...
Epoch: 3, | Train Loss: 5.681 Vali Loss: 4.644
Epoch: 3, | Train Acc: 0.5362 Vali Acc: 0.6857
Validation loss decreased (4.651687 --> 4.643745).  Saving model ...
Epoch: 4, | Train Loss: 5.673 Vali Loss: 4.666
Epoch: 4, | Train Acc: 0.5942 Vali Acc: 0.6857
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.671 Vali Loss: 4.661
Epoch: 5, | Train Acc: 0.7536 Vali Acc: 0.7714
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.665 Vali Loss: 4.658
Epoch: 6, | Train Acc: 0.7319 Vali Acc: 0.7143
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.659 Vali Loss: 4.650
Epoch: 7, | Train Acc: 0.6667 Vali Acc: 0.7143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           11
True 1            0           24

Accuracy:0.685714
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.677 Vali Loss: 4.656
Epoch: 1, | Train Acc: 0.5797 Vali Acc: 0.7143
Validation loss decreased (inf --> 4.656023).  Saving model ...
Epoch: 2, | Train Loss: 5.672 Vali Loss: 4.644
Epoch: 2, | Train Acc: 0.5870 Vali Acc: 0.6857
Validation loss decreased (4.656023 --> 4.643799).  Saving model ...
Epoch: 3, | Train Loss: 5.668 Vali Loss: 4.665
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.7143
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.662 Vali Loss: 4.643
Epoch: 4, | Train Acc: 0.7536 Vali Acc: 0.7429
Validation loss decreased (4.643799 --> 4.643484).  Saving model ...
Epoch: 5, | Train Loss: 5.660 Vali Loss: 4.625
Epoch: 5, | Train Acc: 0.6232 Vali Acc: 0.7143
Validation loss decreased (4.643484 --> 4.625114).  Saving model ...
Epoch: 6, | Train Loss: 5.655 Vali Loss: 4.643
Epoch: 6, | Train Acc: 0.7899 Vali Acc: 0.8000
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.647 Vali Loss: 4.649
Epoch: 7, | Train Acc: 0.7464 Vali Acc: 0.7429
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.643 Vali Loss: 4.635
Epoch: 8, | Train Acc: 0.6812 Vali Acc: 0.7429
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.637 Vali Loss: 4.640
Epoch: 9, | Train Acc: 0.8188 Vali Acc: 0.8000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3           10
True 1            0           22

Accuracy:0.714286
acc_clas_0:0.230769
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.677 Vali Loss: 4.361
Epoch: 1, | Train Acc: 0.6187 Vali Acc: 0.5294
Validation loss decreased (inf --> 4.360647).  Saving model ...
Epoch: 2, | Train Loss: 5.676 Vali Loss: 4.368
Epoch: 2, | Train Acc: 0.7770 Vali Acc: 0.7059
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.663 Vali Loss: 4.398
Epoch: 3, | Train Acc: 0.6619 Vali Acc: 0.5000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.662 Vali Loss: 4.369
Epoch: 4, | Train Acc: 0.6475 Vali Acc: 0.6471
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.655 Vali Loss: 4.363
Epoch: 5, | Train Acc: 0.7410 Vali Acc: 0.7059
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           16
True 1            0           16

Accuracy:0.529412
acc_clas_0:0.111111
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.670 Vali Loss: 4.412
Epoch: 1, | Train Acc: 0.6331 Vali Acc: 0.4412
Validation loss decreased (inf --> 4.412473).  Saving model ...
Epoch: 2, | Train Loss: 5.663 Vali Loss: 4.411
Epoch: 2, | Train Acc: 0.6763 Vali Acc: 0.4706
Validation loss decreased (4.412473 --> 4.410800).  Saving model ...
Epoch: 3, | Train Loss: 5.657 Vali Loss: 4.366
Epoch: 3, | Train Acc: 0.6906 Vali Acc: 0.4706
Validation loss decreased (4.410800 --> 4.365940).  Saving model ...
Epoch: 4, | Train Loss: 5.654 Vali Loss: 4.409
Epoch: 4, | Train Acc: 0.7122 Vali Acc: 0.5000
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.647 Vali Loss: 4.382
Epoch: 5, | Train Acc: 0.7194 Vali Acc: 0.4706
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.644 Vali Loss: 4.352
Epoch: 6, | Train Acc: 0.7122 Vali Acc: 0.5294
Validation loss decreased (4.365940 --> 4.352043).  Saving model ...
Epoch: 7, | Train Loss: 5.642 Vali Loss: 4.387
Epoch: 7, | Train Acc: 0.8129 Vali Acc: 0.5294
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.636 Vali Loss: 4.378
Epoch: 8, | Train Acc: 0.7482 Vali Acc: 0.4706
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.638 Vali Loss: 4.370
Epoch: 9, | Train Acc: 0.8345 Vali Acc: 0.6765
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.627 Vali Loss: 4.388
Epoch: 10, | Train Acc: 0.7698 Vali Acc: 0.5000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3           16
True 1            0           15

Accuracy:0.529412
acc_clas_0:0.157895
acc_clas_1:1.000000
total avg vali acc:0.617479  total avg vali acc_clas_0: 0.114241  total avg vali acc_clas_1: 1.000000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=4.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_4.0_pretrain_False_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.698 Vali Loss: 4.661
Epoch: 1, | Train Acc: 0.5290 Vali Acc: 0.7429
Validation loss decreased (inf --> 4.660825).  Saving model ...
Epoch: 2, | Train Loss: 5.715 Vali Loss: 4.692
Epoch: 2, | Train Acc: 0.4928 Vali Acc: 0.2571
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.689 Vali Loss: 4.650
Epoch: 3, | Train Acc: 0.5000 Vali Acc: 0.7429
Validation loss decreased (4.660825 --> 4.649816).  Saving model ...
Epoch: 4, | Train Loss: 5.687 Vali Loss: 4.668
Epoch: 4, | Train Acc: 0.5290 Vali Acc: 0.7429
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.694 Vali Loss: 4.654
Epoch: 5, | Train Acc: 0.5000 Vali Acc: 0.7429
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.685 Vali Loss: 4.634
Epoch: 6, | Train Acc: 0.5507 Vali Acc: 0.7429
Validation loss decreased (4.649816 --> 4.633504).  Saving model ...
Epoch: 7, | Train Loss: 5.680 Vali Loss: 4.668
Epoch: 7, | Train Acc: 0.5507 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.682 Vali Loss: 4.669
Epoch: 8, | Train Acc: 0.5435 Vali Acc: 0.6857
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.674 Vali Loss: 4.659
Epoch: 9, | Train Acc: 0.5797 Vali Acc: 0.7429
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.672 Vali Loss: 4.685
Epoch: 10, | Train Acc: 0.6014 Vali Acc: 0.3714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0            9
True 1            0           26

Accuracy:0.742857
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.686 Vali Loss: 4.672
Epoch: 1, | Train Acc: 0.5870 Vali Acc: 0.6000
Validation loss decreased (inf --> 4.672402).  Saving model ...
Epoch: 2, | Train Loss: 5.674 Vali Loss: 4.691
Epoch: 2, | Train Acc: 0.6087 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.673 Vali Loss: 4.686
Epoch: 3, | Train Acc: 0.6087 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.669 Vali Loss: 4.662
Epoch: 4, | Train Acc: 0.6014 Vali Acc: 0.5143
Validation loss decreased (4.672402 --> 4.662452).  Saving model ...
Epoch: 5, | Train Loss: 5.659 Vali Loss: 4.676
Epoch: 5, | Train Acc: 0.6159 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.670 Vali Loss: 4.696
Epoch: 6, | Train Acc: 0.6087 Vali Acc: 0.4857
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.655 Vali Loss: 4.660
Epoch: 7, | Train Acc: 0.6449 Vali Acc: 0.6857
Validation loss decreased (4.662452 --> 4.660436).  Saving model ...
Epoch: 8, | Train Loss: 5.646 Vali Loss: 4.684
Epoch: 8, | Train Acc: 0.7029 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.654 Vali Loss: 4.677
Epoch: 9, | Train Acc: 0.6159 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.648 Vali Loss: 4.659
Epoch: 10, | Train Acc: 0.7391 Vali Acc: 0.6571
Validation loss decreased (4.660436 --> 4.658947).  Saving model ...
Epoch: 11, | Train Loss: 5.637 Vali Loss: 4.675
Epoch: 11, | Train Acc: 0.7319 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 12, | Train Loss: 5.635 Vali Loss: 4.661
Epoch: 12, | Train Acc: 0.6159 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 13, | Train Loss: 5.633 Vali Loss: 4.643
Epoch: 13, | Train Acc: 0.8261 Vali Acc: 0.6857
Validation loss decreased (4.658947 --> 4.642832).  Saving model ...
Epoch: 14, | Train Loss: 5.624 Vali Loss: 4.661
Epoch: 14, | Train Acc: 0.7101 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 15, | Train Loss: 5.621 Vali Loss: 4.655
Epoch: 15, | Train Acc: 0.7101 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 16, | Train Loss: 5.615 Vali Loss: 4.643
Epoch: 16, | Train Acc: 0.7246 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 17, | Train Loss: 5.609 Vali Loss: 4.654
Epoch: 17, | Train Acc: 0.7319 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            7           10
True 1            1           17

Accuracy:0.685714
acc_clas_0:0.411765
acc_clas_1:0.944444
Fold 3/5
Epoch: 1, | Train Loss: 5.652 Vali Loss: 4.627
Epoch: 1, | Train Acc: 0.6522 Vali Acc: 0.7429
Validation loss decreased (inf --> 4.627373).  Saving model ...
Epoch: 2, | Train Loss: 5.639 Vali Loss: 4.614
Epoch: 2, | Train Acc: 0.7826 Vali Acc: 0.7143
Validation loss decreased (4.627373 --> 4.613982).  Saving model ...
Epoch: 3, | Train Loss: 5.638 Vali Loss: 4.628
Epoch: 3, | Train Acc: 0.6159 Vali Acc: 0.8000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.626 Vali Loss: 4.588
Epoch: 4, | Train Acc: 0.8043 Vali Acc: 0.8571
Validation loss decreased (4.613982 --> 4.587826).  Saving model ...
Epoch: 5, | Train Loss: 5.623 Vali Loss: 4.589
Epoch: 5, | Train Acc: 0.8261 Vali Acc: 0.8286
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.621 Vali Loss: 4.600
Epoch: 6, | Train Acc: 0.7174 Vali Acc: 0.8857
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.626 Vali Loss: 4.596
Epoch: 7, | Train Acc: 0.8478 Vali Acc: 0.8000
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.632 Vali Loss: 4.613
Epoch: 8, | Train Acc: 0.6304 Vali Acc: 0.7143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           11            3
True 1            2           19

Accuracy:0.857143
acc_clas_0:0.785714
acc_clas_1:0.904762
Fold 4/5
Epoch: 1, | Train Loss: 5.653 Vali Loss: 4.356
Epoch: 1, | Train Acc: 0.6619 Vali Acc: 0.6176
Validation loss decreased (inf --> 4.356461).  Saving model ...
Epoch: 2, | Train Loss: 5.644 Vali Loss: 4.400
Epoch: 2, | Train Acc: 0.7842 Vali Acc: 0.5882
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.644 Vali Loss: 4.389
Epoch: 3, | Train Acc: 0.6691 Vali Acc: 0.5882
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.639 Vali Loss: 4.347
Epoch: 4, | Train Acc: 0.8345 Vali Acc: 0.7647
Validation loss decreased (4.356461 --> 4.346684).  Saving model ...
Epoch: 5, | Train Loss: 5.628 Vali Loss: 4.354
Epoch: 5, | Train Acc: 0.7482 Vali Acc: 0.5882
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.626 Vali Loss: 4.354
Epoch: 6, | Train Acc: 0.7626 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.621 Vali Loss: 4.343
Epoch: 7, | Train Acc: 0.8489 Vali Acc: 0.5882
Validation loss decreased (4.346684 --> 4.343212).  Saving model ...
Epoch: 8, | Train Loss: 5.619 Vali Loss: 4.358
Epoch: 8, | Train Acc: 0.7266 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.618 Vali Loss: 4.381
Epoch: 9, | Train Acc: 0.8849 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.616 Vali Loss: 4.344
Epoch: 10, | Train Acc: 0.7554 Vali Acc: 0.6471
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.611 Vali Loss: 4.338
Epoch: 11, | Train Acc: 0.8849 Vali Acc: 0.7647
Validation loss decreased (4.343212 --> 4.337867).  Saving model ...
Epoch: 12, | Train Loss: 5.613 Vali Loss: 4.319
Epoch: 12, | Train Acc: 0.8273 Vali Acc: 0.6471
Validation loss decreased (4.337867 --> 4.318702).  Saving model ...
Epoch: 13, | Train Loss: 5.607 Vali Loss: 4.324
Epoch: 13, | Train Acc: 0.8993 Vali Acc: 0.7647
EarlyStopping counter: 1 out of 4
Epoch: 14, | Train Loss: 5.603 Vali Loss: 4.321
Epoch: 14, | Train Acc: 0.9353 Vali Acc: 0.7647
EarlyStopping counter: 2 out of 4
Epoch: 15, | Train Loss: 5.610 Vali Loss: 4.378
Epoch: 15, | Train Acc: 0.7698 Vali Acc: 0.5882
EarlyStopping counter: 3 out of 4
Epoch: 16, | Train Loss: 5.614 Vali Loss: 4.325
Epoch: 16, | Train Acc: 0.8849 Vali Acc: 0.7353
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            8           12
True 1            0           14

Accuracy:0.647059
acc_clas_0:0.400000
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.619 Vali Loss: 4.297
Epoch: 1, | Train Acc: 0.7482 Vali Acc: 0.9412
Validation loss decreased (inf --> 4.296536).  Saving model ...
Epoch: 2, | Train Loss: 5.625 Vali Loss: 4.286
Epoch: 2, | Train Acc: 0.8705 Vali Acc: 0.8824
Validation loss decreased (4.296536 --> 4.285735).  Saving model ...
Epoch: 3, | Train Loss: 5.634 Vali Loss: 4.296
Epoch: 3, | Train Acc: 0.7122 Vali Acc: 0.7647
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.621 Vali Loss: 4.319
Epoch: 4, | Train Acc: 0.8921 Vali Acc: 0.9412
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.620 Vali Loss: 4.317
Epoch: 5, | Train Acc: 0.9424 Vali Acc: 0.8235
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.620 Vali Loss: 4.314
Epoch: 6, | Train Acc: 0.8489 Vali Acc: 0.9412
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           11            4
True 1            0           19

Accuracy:0.882353
acc_clas_0:0.733333
acc_clas_1:1.000000
total avg vali acc:0.763025  total avg vali acc_clas_0: 0.466162  total avg vali acc_clas_1: 0.969841
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=4.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_4.0_pretrain_False_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.694 Vali Loss: 4.680
Epoch: 1, | Train Acc: 0.4710 Vali Acc: 0.6571
Validation loss decreased (inf --> 4.679931).  Saving model ...
Epoch: 2, | Train Loss: 5.689 Vali Loss: 4.666
Epoch: 2, | Train Acc: 0.5435 Vali Acc: 0.6571
Validation loss decreased (4.679931 --> 4.665962).  Saving model ...
Epoch: 3, | Train Loss: 5.687 Vali Loss: 4.673
Epoch: 3, | Train Acc: 0.5435 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.684 Vali Loss: 4.675
Epoch: 4, | Train Acc: 0.5435 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.682 Vali Loss: 4.673
Epoch: 5, | Train Acc: 0.5725 Vali Acc: 0.6571
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.678 Vali Loss: 4.665
Epoch: 6, | Train Acc: 0.5725 Vali Acc: 0.6571
Validation loss decreased (4.665962 --> 4.664575).  Saving model ...
Epoch: 7, | Train Loss: 5.675 Vali Loss: 4.672
Epoch: 7, | Train Acc: 0.6377 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.671 Vali Loss: 4.660
Epoch: 8, | Train Acc: 0.6667 Vali Acc: 0.5714
Validation loss decreased (4.664575 --> 4.660225).  Saving model ...
Epoch: 9, | Train Loss: 5.668 Vali Loss: 4.688
Epoch: 9, | Train Acc: 0.7101 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.661 Vali Loss: 4.664
Epoch: 10, | Train Acc: 0.7174 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.656 Vali Loss: 4.673
Epoch: 11, | Train Acc: 0.6522 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.654 Vali Loss: 4.688
Epoch: 12, | Train Acc: 0.7899 Vali Acc: 0.4857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            1           11
True 1            4           19

Accuracy:0.571429
acc_clas_0:0.083333
acc_clas_1:0.826087
Fold 2/5
Epoch: 1, | Train Loss: 5.679 Vali Loss: 4.649
Epoch: 1, | Train Acc: 0.5362 Vali Acc: 0.7429
Validation loss decreased (inf --> 4.648734).  Saving model ...
Epoch: 2, | Train Loss: 5.678 Vali Loss: 4.673
Epoch: 2, | Train Acc: 0.6594 Vali Acc: 0.7143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.669 Vali Loss: 4.639
Epoch: 3, | Train Acc: 0.7319 Vali Acc: 0.7714
Validation loss decreased (4.648734 --> 4.638956).  Saving model ...
Epoch: 4, | Train Loss: 5.668 Vali Loss: 4.621
Epoch: 4, | Train Acc: 0.6232 Vali Acc: 0.7143
Validation loss decreased (4.638956 --> 4.620959).  Saving model ...
Epoch: 5, | Train Loss: 5.663 Vali Loss: 4.643
Epoch: 5, | Train Acc: 0.6449 Vali Acc: 0.7714
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.660 Vali Loss: 4.650
Epoch: 6, | Train Acc: 0.8116 Vali Acc: 0.7714
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.655 Vali Loss: 4.624
Epoch: 7, | Train Acc: 0.7971 Vali Acc: 0.7714
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.654 Vali Loss: 4.611
Epoch: 8, | Train Acc: 0.7101 Vali Acc: 0.7714
Validation loss decreased (4.620959 --> 4.610781).  Saving model ...
Epoch: 9, | Train Loss: 5.647 Vali Loss: 4.644
Epoch: 9, | Train Acc: 0.7826 Vali Acc: 0.7429
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.645 Vali Loss: 4.629
Epoch: 10, | Train Acc: 0.8043 Vali Acc: 0.7714
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.642 Vali Loss: 4.623
Epoch: 11, | Train Acc: 0.8333 Vali Acc: 0.7714
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.636 Vali Loss: 4.623
Epoch: 12, | Train Acc: 0.7971 Vali Acc: 0.7714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3            8
True 1            0           24

Accuracy:0.771429
acc_clas_0:0.272727
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.646 Vali Loss: 4.649
Epoch: 1, | Train Acc: 0.7826 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.649214).  Saving model ...
Epoch: 2, | Train Loss: 5.641 Vali Loss: 4.682
Epoch: 2, | Train Acc: 0.6522 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.637 Vali Loss: 4.649
Epoch: 3, | Train Acc: 0.7029 Vali Acc: 0.6286
Validation loss decreased (4.649214 --> 4.649181).  Saving model ...
Epoch: 4, | Train Loss: 5.634 Vali Loss: 4.636
Epoch: 4, | Train Acc: 0.7971 Vali Acc: 0.7143
Validation loss decreased (4.649181 --> 4.636179).  Saving model ...
Epoch: 5, | Train Loss: 5.629 Vali Loss: 4.674
Epoch: 5, | Train Acc: 0.7609 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.627 Vali Loss: 4.656
Epoch: 6, | Train Acc: 0.7246 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.625 Vali Loss: 4.615
Epoch: 7, | Train Acc: 0.8478 Vali Acc: 0.7714
Validation loss decreased (4.636179 --> 4.615088).  Saving model ...
Epoch: 8, | Train Loss: 5.620 Vali Loss: 4.634
Epoch: 8, | Train Acc: 0.8261 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.617 Vali Loss: 4.665
Epoch: 9, | Train Acc: 0.7681 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.612 Vali Loss: 4.645
Epoch: 10, | Train Acc: 0.8478 Vali Acc: 0.6000
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.610 Vali Loss: 4.628
Epoch: 11, | Train Acc: 0.8333 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           11            8
True 1            0           16

Accuracy:0.771429
acc_clas_0:0.578947
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.652 Vali Loss: 4.327
Epoch: 1, | Train Acc: 0.8417 Vali Acc: 0.8824
Validation loss decreased (inf --> 4.327360).  Saving model ...
Epoch: 2, | Train Loss: 5.649 Vali Loss: 4.316
Epoch: 2, | Train Acc: 0.7194 Vali Acc: 0.8824
Validation loss decreased (4.327360 --> 4.316280).  Saving model ...
Epoch: 3, | Train Loss: 5.646 Vali Loss: 4.330
Epoch: 3, | Train Acc: 0.7842 Vali Acc: 0.9118
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.642 Vali Loss: 4.315
Epoch: 4, | Train Acc: 0.8273 Vali Acc: 0.9706
Validation loss decreased (4.316280 --> 4.314791).  Saving model ...
Epoch: 5, | Train Loss: 5.640 Vali Loss: 4.317
Epoch: 5, | Train Acc: 0.8273 Vali Acc: 0.8824
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.636 Vali Loss: 4.329
Epoch: 6, | Train Acc: 0.8273 Vali Acc: 0.9706
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.635 Vali Loss: 4.333
Epoch: 7, | Train Acc: 0.8561 Vali Acc: 0.9412
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.632 Vali Loss: 4.327
Epoch: 8, | Train Acc: 0.8633 Vali Acc: 0.9412
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           17            1
True 1            0           16

Accuracy:0.970588
acc_clas_0:0.944444
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.641 Vali Loss: 4.328
Epoch: 1, | Train Acc: 0.8705 Vali Acc: 0.8235
Validation loss decreased (inf --> 4.327960).  Saving model ...
Epoch: 2, | Train Loss: 5.635 Vali Loss: 4.322
Epoch: 2, | Train Acc: 0.8489 Vali Acc: 0.9118
Validation loss decreased (4.327960 --> 4.322163).  Saving model ...
Epoch: 3, | Train Loss: 5.631 Vali Loss: 4.312
Epoch: 3, | Train Acc: 0.8993 Vali Acc: 0.8824
Validation loss decreased (4.322163 --> 4.312228).  Saving model ...
Epoch: 4, | Train Loss: 5.629 Vali Loss: 4.327
Epoch: 4, | Train Acc: 0.9209 Vali Acc: 0.9118
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.623 Vali Loss: 4.327
Epoch: 5, | Train Acc: 0.9281 Vali Acc: 0.8235
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.622 Vali Loss: 4.312
Epoch: 6, | Train Acc: 0.9137 Vali Acc: 0.9118
Validation loss decreased (4.312228 --> 4.311520).  Saving model ...
Epoch: 7, | Train Loss: 5.621 Vali Loss: 4.310
Epoch: 7, | Train Acc: 0.9065 Vali Acc: 0.7941
Validation loss decreased (4.311520 --> 4.310441).  Saving model ...
Epoch: 8, | Train Loss: 5.616 Vali Loss: 4.322
Epoch: 8, | Train Acc: 0.9496 Vali Acc: 0.8824
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.614 Vali Loss: 4.309
Epoch: 9, | Train Acc: 0.9568 Vali Acc: 0.7941
Validation loss decreased (4.310441 --> 4.308741).  Saving model ...
Epoch: 10, | Train Loss: 5.611 Vali Loss: 4.329
Epoch: 10, | Train Acc: 0.9137 Vali Acc: 0.8824
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.611 Vali Loss: 4.335
Epoch: 11, | Train Acc: 0.9568 Vali Acc: 0.8824
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 5.606 Vali Loss: 4.324
Epoch: 12, | Train Acc: 0.9281 Vali Acc: 0.7941
EarlyStopping counter: 3 out of 4
Epoch: 13, | Train Loss: 5.607 Vali Loss: 4.317
Epoch: 13, | Train Acc: 0.9496 Vali Acc: 0.9118
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            8            7
True 1            0           19

Accuracy:0.794118
acc_clas_0:0.533333
acc_clas_1:1.000000
total avg vali acc:0.775798  total avg vali acc_clas_0: 0.482557  total avg vali acc_clas_1: 0.965217
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=8.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_8.0_pretrain_True_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.710 Vali Loss: 4.672
Epoch: 1, | Train Acc: 0.4275 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.671872).  Saving model ...
Epoch: 2, | Train Loss: 5.673 Vali Loss: 4.712
Epoch: 2, | Train Acc: 0.6232 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.636 Vali Loss: 4.680
Epoch: 3, | Train Acc: 0.7464 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.615 Vali Loss: 4.684
Epoch: 4, | Train Acc: 0.7826 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.589 Vali Loss: 4.687
Epoch: 5, | Train Acc: 0.9058 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           14            3
True 1           12            6

Accuracy:0.571429
acc_clas_0:0.823529
acc_clas_1:0.333333
Fold 2/5
Epoch: 1, | Train Loss: 5.677 Vali Loss: 4.673
Epoch: 1, | Train Acc: 0.6449 Vali Acc: 0.7143
Validation loss decreased (inf --> 4.672714).  Saving model ...
Epoch: 2, | Train Loss: 5.652 Vali Loss: 4.659
Epoch: 2, | Train Acc: 0.7971 Vali Acc: 0.6000
Validation loss decreased (4.672714 --> 4.659096).  Saving model ...
Epoch: 3, | Train Loss: 5.629 Vali Loss: 4.674
Epoch: 3, | Train Acc: 0.8188 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.594 Vali Loss: 4.650
Epoch: 4, | Train Acc: 0.9855 Vali Acc: 0.6571
Validation loss decreased (4.659096 --> 4.650173).  Saving model ...
Epoch: 5, | Train Loss: 5.574 Vali Loss: 4.677
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.551 Vali Loss: 4.656
Epoch: 6, | Train Acc: 0.9855 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.536 Vali Loss: 4.671
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.518 Vali Loss: 4.646
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 0.6286
Validation loss decreased (4.650173 --> 4.646056).  Saving model ...
Epoch: 9, | Train Loss: 5.501 Vali Loss: 4.627
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 0.6857
Validation loss decreased (4.646056 --> 4.627188).  Saving model ...
Epoch: 10, | Train Loss: 5.494 Vali Loss: 4.634
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.483 Vali Loss: 4.661
Epoch: 11, | Train Acc: 1.0000 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 5.476 Vali Loss: 4.645
Epoch: 12, | Train Acc: 1.0000 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 13, | Train Loss: 5.465 Vali Loss: 4.659
Epoch: 13, | Train Acc: 1.0000 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            5            7
True 1            4           19

Accuracy:0.685714
acc_clas_0:0.416667
acc_clas_1:0.826087
Fold 3/5
Epoch: 1, | Train Loss: 5.557 Vali Loss: 4.664
Epoch: 1, | Train Acc: 0.8913 Vali Acc: 0.4571
Validation loss decreased (inf --> 4.663741).  Saving model ...
Epoch: 2, | Train Loss: 5.541 Vali Loss: 4.545
Epoch: 2, | Train Acc: 0.9565 Vali Acc: 1.0000
Validation loss decreased (4.663741 --> 4.545276).  Saving model ...
Epoch: 3, | Train Loss: 5.510 Vali Loss: 4.619
Epoch: 3, | Train Acc: 0.9928 Vali Acc: 0.8000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.500 Vali Loss: 4.569
Epoch: 4, | Train Acc: 0.9928 Vali Acc: 0.9143
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.481 Vali Loss: 4.540
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.545276 --> 4.539995).  Saving model ...
Epoch: 6, | Train Loss: 5.477 Vali Loss: 4.486
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.539995 --> 4.485833).  Saving model ...
Epoch: 7, | Train Loss: 5.466 Vali Loss: 4.482
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.485833 --> 4.481768).  Saving model ...
Epoch: 8, | Train Loss: 5.460 Vali Loss: 4.468
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.481768 --> 4.468235).  Saving model ...
Epoch: 9, | Train Loss: 5.457 Vali Loss: 4.459
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.468235 --> 4.458605).  Saving model ...
Epoch: 10, | Train Loss: 5.450 Vali Loss: 4.468
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.445 Vali Loss: 4.475
Epoch: 11, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 5.446 Vali Loss: 4.460
Epoch: 12, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 13, | Train Loss: 5.447 Vali Loss: 4.480
Epoch: 13, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           16            0
True 1            0           19

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.492 Vali Loss: 4.178
Epoch: 1, | Train Acc: 0.9928 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.178251).  Saving model ...
Epoch: 2, | Train Loss: 5.479 Vali Loss: 4.184
Epoch: 2, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.485 Vali Loss: 4.293
Epoch: 3, | Train Acc: 0.9928 Vali Acc: 0.7941
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.476 Vali Loss: 4.327
Epoch: 4, | Train Acc: 1.0000 Vali Acc: 0.7059
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.467 Vali Loss: 4.329
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 0.6176
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           13            0
True 1            0           21

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.484 Vali Loss: 4.328
Epoch: 1, | Train Acc: 1.0000 Vali Acc: 0.5588
Validation loss decreased (inf --> 4.328424).  Saving model ...
Epoch: 2, | Train Loss: 5.474 Vali Loss: 4.293
Epoch: 2, | Train Acc: 1.0000 Vali Acc: 0.8529
Validation loss decreased (4.328424 --> 4.292829).  Saving model ...
Epoch: 3, | Train Loss: 5.471 Vali Loss: 4.179
Epoch: 3, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.292829 --> 4.178924).  Saving model ...
Epoch: 4, | Train Loss: 5.464 Vali Loss: 4.157
Epoch: 4, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.178924 --> 4.157108).  Saving model ...
Epoch: 5, | Train Loss: 5.459 Vali Loss: 4.167
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.457 Vali Loss: 4.187
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.455 Vali Loss: 4.160
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.447 Vali Loss: 4.148
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.157108 --> 4.147787).  Saving model ...
Epoch: 9, | Train Loss: 5.451 Vali Loss: 4.184
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.443 Vali Loss: 4.180
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.444 Vali Loss: 4.331
Epoch: 11, | Train Acc: 1.0000 Vali Acc: 0.5294
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.437 Vali Loss: 4.156
Epoch: 12, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           17            0
True 1            0           17

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
total avg vali acc:0.851429  total avg vali acc_clas_0: 0.848039  total avg vali acc_clas_1: 0.831884
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=8.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_8.0_pretrain_True_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.690 Vali Loss: 4.677
Epoch: 1, | Train Acc: 0.5725 Vali Acc: 0.5429
Validation loss decreased (inf --> 4.677491).  Saving model ...
Epoch: 2, | Train Loss: 5.669 Vali Loss: 4.700
Epoch: 2, | Train Acc: 0.6014 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.649 Vali Loss: 4.685
Epoch: 3, | Train Acc: 0.7536 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.629 Vali Loss: 4.689
Epoch: 4, | Train Acc: 0.8913 Vali Acc: 0.4571
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.612 Vali Loss: 4.666
Epoch: 5, | Train Acc: 0.9638 Vali Acc: 0.5714
Validation loss decreased (4.677491 --> 4.666037).  Saving model ...
Epoch: 6, | Train Loss: 5.596 Vali Loss: 4.673
Epoch: 6, | Train Acc: 0.9638 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.581 Vali Loss: 4.675
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 0.4571
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.564 Vali Loss: 4.680
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.552 Vali Loss: 4.674
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 0.4571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           14
True 1            1           18

Accuracy:0.571429
acc_clas_0:0.125000
acc_clas_1:0.947368
Fold 2/5
Epoch: 1, | Train Loss: 5.629 Vali Loss: 4.601
Epoch: 1, | Train Acc: 0.8333 Vali Acc: 0.9429
Validation loss decreased (inf --> 4.601004).  Saving model ...
Epoch: 2, | Train Loss: 5.608 Vali Loss: 4.591
Epoch: 2, | Train Acc: 0.8986 Vali Acc: 0.9714
Validation loss decreased (4.601004 --> 4.591053).  Saving model ...
Epoch: 3, | Train Loss: 5.584 Vali Loss: 4.622
Epoch: 3, | Train Acc: 0.9420 Vali Acc: 0.8286
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.574 Vali Loss: 4.594
Epoch: 4, | Train Acc: 0.9638 Vali Acc: 0.9714
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.558 Vali Loss: 4.593
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 0.9714
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.551 Vali Loss: 4.609
Epoch: 6, | Train Acc: 0.9928 Vali Acc: 0.9714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           13            1
True 1            0           21

Accuracy:0.971429
acc_clas_0:0.928571
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.603 Vali Loss: 4.626
Epoch: 1, | Train Acc: 0.9275 Vali Acc: 0.7143
Validation loss decreased (inf --> 4.625520).  Saving model ...
Epoch: 2, | Train Loss: 5.583 Vali Loss: 4.589
Epoch: 2, | Train Acc: 0.9565 Vali Acc: 0.9429
Validation loss decreased (4.625520 --> 4.588580).  Saving model ...
Epoch: 3, | Train Loss: 5.567 Vali Loss: 4.601
Epoch: 3, | Train Acc: 0.9928 Vali Acc: 0.9714
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.562 Vali Loss: 4.615
Epoch: 4, | Train Acc: 0.9855 Vali Acc: 0.9714
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.544 Vali Loss: 4.600
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 0.7714
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.533 Vali Loss: 4.578
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.588580 --> 4.577560).  Saving model ...
Epoch: 7, | Train Loss: 5.527 Vali Loss: 4.587
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 0.9714
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.517 Vali Loss: 4.569
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 0.9143
Validation loss decreased (4.577560 --> 4.569376).  Saving model ...
Epoch: 9, | Train Loss: 5.511 Vali Loss: 4.566
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.569376 --> 4.565694).  Saving model ...
Epoch: 10, | Train Loss: 5.503 Vali Loss: 4.559
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 0.9429
Validation loss decreased (4.565694 --> 4.559392).  Saving model ...
Epoch: 11, | Train Loss: 5.498 Vali Loss: 4.572
Epoch: 11, | Train Acc: 1.0000 Vali Acc: 0.9429
EarlyStopping counter: 1 out of 4
Epoch: 12, | Train Loss: 5.491 Vali Loss: 4.566
Epoch: 12, | Train Acc: 1.0000 Vali Acc: 0.9714
EarlyStopping counter: 2 out of 4
Epoch: 13, | Train Loss: 5.486 Vali Loss: 4.551
Epoch: 13, | Train Acc: 0.9928 Vali Acc: 0.9429
Validation loss decreased (4.559392 --> 4.550886).  Saving model ...
Epoch: 14, | Train Loss: 5.479 Vali Loss: 4.561
Epoch: 14, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 15, | Train Loss: 5.473 Vali Loss: 4.570
Epoch: 15, | Train Acc: 1.0000 Vali Acc: 0.9714
EarlyStopping counter: 2 out of 4
Epoch: 16, | Train Loss: 5.472 Vali Loss: 4.556
Epoch: 16, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 17, | Train Loss: 5.463 Vali Loss: 4.569
Epoch: 17, | Train Acc: 1.0000 Vali Acc: 0.9714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           15            2
True 1            0           18

Accuracy:0.942857
acc_clas_0:0.882353
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.529 Vali Loss: 4.260
Epoch: 1, | Train Acc: 0.9784 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.260200).  Saving model ...
Epoch: 2, | Train Loss: 5.521 Vali Loss: 4.181
Epoch: 2, | Train Acc: 0.9856 Vali Acc: 1.0000
Validation loss decreased (4.260200 --> 4.180632).  Saving model ...
Epoch: 3, | Train Loss: 5.509 Vali Loss: 4.195
Epoch: 3, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.505 Vali Loss: 4.193
Epoch: 4, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.494 Vali Loss: 4.206
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.495 Vali Loss: 4.182
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           16            0
True 1            0           18

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.522 Vali Loss: 4.186
Epoch: 1, | Train Acc: 0.9928 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.186358).  Saving model ...
Epoch: 2, | Train Loss: 5.511 Vali Loss: 4.216
Epoch: 2, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.504 Vali Loss: 4.214
Epoch: 3, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.494 Vali Loss: 4.188
Epoch: 4, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.486 Vali Loss: 4.200
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           12            0
True 1            0           22

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
total avg vali acc:0.897143  total avg vali acc_clas_0: 0.787185  total avg vali acc_clas_1: 0.989474
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=8.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_8.0_pretrain_False_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.690 Vali Loss: 4.689
Epoch: 1, | Train Acc: 0.5870 Vali Acc: 0.4000
Validation loss decreased (inf --> 4.689255).  Saving model ...
Epoch: 2, | Train Loss: 5.682 Vali Loss: 4.699
Epoch: 2, | Train Acc: 0.5652 Vali Acc: 0.4000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.679 Vali Loss: 4.713
Epoch: 3, | Train Acc: 0.5652 Vali Acc: 0.4000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.676 Vali Loss: 4.674
Epoch: 4, | Train Acc: 0.5725 Vali Acc: 0.6000
Validation loss decreased (4.689255 --> 4.673704).  Saving model ...
Epoch: 5, | Train Loss: 5.672 Vali Loss: 4.649
Epoch: 5, | Train Acc: 0.5652 Vali Acc: 0.6286
Validation loss decreased (4.673704 --> 4.649330).  Saving model ...
Epoch: 6, | Train Loss: 5.666 Vali Loss: 4.653
Epoch: 6, | Train Acc: 0.6159 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.657 Vali Loss: 4.669
Epoch: 7, | Train Acc: 0.7174 Vali Acc: 0.6000
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.657 Vali Loss: 4.668
Epoch: 8, | Train Acc: 0.7681 Vali Acc: 0.6857
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.641 Vali Loss: 4.659
Epoch: 9, | Train Acc: 0.8116 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           12
True 1            1           20

Accuracy:0.628571
acc_clas_0:0.142857
acc_clas_1:0.952381
Fold 2/5
Epoch: 1, | Train Loss: 5.671 Vali Loss: 4.720
Epoch: 1, | Train Acc: 0.5870 Vali Acc: 0.4571
Validation loss decreased (inf --> 4.719532).  Saving model ...
Epoch: 2, | Train Loss: 5.668 Vali Loss: 4.660
Epoch: 2, | Train Acc: 0.6014 Vali Acc: 0.6857
Validation loss decreased (4.719532 --> 4.660048).  Saving model ...
Epoch: 3, | Train Loss: 5.663 Vali Loss: 4.657
Epoch: 3, | Train Acc: 0.5870 Vali Acc: 0.5429
Validation loss decreased (4.660048 --> 4.656905).  Saving model ...
Epoch: 4, | Train Loss: 5.658 Vali Loss: 4.712
Epoch: 4, | Train Acc: 0.6087 Vali Acc: 0.4571
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.652 Vali Loss: 4.664
Epoch: 5, | Train Acc: 0.6594 Vali Acc: 0.4571
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.642 Vali Loss: 4.656
Epoch: 6, | Train Acc: 0.7174 Vali Acc: 0.7429
Validation loss decreased (4.656905 --> 4.655771).  Saving model ...
Epoch: 7, | Train Loss: 5.636 Vali Loss: 4.629
Epoch: 7, | Train Acc: 0.7681 Vali Acc: 0.7429
Validation loss decreased (4.655771 --> 4.628558).  Saving model ...
Epoch: 8, | Train Loss: 5.624 Vali Loss: 4.637
Epoch: 8, | Train Acc: 0.7681 Vali Acc: 0.7429
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.620 Vali Loss: 4.680
Epoch: 9, | Train Acc: 0.7899 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.605 Vali Loss: 4.635
Epoch: 10, | Train Acc: 0.8913 Vali Acc: 0.6571
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.592 Vali Loss: 4.651
Epoch: 11, | Train Acc: 0.9130 Vali Acc: 0.6286
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            8            8
True 1            1           18

Accuracy:0.742857
acc_clas_0:0.500000
acc_clas_1:0.947368
Fold 3/5
Epoch: 1, | Train Loss: 5.642 Vali Loss: 4.654
Epoch: 1, | Train Acc: 0.7681 Vali Acc: 0.7429
Validation loss decreased (inf --> 4.654305).  Saving model ...
Epoch: 2, | Train Loss: 5.630 Vali Loss: 4.611
Epoch: 2, | Train Acc: 0.8043 Vali Acc: 0.8000
Validation loss decreased (4.654305 --> 4.611216).  Saving model ...
Epoch: 3, | Train Loss: 5.621 Vali Loss: 4.616
Epoch: 3, | Train Acc: 0.8478 Vali Acc: 0.6857
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.608 Vali Loss: 4.670
Epoch: 4, | Train Acc: 0.8913 Vali Acc: 0.4857
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.593 Vali Loss: 4.663
Epoch: 5, | Train Acc: 0.8913 Vali Acc: 0.3714
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.578 Vali Loss: 4.649
Epoch: 6, | Train Acc: 0.9058 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            6            7
True 1            0           22

Accuracy:0.800000
acc_clas_0:0.461538
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.638 Vali Loss: 4.375
Epoch: 1, | Train Acc: 0.8058 Vali Acc: 0.4706
Validation loss decreased (inf --> 4.375205).  Saving model ...
Epoch: 2, | Train Loss: 5.626 Vali Loss: 4.376
Epoch: 2, | Train Acc: 0.8345 Vali Acc: 0.4706
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.606 Vali Loss: 4.355
Epoch: 3, | Train Acc: 0.9065 Vali Acc: 0.8824
Validation loss decreased (4.375205 --> 4.355494).  Saving model ...
Epoch: 4, | Train Loss: 5.600 Vali Loss: 4.358
Epoch: 4, | Train Acc: 0.9065 Vali Acc: 0.8235
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.587 Vali Loss: 4.468
Epoch: 5, | Train Acc: 0.8993 Vali Acc: 0.3235
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.571 Vali Loss: 4.428
Epoch: 6, | Train Acc: 0.9353 Vali Acc: 0.4118
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.553 Vali Loss: 4.338
Epoch: 7, | Train Acc: 0.9424 Vali Acc: 0.7353
Validation loss decreased (4.355494 --> 4.337567).  Saving model ...
Epoch: 8, | Train Loss: 5.546 Vali Loss: 4.526
Epoch: 8, | Train Acc: 0.9065 Vali Acc: 0.3235
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.537 Vali Loss: 4.326
Epoch: 9, | Train Acc: 0.9568 Vali Acc: 0.8235
Validation loss decreased (4.337567 --> 4.326375).  Saving model ...
Epoch: 10, | Train Loss: 5.513 Vali Loss: 4.384
Epoch: 10, | Train Acc: 0.9712 Vali Acc: 0.7647
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.493 Vali Loss: 4.364
Epoch: 11, | Train Acc: 0.9784 Vali Acc: 0.8235
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 5.475 Vali Loss: 4.321
Epoch: 12, | Train Acc: 1.0000 Vali Acc: 0.7941
Validation loss decreased (4.326375 --> 4.321193).  Saving model ...
Epoch: 13, | Train Loss: 5.478 Vali Loss: 4.353
Epoch: 13, | Train Acc: 1.0000 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 14, | Train Loss: 5.460 Vali Loss: 4.413
Epoch: 14, | Train Acc: 0.9928 Vali Acc: 0.4118
EarlyStopping counter: 2 out of 4
Epoch: 15, | Train Loss: 5.456 Vali Loss: 4.434
Epoch: 15, | Train Acc: 1.0000 Vali Acc: 0.5294
EarlyStopping counter: 3 out of 4
Epoch: 16, | Train Loss: 5.451 Vali Loss: 4.434
Epoch: 16, | Train Acc: 1.0000 Vali Acc: 0.3824
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           10            1
True 1            6           17

Accuracy:0.794118
acc_clas_0:0.909091
acc_clas_1:0.739130
Fold 5/5
Epoch: 1, | Train Loss: 5.529 Vali Loss: 4.289
Epoch: 1, | Train Acc: 0.9496 Vali Acc: 0.8824
Validation loss decreased (inf --> 4.288546).  Saving model ...
Epoch: 2, | Train Loss: 5.516 Vali Loss: 4.280
Epoch: 2, | Train Acc: 0.9640 Vali Acc: 0.6471
Validation loss decreased (4.288546 --> 4.280416).  Saving model ...
Epoch: 3, | Train Loss: 5.490 Vali Loss: 4.336
Epoch: 3, | Train Acc: 0.9784 Vali Acc: 0.7353
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.483 Vali Loss: 4.250
Epoch: 4, | Train Acc: 0.9928 Vali Acc: 0.8824
Validation loss decreased (4.280416 --> 4.249638).  Saving model ...
Epoch: 5, | Train Loss: 5.482 Vali Loss: 4.314
Epoch: 5, | Train Acc: 0.9784 Vali Acc: 0.6471
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.468 Vali Loss: 4.327
Epoch: 6, | Train Acc: 0.9928 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.452 Vali Loss: 4.210
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 0.9412
Validation loss decreased (4.249638 --> 4.210282).  Saving model ...
Epoch: 8, | Train Loss: 5.455 Vali Loss: 4.388
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 0.4118
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.448 Vali Loss: 4.279
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 0.8529
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.443 Vali Loss: 4.246
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 0.8529
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.443 Vali Loss: 4.405
Epoch: 11, | Train Acc: 1.0000 Vali Acc: 0.4118
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           19            2
True 1            0           13

Accuracy:0.941176
acc_clas_0:0.904762
acc_clas_1:1.000000
total avg vali acc:0.781345  total avg vali acc_clas_0: 0.583650  total avg vali acc_clas_1: 0.927776
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='resnet18', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=8.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 14.22M
>>>>>>>start training : enc_mri_resnet18_f_dim_128_temperature_8.0_pretrain_False_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.690 Vali Loss: 4.683
Epoch: 1, | Train Acc: 0.5507 Vali Acc: 0.4286
Validation loss decreased (inf --> 4.683500).  Saving model ...
Epoch: 2, | Train Loss: 5.686 Vali Loss: 4.670
Epoch: 2, | Train Acc: 0.5507 Vali Acc: 0.6286
Validation loss decreased (4.683500 --> 4.670116).  Saving model ...
Epoch: 3, | Train Loss: 5.684 Vali Loss: 4.667
Epoch: 3, | Train Acc: 0.5507 Vali Acc: 0.6286
Validation loss decreased (4.670116 --> 4.667371).  Saving model ...
Epoch: 4, | Train Loss: 5.681 Vali Loss: 4.676
Epoch: 4, | Train Acc: 0.5507 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.678 Vali Loss: 4.649
Epoch: 5, | Train Acc: 0.5507 Vali Acc: 0.6286
Validation loss decreased (4.667371 --> 4.649341).  Saving model ...
Epoch: 6, | Train Loss: 5.675 Vali Loss: 4.676
Epoch: 6, | Train Acc: 0.5507 Vali Acc: 0.6286
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.671 Vali Loss: 4.662
Epoch: 7, | Train Acc: 0.5507 Vali Acc: 0.6286
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.667 Vali Loss: 4.672
Epoch: 8, | Train Acc: 0.6667 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.661 Vali Loss: 4.687
Epoch: 9, | Train Acc: 0.7174 Vali Acc: 0.6571
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           13
True 1            0           22

Accuracy:0.628571
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.678 Vali Loss: 4.669
Epoch: 1, | Train Acc: 0.5797 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.668953).  Saving model ...
Epoch: 2, | Train Loss: 5.675 Vali Loss: 4.726
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.671 Vali Loss: 4.658
Epoch: 3, | Train Acc: 0.5797 Vali Acc: 0.5143
Validation loss decreased (4.668953 --> 4.657541).  Saving model ...
Epoch: 4, | Train Loss: 5.672 Vali Loss: 4.665
Epoch: 4, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.665 Vali Loss: 4.653
Epoch: 5, | Train Acc: 0.5797 Vali Acc: 0.5143
Validation loss decreased (4.657541 --> 4.652880).  Saving model ...
Epoch: 6, | Train Loss: 5.663 Vali Loss: 4.670
Epoch: 6, | Train Acc: 0.7101 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.656 Vali Loss: 4.681
Epoch: 7, | Train Acc: 0.7029 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.656 Vali Loss: 4.653
Epoch: 8, | Train Acc: 0.6087 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.648 Vali Loss: 4.677
Epoch: 9, | Train Acc: 0.6812 Vali Acc: 0.5714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           17
True 1            0           18

Accuracy:0.514286
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.665 Vali Loss: 4.648
Epoch: 1, | Train Acc: 0.5797 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.647812).  Saving model ...
Epoch: 2, | Train Loss: 5.661 Vali Loss: 4.632
Epoch: 2, | Train Acc: 0.6232 Vali Acc: 0.5714
Validation loss decreased (4.647812 --> 4.631664).  Saving model ...
Epoch: 3, | Train Loss: 5.658 Vali Loss: 4.653
Epoch: 3, | Train Acc: 0.6594 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.650 Vali Loss: 4.653
Epoch: 4, | Train Acc: 0.7536 Vali Acc: 0.8286
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.648 Vali Loss: 4.649
Epoch: 5, | Train Acc: 0.8478 Vali Acc: 0.8571
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.642 Vali Loss: 4.655
Epoch: 6, | Train Acc: 0.7899 Vali Acc: 0.7143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           15
True 1            0           20

Accuracy:0.571429
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.677 Vali Loss: 4.376
Epoch: 1, | Train Acc: 0.7050 Vali Acc: 0.4412
Validation loss decreased (inf --> 4.375902).  Saving model ...
Epoch: 2, | Train Loss: 5.673 Vali Loss: 4.450
Epoch: 2, | Train Acc: 0.6763 Vali Acc: 0.4412
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.669 Vali Loss: 4.411
Epoch: 3, | Train Acc: 0.6331 Vali Acc: 0.5000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.667 Vali Loss: 4.411
Epoch: 4, | Train Acc: 0.7266 Vali Acc: 0.5294
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.660 Vali Loss: 4.379
Epoch: 5, | Train Acc: 0.7410 Vali Acc: 0.5588
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           19
True 1            0           15

Accuracy:0.441176
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.682 Vali Loss: 4.340
Epoch: 1, | Train Acc: 0.6331 Vali Acc: 0.8529
Validation loss decreased (inf --> 4.340250).  Saving model ...
Epoch: 2, | Train Loss: 5.678 Vali Loss: 4.347
Epoch: 2, | Train Acc: 0.7770 Vali Acc: 0.8529
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.672 Vali Loss: 4.347
Epoch: 3, | Train Acc: 0.7698 Vali Acc: 0.8529
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.669 Vali Loss: 4.351
Epoch: 4, | Train Acc: 0.7842 Vali Acc: 0.8235
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.665 Vali Loss: 4.343
Epoch: 5, | Train Acc: 0.8417 Vali Acc: 0.8235
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            6            5
True 1            0           23

Accuracy:0.852941
acc_clas_0:0.545455
acc_clas_1:1.000000
total avg vali acc:0.601681  total avg vali acc_clas_0: 0.109091  total avg vali acc_clas_1: 1.000000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=8.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_8.0_pretrain_True_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.693 Vali Loss: 4.691
Epoch: 1, | Train Acc: 0.5652 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.690924).  Saving model ...
Epoch: 2, | Train Loss: 5.690 Vali Loss: 4.677
Epoch: 2, | Train Acc: 0.5580 Vali Acc: 0.5143
Validation loss decreased (4.690924 --> 4.676834).  Saving model ...
Epoch: 3, | Train Loss: 5.682 Vali Loss: 4.684
Epoch: 3, | Train Acc: 0.6014 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.680 Vali Loss: 4.660
Epoch: 4, | Train Acc: 0.5870 Vali Acc: 0.5143
Validation loss decreased (4.676834 --> 4.659663).  Saving model ...
Epoch: 5, | Train Loss: 5.673 Vali Loss: 4.702
Epoch: 5, | Train Acc: 0.6087 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.672 Vali Loss: 4.670
Epoch: 6, | Train Acc: 0.6232 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.666 Vali Loss: 4.695
Epoch: 7, | Train Acc: 0.6087 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.654 Vali Loss: 4.659
Epoch: 8, | Train Acc: 0.6232 Vali Acc: 0.5143
Validation loss decreased (4.659663 --> 4.659348).  Saving model ...
Epoch: 9, | Train Loss: 5.648 Vali Loss: 4.680
Epoch: 9, | Train Acc: 0.6232 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.645 Vali Loss: 4.671
Epoch: 10, | Train Acc: 0.6522 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.639 Vali Loss: 4.683
Epoch: 11, | Train Acc: 0.6304 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.634 Vali Loss: 4.683
Epoch: 12, | Train Acc: 0.6594 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           17
True 1            0           18

Accuracy:0.514286
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.671 Vali Loss: 4.660
Epoch: 1, | Train Acc: 0.5870 Vali Acc: 0.5429
Validation loss decreased (inf --> 4.659920).  Saving model ...
Epoch: 2, | Train Loss: 5.660 Vali Loss: 4.667
Epoch: 2, | Train Acc: 0.6159 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.654 Vali Loss: 4.653
Epoch: 3, | Train Acc: 0.6159 Vali Acc: 0.5429
Validation loss decreased (4.659920 --> 4.652787).  Saving model ...
Epoch: 4, | Train Loss: 5.650 Vali Loss: 4.651
Epoch: 4, | Train Acc: 0.7101 Vali Acc: 0.6000
Validation loss decreased (4.652787 --> 4.650959).  Saving model ...
Epoch: 5, | Train Loss: 5.642 Vali Loss: 4.635
Epoch: 5, | Train Acc: 0.6522 Vali Acc: 0.5429
Validation loss decreased (4.650959 --> 4.635097).  Saving model ...
Epoch: 6, | Train Loss: 5.642 Vali Loss: 4.662
Epoch: 6, | Train Acc: 0.6377 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.636 Vali Loss: 4.652
Epoch: 7, | Train Acc: 0.6449 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.630 Vali Loss: 4.641
Epoch: 8, | Train Acc: 0.6884 Vali Acc: 0.6857
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.626 Vali Loss: 4.658
Epoch: 9, | Train Acc: 0.8043 Vali Acc: 0.5714
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           16
True 1            0           19

Accuracy:0.542857
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.661 Vali Loss: 4.625
Epoch: 1, | Train Acc: 0.7029 Vali Acc: 0.7143
Validation loss decreased (inf --> 4.625325).  Saving model ...
Epoch: 2, | Train Loss: 5.646 Vali Loss: 4.607
Epoch: 2, | Train Acc: 0.7101 Vali Acc: 0.7714
Validation loss decreased (4.625325 --> 4.607367).  Saving model ...
Epoch: 3, | Train Loss: 5.640 Vali Loss: 4.597
Epoch: 3, | Train Acc: 0.8406 Vali Acc: 0.7714
Validation loss decreased (4.607367 --> 4.597264).  Saving model ...
Epoch: 4, | Train Loss: 5.644 Vali Loss: 4.584
Epoch: 4, | Train Acc: 0.6449 Vali Acc: 0.7714
Validation loss decreased (4.597264 --> 4.584306).  Saving model ...
Epoch: 5, | Train Loss: 5.634 Vali Loss: 4.562
Epoch: 5, | Train Acc: 0.8551 Vali Acc: 0.7714
Validation loss decreased (4.584306 --> 4.561659).  Saving model ...
Epoch: 6, | Train Loss: 5.622 Vali Loss: 4.635
Epoch: 6, | Train Acc: 0.7899 Vali Acc: 0.7714
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.585 Vali Loss: 4.625
Epoch: 7, | Train Acc: 0.8551 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.590 Vali Loss: 4.677
Epoch: 8, | Train Acc: 0.7319 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.549 Vali Loss: 4.692
Epoch: 9, | Train Acc: 0.8116 Vali Acc: 0.4857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            5            8
True 1            0           22

Accuracy:0.771429
acc_clas_0:0.384615
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.664 Vali Loss: 4.309
Epoch: 1, | Train Acc: 0.6547 Vali Acc: 0.9412
Validation loss decreased (inf --> 4.308815).  Saving model ...
Epoch: 2, | Train Loss: 5.659 Vali Loss: 4.343
Epoch: 2, | Train Acc: 0.6978 Vali Acc: 0.8529
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.661 Vali Loss: 4.285
Epoch: 3, | Train Acc: 0.7410 Vali Acc: 0.7059
Validation loss decreased (4.308815 --> 4.284786).  Saving model ...
Epoch: 4, | Train Loss: 5.653 Vali Loss: 4.325
Epoch: 4, | Train Acc: 0.7842 Vali Acc: 0.7353
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.651 Vali Loss: 4.326
Epoch: 5, | Train Acc: 0.7194 Vali Acc: 0.9706
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.650 Vali Loss: 4.334
Epoch: 6, | Train Acc: 0.7770 Vali Acc: 0.7353
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.654 Vali Loss: 4.323
Epoch: 7, | Train Acc: 0.5971 Vali Acc: 0.7353
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           10
True 1            0           22

Accuracy:0.705882
acc_clas_0:0.166667
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.674 Vali Loss: 4.379
Epoch: 1, | Train Acc: 0.5899 Vali Acc: 0.5294
Validation loss decreased (inf --> 4.378775).  Saving model ...
Epoch: 2, | Train Loss: 5.646 Vali Loss: 4.353
Epoch: 2, | Train Acc: 0.7914 Vali Acc: 0.8529
Validation loss decreased (4.378775 --> 4.352513).  Saving model ...
Epoch: 3, | Train Loss: 5.647 Vali Loss: 4.361
Epoch: 3, | Train Acc: 0.6691 Vali Acc: 0.6176
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.636 Vali Loss: 4.374
Epoch: 4, | Train Acc: 0.7770 Vali Acc: 0.8529
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.634 Vali Loss: 4.369
Epoch: 5, | Train Acc: 0.8129 Vali Acc: 0.6471
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.628 Vali Loss: 4.349
Epoch: 6, | Train Acc: 0.8993 Vali Acc: 0.7941
Validation loss decreased (4.352513 --> 4.348733).  Saving model ...
Epoch: 7, | Train Loss: 5.627 Vali Loss: 4.334
Epoch: 7, | Train Acc: 0.8345 Vali Acc: 0.6471
Validation loss decreased (4.348733 --> 4.333896).  Saving model ...
Epoch: 8, | Train Loss: 5.626 Vali Loss: 4.355
Epoch: 8, | Train Acc: 0.8705 Vali Acc: 0.8235
EarlyStopping counter: 1 out of 4
Epoch: 9, | Train Loss: 5.617 Vali Loss: 4.370
Epoch: 9, | Train Acc: 0.8921 Vali Acc: 0.6765
EarlyStopping counter: 2 out of 4
Epoch: 10, | Train Loss: 5.618 Vali Loss: 4.375
Epoch: 10, | Train Acc: 0.7554 Vali Acc: 0.6471
EarlyStopping counter: 3 out of 4
Epoch: 11, | Train Loss: 5.621 Vali Loss: 4.384
Epoch: 11, | Train Acc: 0.8849 Vali Acc: 0.7941
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            5           12
True 1            0           17

Accuracy:0.647059
acc_clas_0:0.294118
acc_clas_1:1.000000
total avg vali acc:0.636303  total avg vali acc_clas_0: 0.169080  total avg vali acc_clas_1: 1.000000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=True, root_dir='/data/yuguoqi/dataset/abide', temperature=8.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_8.0_pretrain_True_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.706 Vali Loss: 4.675
Epoch: 1, | Train Acc: 0.4493 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.675301).  Saving model ...
Epoch: 2, | Train Loss: 5.681 Vali Loss: 4.663
Epoch: 2, | Train Acc: 0.6087 Vali Acc: 0.7143
Validation loss decreased (4.675301 --> 4.663386).  Saving model ...
Epoch: 3, | Train Loss: 5.677 Vali Loss: 4.652
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.6000
Validation loss decreased (4.663386 --> 4.652123).  Saving model ...
Epoch: 4, | Train Loss: 5.655 Vali Loss: 4.664
Epoch: 4, | Train Acc: 0.7101 Vali Acc: 0.7143
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.642 Vali Loss: 4.642
Epoch: 5, | Train Acc: 0.8261 Vali Acc: 0.7714
Validation loss decreased (4.652123 --> 4.641933).  Saving model ...
Epoch: 6, | Train Loss: 5.622 Vali Loss: 4.674
Epoch: 6, | Train Acc: 0.8623 Vali Acc: 0.7143
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.607 Vali Loss: 4.660
Epoch: 7, | Train Acc: 0.9130 Vali Acc: 0.7143
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.590 Vali Loss: 4.637
Epoch: 8, | Train Acc: 0.9275 Vali Acc: 0.7143
Validation loss decreased (4.641933 --> 4.637204).  Saving model ...
Epoch: 9, | Train Loss: 5.571 Vali Loss: 4.644
Epoch: 9, | Train Acc: 0.9710 Vali Acc: 0.6571
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.553 Vali Loss: 4.640
Epoch: 10, | Train Acc: 0.9710 Vali Acc: 0.7143
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.533 Vali Loss: 4.642
Epoch: 11, | Train Acc: 0.9928 Vali Acc: 0.6857
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.517 Vali Loss: 4.636
Epoch: 12, | Train Acc: 0.9928 Vali Acc: 0.7143
Validation loss decreased (4.637204 --> 4.635841).  Saving model ...
Epoch: 13, | Train Loss: 5.505 Vali Loss: 4.640
Epoch: 13, | Train Acc: 0.9928 Vali Acc: 0.7143
EarlyStopping counter: 1 out of 4
Epoch: 14, | Train Loss: 5.497 Vali Loss: 4.644
Epoch: 14, | Train Acc: 1.0000 Vali Acc: 0.6571
EarlyStopping counter: 2 out of 4
Epoch: 15, | Train Loss: 5.483 Vali Loss: 4.646
Epoch: 15, | Train Acc: 1.0000 Vali Acc: 0.6286
EarlyStopping counter: 3 out of 4
Epoch: 16, | Train Loss: 5.470 Vali Loss: 4.642
Epoch: 16, | Train Acc: 1.0000 Vali Acc: 0.7143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            7            3
True 1            7           18

Accuracy:0.714286
acc_clas_0:0.700000
acc_clas_1:0.720000
Fold 2/5
Epoch: 1, | Train Loss: 5.554 Vali Loss: 4.573
Epoch: 1, | Train Acc: 0.8986 Vali Acc: 0.9429
Validation loss decreased (inf --> 4.573375).  Saving model ...
Epoch: 2, | Train Loss: 5.538 Vali Loss: 4.535
Epoch: 2, | Train Acc: 0.9638 Vali Acc: 0.9143
Validation loss decreased (4.573375 --> 4.534991).  Saving model ...
Epoch: 3, | Train Loss: 5.520 Vali Loss: 4.590
Epoch: 3, | Train Acc: 0.9783 Vali Acc: 0.7143
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.510 Vali Loss: 4.543
Epoch: 4, | Train Acc: 0.9710 Vali Acc: 0.9143
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.500 Vali Loss: 4.541
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 0.9143
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.477 Vali Loss: 4.543
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 0.9429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           19            3
True 1            0           13

Accuracy:0.914286
acc_clas_0:0.863636
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.563 Vali Loss: 4.485
Epoch: 1, | Train Acc: 0.9203 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.484836).  Saving model ...
Epoch: 2, | Train Loss: 5.523 Vali Loss: 4.498
Epoch: 2, | Train Acc: 0.9710 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.518 Vali Loss: 4.495
Epoch: 3, | Train Acc: 0.9783 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.507 Vali Loss: 4.480
Epoch: 4, | Train Acc: 0.9783 Vali Acc: 1.0000
Validation loss decreased (4.484836 --> 4.480204).  Saving model ...
Epoch: 5, | Train Loss: 5.486 Vali Loss: 4.481
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.476 Vali Loss: 4.475
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.480204 --> 4.475113).  Saving model ...
Epoch: 7, | Train Loss: 5.466 Vali Loss: 4.493
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.455 Vali Loss: 4.477
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.452 Vali Loss: 4.452
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.475113 --> 4.451606).  Saving model ...
Epoch: 10, | Train Loss: 5.449 Vali Loss: 4.452
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.441 Vali Loss: 4.474
Epoch: 11, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 5.438 Vali Loss: 4.469
Epoch: 12, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 13, | Train Loss: 5.432 Vali Loss: 4.454
Epoch: 13, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           17            0
True 1            0           18

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.510 Vali Loss: 4.155
Epoch: 1, | Train Acc: 0.9856 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.155384).  Saving model ...
Epoch: 2, | Train Loss: 5.486 Vali Loss: 4.191
Epoch: 2, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.476 Vali Loss: 4.160
Epoch: 3, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.464 Vali Loss: 4.176
Epoch: 4, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.458 Vali Loss: 4.140
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.155384 --> 4.139916).  Saving model ...
Epoch: 6, | Train Loss: 5.451 Vali Loss: 4.168
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.447 Vali Loss: 4.166
Epoch: 7, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.443 Vali Loss: 4.143
Epoch: 8, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.441 Vali Loss: 4.137
Epoch: 9, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.139916 --> 4.136950).  Saving model ...
Epoch: 10, | Train Loss: 5.436 Vali Loss: 4.163
Epoch: 10, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 11, | Train Loss: 5.432 Vali Loss: 4.179
Epoch: 11, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 12, | Train Loss: 5.430 Vali Loss: 4.140
Epoch: 12, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 13, | Train Loss: 5.427 Vali Loss: 4.160
Epoch: 13, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           13            0
True 1            0           21

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.457 Vali Loss: 4.146
Epoch: 1, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (inf --> 4.146467).  Saving model ...
Epoch: 2, | Train Loss: 5.446 Vali Loss: 4.144
Epoch: 2, | Train Acc: 1.0000 Vali Acc: 1.0000
Validation loss decreased (4.146467 --> 4.143759).  Saving model ...
Epoch: 3, | Train Loss: 5.439 Vali Loss: 4.151
Epoch: 3, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.435 Vali Loss: 4.150
Epoch: 4, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.436 Vali Loss: 4.146
Epoch: 5, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.432 Vali Loss: 4.156
Epoch: 6, | Train Acc: 1.0000 Vali Acc: 1.0000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           13            0
True 1            0           21

Accuracy:1.000000
acc_clas_0:1.000000
acc_clas_1:1.000000
total avg vali acc:0.925714  total avg vali acc_clas_0: 0.912727  total avg vali acc_clas_1: 0.944000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=True, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=8.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_8.0_pretrain_False_finetune_True>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.680 Vali Loss: 4.787
Epoch: 1, | Train Acc: 0.6232 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.786572).  Saving model ...
Epoch: 2, | Train Loss: 5.699 Vali Loss: 4.678
Epoch: 2, | Train Acc: 0.5942 Vali Acc: 0.5143
Validation loss decreased (4.786572 --> 4.677505).  Saving model ...
Epoch: 3, | Train Loss: 5.684 Vali Loss: 4.692
Epoch: 3, | Train Acc: 0.5870 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.679 Vali Loss: 4.696
Epoch: 4, | Train Acc: 0.5942 Vali Acc: 0.5429
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.680 Vali Loss: 4.688
Epoch: 5, | Train Acc: 0.5797 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.678 Vali Loss: 4.679
Epoch: 6, | Train Acc: 0.5942 Vali Acc: 0.5143
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           17
True 1            0           18

Accuracy:0.514286
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.703 Vali Loss: 4.717
Epoch: 1, | Train Acc: 0.5725 Vali Acc: 0.5429
Validation loss decreased (inf --> 4.716649).  Saving model ...
Epoch: 2, | Train Loss: 5.696 Vali Loss: 4.654
Epoch: 2, | Train Acc: 0.5725 Vali Acc: 0.5429
Validation loss decreased (4.716649 --> 4.653585).  Saving model ...
Epoch: 3, | Train Loss: 5.688 Vali Loss: 4.686
Epoch: 3, | Train Acc: 0.5725 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.683 Vali Loss: 4.678
Epoch: 4, | Train Acc: 0.5725 Vali Acc: 0.4571
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.684 Vali Loss: 4.676
Epoch: 5, | Train Acc: 0.5942 Vali Acc: 0.5429
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.682 Vali Loss: 4.669
Epoch: 6, | Train Acc: 0.5870 Vali Acc: 0.5429
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           16
True 1            0           19

Accuracy:0.542857
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.683 Vali Loss: 4.682
Epoch: 1, | Train Acc: 0.5870 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.681852).  Saving model ...
Epoch: 2, | Train Loss: 5.682 Vali Loss: 4.682
Epoch: 2, | Train Acc: 0.5725 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.680 Vali Loss: 4.702
Epoch: 3, | Train Acc: 0.5870 Vali Acc: 0.4857
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.673 Vali Loss: 4.675
Epoch: 4, | Train Acc: 0.5942 Vali Acc: 0.5714
Validation loss decreased (4.681852 --> 4.674832).  Saving model ...
Epoch: 5, | Train Loss: 5.670 Vali Loss: 4.679
Epoch: 5, | Train Acc: 0.6159 Vali Acc: 0.5429
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.669 Vali Loss: 4.698
Epoch: 6, | Train Acc: 0.6159 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.663 Vali Loss: 4.667
Epoch: 7, | Train Acc: 0.6159 Vali Acc: 0.4857
Validation loss decreased (4.674832 --> 4.666785).  Saving model ...
Epoch: 8, | Train Loss: 5.658 Vali Loss: 4.660
Epoch: 8, | Train Acc: 0.6304 Vali Acc: 0.5429
Validation loss decreased (4.666785 --> 4.660301).  Saving model ...
Epoch: 9, | Train Loss: 5.652 Vali Loss: 4.703
Epoch: 9, | Train Acc: 0.6232 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.648 Vali Loss: 4.684
Epoch: 10, | Train Acc: 0.6449 Vali Acc: 0.4857
EarlyStopping counter: 2 out of 4
Epoch: 11, | Train Loss: 5.642 Vali Loss: 4.681
Epoch: 11, | Train Acc: 0.6522 Vali Acc: 0.4857
EarlyStopping counter: 3 out of 4
Epoch: 12, | Train Loss: 5.636 Vali Loss: 4.660
Epoch: 12, | Train Acc: 0.6304 Vali Acc: 0.4857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2           16
True 1            0           17

Accuracy:0.542857
acc_clas_0:0.111111
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.699 Vali Loss: 4.378
Epoch: 1, | Train Acc: 0.5396 Vali Acc: 0.6176
Validation loss decreased (inf --> 4.377666).  Saving model ...
Epoch: 2, | Train Loss: 5.690 Vali Loss: 4.347
Epoch: 2, | Train Acc: 0.5827 Vali Acc: 0.5588
Validation loss decreased (4.377666 --> 4.346992).  Saving model ...
Epoch: 3, | Train Loss: 5.683 Vali Loss: 4.363
Epoch: 3, | Train Acc: 0.7554 Vali Acc: 0.8824
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.675 Vali Loss: 4.366
Epoch: 4, | Train Acc: 0.6331 Vali Acc: 0.6471
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.675 Vali Loss: 4.323
Epoch: 5, | Train Acc: 0.6619 Vali Acc: 0.7353
Validation loss decreased (4.346992 --> 4.323428).  Saving model ...
Epoch: 6, | Train Loss: 5.668 Vali Loss: 4.352
Epoch: 6, | Train Acc: 0.6331 Vali Acc: 0.6765
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.666 Vali Loss: 4.341
Epoch: 7, | Train Acc: 0.7194 Vali Acc: 0.8235
EarlyStopping counter: 2 out of 4
Epoch: 8, | Train Loss: 5.663 Vali Loss: 4.361
Epoch: 8, | Train Acc: 0.6835 Vali Acc: 0.6765
EarlyStopping counter: 3 out of 4
Epoch: 9, | Train Loss: 5.660 Vali Loss: 4.336
Epoch: 9, | Train Acc: 0.8058 Vali Acc: 0.7941
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            6            8
True 1            1           19

Accuracy:0.735294
acc_clas_0:0.428571
acc_clas_1:0.950000
Fold 5/5
Epoch: 1, | Train Loss: 5.698 Vali Loss: 4.310
Epoch: 1, | Train Acc: 0.5683 Vali Acc: 0.7647
Validation loss decreased (inf --> 4.310400).  Saving model ...
Epoch: 2, | Train Loss: 5.686 Vali Loss: 4.337
Epoch: 2, | Train Acc: 0.5468 Vali Acc: 0.7647
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.675 Vali Loss: 4.355
Epoch: 3, | Train Acc: 0.7410 Vali Acc: 0.8529
EarlyStopping counter: 2 out of 4
Epoch: 4, | Train Loss: 5.672 Vali Loss: 4.315
Epoch: 4, | Train Acc: 0.7554 Vali Acc: 0.8235
EarlyStopping counter: 3 out of 4
Epoch: 5, | Train Loss: 5.666 Vali Loss: 4.325
Epoch: 5, | Train Acc: 0.8129 Vali Acc: 0.8824
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            2            8
True 1            0           24

Accuracy:0.764706
acc_clas_0:0.200000
acc_clas_1:1.000000
total avg vali acc:0.620000  total avg vali acc_clas_0: 0.147937  total avg vali acc_clas_1: 0.990000
Args in experiment:
Namespace(batch_size=16, checkpoints='./checkpoints/', devices='0,1', enc_mri='vit16', f_dim=128, finetune=False, gpu=0, l_dim=2, learning_rate=1e-05, model='CAA', num_folds=5, num_workers=1, patience=4, pretrain=False, root_dir='/data/yuguoqi/dataset/abide', temperature=8.0, train_epochs=24, use_amp=True, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
Number of parameters: 88.88M
>>>>>>>start training : enc_mri_vit16_f_dim_128_temperature_8.0_pretrain_False_finetune_False>>>>>>>>>>>>>>>>>>>>>>>>>>
Fold 1/5
Epoch: 1, | Train Loss: 5.693 Vali Loss: 4.679
Epoch: 1, | Train Acc: 0.5507 Vali Acc: 0.5714
Validation loss decreased (inf --> 4.679208).  Saving model ...
Epoch: 2, | Train Loss: 5.688 Vali Loss: 4.668
Epoch: 2, | Train Acc: 0.5652 Vali Acc: 0.5714
Validation loss decreased (4.679208 --> 4.668089).  Saving model ...
Epoch: 3, | Train Loss: 5.685 Vali Loss: 4.672
Epoch: 3, | Train Acc: 0.5652 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.683 Vali Loss: 4.682
Epoch: 4, | Train Acc: 0.5652 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.678 Vali Loss: 4.673
Epoch: 5, | Train Acc: 0.5652 Vali Acc: 0.5714
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.677 Vali Loss: 4.663
Epoch: 6, | Train Acc: 0.5797 Vali Acc: 0.5714
Validation loss decreased (4.668089 --> 4.662702).  Saving model ...
Epoch: 7, | Train Loss: 5.673 Vali Loss: 4.676
Epoch: 7, | Train Acc: 0.5942 Vali Acc: 0.4857
EarlyStopping counter: 1 out of 4
Epoch: 8, | Train Loss: 5.670 Vali Loss: 4.687
Epoch: 8, | Train Acc: 0.6667 Vali Acc: 0.4571
EarlyStopping counter: 2 out of 4
Epoch: 9, | Train Loss: 5.666 Vali Loss: 4.686
Epoch: 9, | Train Acc: 0.6232 Vali Acc: 0.5143
EarlyStopping counter: 3 out of 4
Epoch: 10, | Train Loss: 5.661 Vali Loss: 4.674
Epoch: 10, | Train Acc: 0.6304 Vali Acc: 0.4857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            0           15
True 1            0           20

Accuracy:0.571429
acc_clas_0:0.000000
acc_clas_1:1.000000
Fold 2/5
Epoch: 1, | Train Loss: 5.678 Vali Loss: 4.702
Epoch: 1, | Train Acc: 0.5725 Vali Acc: 0.5143
Validation loss decreased (inf --> 4.701790).  Saving model ...
Epoch: 2, | Train Loss: 5.673 Vali Loss: 4.658
Epoch: 2, | Train Acc: 0.5797 Vali Acc: 0.5143
Validation loss decreased (4.701790 --> 4.657753).  Saving model ...
Epoch: 3, | Train Loss: 5.671 Vali Loss: 4.658
Epoch: 3, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.667 Vali Loss: 4.663
Epoch: 4, | Train Acc: 0.5797 Vali Acc: 0.5143
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.663 Vali Loss: 4.657
Epoch: 5, | Train Acc: 0.5870 Vali Acc: 0.5143
Validation loss decreased (4.657753 --> 4.657353).  Saving model ...
Epoch: 6, | Train Loss: 5.663 Vali Loss: 4.676
Epoch: 6, | Train Acc: 0.5870 Vali Acc: 0.5143
EarlyStopping counter: 1 out of 4
Epoch: 7, | Train Loss: 5.657 Vali Loss: 4.649
Epoch: 7, | Train Acc: 0.6449 Vali Acc: 0.6571
Validation loss decreased (4.657353 --> 4.649452).  Saving model ...
Epoch: 8, | Train Loss: 5.654 Vali Loss: 4.649
Epoch: 8, | Train Acc: 0.6957 Vali Acc: 0.5714
Validation loss decreased (4.649452 --> 4.649211).  Saving model ...
Epoch: 9, | Train Loss: 5.651 Vali Loss: 4.657
Epoch: 9, | Train Acc: 0.6377 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 10, | Train Loss: 5.649 Vali Loss: 4.648
Epoch: 10, | Train Acc: 0.7246 Vali Acc: 0.7143
Validation loss decreased (4.649211 --> 4.647631).  Saving model ...
Epoch: 11, | Train Loss: 5.642 Vali Loss: 4.651
Epoch: 11, | Train Acc: 0.7174 Vali Acc: 0.5714
EarlyStopping counter: 1 out of 4
Epoch: 12, | Train Loss: 5.641 Vali Loss: 4.658
Epoch: 12, | Train Acc: 0.6739 Vali Acc: 0.5714
EarlyStopping counter: 2 out of 4
Epoch: 13, | Train Loss: 5.640 Vali Loss: 4.647
Epoch: 13, | Train Acc: 0.7609 Vali Acc: 0.7429
Validation loss decreased (4.647631 --> 4.646842).  Saving model ...
Epoch: 14, | Train Loss: 5.631 Vali Loss: 4.641
Epoch: 14, | Train Acc: 0.8043 Vali Acc: 0.6000
Validation loss decreased (4.646842 --> 4.641307).  Saving model ...
Epoch: 15, | Train Loss: 5.629 Vali Loss: 4.646
Epoch: 15, | Train Acc: 0.7174 Vali Acc: 0.6000
EarlyStopping counter: 1 out of 4
Epoch: 16, | Train Loss: 5.626 Vali Loss: 4.653
Epoch: 16, | Train Acc: 0.7609 Vali Acc: 0.6857
EarlyStopping counter: 2 out of 4
Epoch: 17, | Train Loss: 5.623 Vali Loss: 4.654
Epoch: 17, | Train Acc: 0.8188 Vali Acc: 0.6857
EarlyStopping counter: 3 out of 4
Epoch: 18, | Train Loss: 5.618 Vali Loss: 4.655
Epoch: 18, | Train Acc: 0.8261 Vali Acc: 0.6857
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            3           14
True 1            0           18

Accuracy:0.600000
acc_clas_0:0.176471
acc_clas_1:1.000000
Fold 3/5
Epoch: 1, | Train Loss: 5.641 Vali Loss: 4.629
Epoch: 1, | Train Acc: 0.7899 Vali Acc: 0.8000
Validation loss decreased (inf --> 4.629338).  Saving model ...
Epoch: 2, | Train Loss: 5.636 Vali Loss: 4.604
Epoch: 2, | Train Acc: 0.7464 Vali Acc: 0.7143
Validation loss decreased (4.629338 --> 4.603866).  Saving model ...
Epoch: 3, | Train Loss: 5.635 Vali Loss: 4.601
Epoch: 3, | Train Acc: 0.6957 Vali Acc: 0.7429
Validation loss decreased (4.603866 --> 4.601057).  Saving model ...
Epoch: 4, | Train Loss: 5.633 Vali Loss: 4.598
Epoch: 4, | Train Acc: 0.7754 Vali Acc: 0.8000
Validation loss decreased (4.601057 --> 4.597610).  Saving model ...
Epoch: 5, | Train Loss: 5.631 Vali Loss: 4.629
Epoch: 5, | Train Acc: 0.8406 Vali Acc: 0.8000
EarlyStopping counter: 1 out of 4
Epoch: 6, | Train Loss: 5.627 Vali Loss: 4.637
Epoch: 6, | Train Acc: 0.7971 Vali Acc: 0.7714
EarlyStopping counter: 2 out of 4
Epoch: 7, | Train Loss: 5.626 Vali Loss: 4.617
Epoch: 7, | Train Acc: 0.7754 Vali Acc: 0.7714
EarlyStopping counter: 3 out of 4
Epoch: 8, | Train Loss: 5.623 Vali Loss: 4.610
Epoch: 8, | Train Acc: 0.8333 Vali Acc: 0.8000
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           10            7
True 1            0           18

Accuracy:0.800000
acc_clas_0:0.588235
acc_clas_1:1.000000
Fold 4/5
Epoch: 1, | Train Loss: 5.653 Vali Loss: 4.352
Epoch: 1, | Train Acc: 0.8129 Vali Acc: 0.9412
Validation loss decreased (inf --> 4.351939).  Saving model ...
Epoch: 2, | Train Loss: 5.649 Vali Loss: 4.359
Epoch: 2, | Train Acc: 0.8993 Vali Acc: 0.8529
EarlyStopping counter: 1 out of 4
Epoch: 3, | Train Loss: 5.648 Vali Loss: 4.319
Epoch: 3, | Train Acc: 0.7770 Vali Acc: 0.7941
Validation loss decreased (4.351939 --> 4.319352).  Saving model ...
Epoch: 4, | Train Loss: 5.639 Vali Loss: 4.363
Epoch: 4, | Train Acc: 0.8849 Vali Acc: 0.9412
EarlyStopping counter: 1 out of 4
Epoch: 5, | Train Loss: 5.641 Vali Loss: 4.353
Epoch: 5, | Train Acc: 0.9209 Vali Acc: 0.9118
EarlyStopping counter: 2 out of 4
Epoch: 6, | Train Loss: 5.644 Vali Loss: 4.372
Epoch: 6, | Train Acc: 0.8058 Vali Acc: 0.7941
EarlyStopping counter: 3 out of 4
Epoch: 7, | Train Loss: 5.636 Vali Loss: 4.337
Epoch: 7, | Train Acc: 0.8993 Vali Acc: 0.9412
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0            4            7
True 1            0           23

Accuracy:0.794118
acc_clas_0:0.363636
acc_clas_1:1.000000
Fold 5/5
Epoch: 1, | Train Loss: 5.649 Vali Loss: 4.319
Epoch: 1, | Train Acc: 0.8993 Vali Acc: 0.9706
Validation loss decreased (inf --> 4.318915).  Saving model ...
Epoch: 2, | Train Loss: 5.641 Vali Loss: 4.309
Epoch: 2, | Train Acc: 0.8777 Vali Acc: 0.9412
Validation loss decreased (4.318915 --> 4.308846).  Saving model ...
Epoch: 3, | Train Loss: 5.640 Vali Loss: 4.326
Epoch: 3, | Train Acc: 0.8561 Vali Acc: 0.9412
EarlyStopping counter: 1 out of 4
Epoch: 4, | Train Loss: 5.637 Vali Loss: 4.320
Epoch: 4, | Train Acc: 0.8993 Vali Acc: 0.9706
EarlyStopping counter: 2 out of 4
Epoch: 5, | Train Loss: 5.634 Vali Loss: 4.329
Epoch: 5, | Train Acc: 0.9065 Vali Acc: 0.9412
EarlyStopping counter: 3 out of 4
Epoch: 6, | Train Loss: 5.632 Vali Loss: 4.314
Epoch: 6, | Train Acc: 0.8993 Vali Acc: 0.9412
EarlyStopping counter: 4 out of 4
Early stopping
Confusion Matrix:
        Predicted 0  Predicted 1
True 0           13            2
True 1            0           19

Accuracy:0.941176
acc_clas_0:0.866667
acc_clas_1:1.000000
total avg vali acc:0.741345  total avg vali acc_clas_0: 0.399002  total avg vali acc_clas_1: 1.000000
